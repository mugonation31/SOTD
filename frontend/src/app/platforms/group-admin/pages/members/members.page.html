<ion-header>
  <ion-toolbar>
    <ion-title>Members Management</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid>
    <!-- Filters -->
    <ion-row>
      <ion-col size="12">
        <div class="member-segments">
          <ion-segment
            [(ngModel)]="selectedFilter"
            (ionChange)="filterMembers($event)"
            mode="ios"
          >
            <ion-segment-button value="all" title="View all members">
              <div class="segment-label">
                <ion-icon name="people-outline"></ion-icon>
                <span>All Members</span>
                <span class="member-count">{{
                  getMemberCount('all')
                }}</span>
              </div>
            </ion-segment-button>

            <ion-segment-button value="admins" title="View admin members">
              <div class="segment-label">
                <ion-icon name="shield-outline"></ion-icon>
                <span>Admins</span>
                <span class="member-count">{{
                  getMemberCount('admins')
                }}</span>
              </div>
            </ion-segment-button>

            <ion-segment-button value="players" title="View player members">
              <div class="segment-label">
                <ion-icon name="person-outline"></ion-icon>
                <span>Players</span>
                <span class="member-count">{{
                  getMemberCount('players')
                }}</span>
              </div>
            </ion-segment-button>

            <ion-segment-button
              value="removed"
              title="View removed members"
            >
              <div class="segment-label">
                <ion-icon name="ban-outline"></ion-icon>
                <span>Removed</span>
                <span class="member-count">{{
                  getMemberCount('removed')
                }}</span>
              </div>
            </ion-segment-button>
          </ion-segment>
        </div>

        <ion-searchbar
          placeholder="Search members"
          (ionInput)="searchMembers($event)"
          class="member-searchbar"
          [debounce]="300"
        ></ion-searchbar>
      </ion-col>
    </ion-row>

    <!-- Members List -->
    <ion-row>
      <ion-col size="12">
        <ion-list class="member-list" [class.loading]="isLoading">
          <!-- Loading Skeleton -->
          <ion-item *ngIf="isLoading" lines="none">
            <ion-avatar slot="start">
              <ion-skeleton-text [animated]="true"></ion-skeleton-text>
            </ion-avatar>
            <ion-label>
              <h2>
                <ion-skeleton-text
                  [animated]="true"
                  style="width: 50%"
                ></ion-skeleton-text>
              </h2>
              <p>
                <ion-skeleton-text
                  [animated]="true"
                  style="width: 70%"
                ></ion-skeleton-text>
              </p>
            </ion-label>
          </ion-item>

          <!-- Member Items -->
          <ion-item
            *ngFor="let member of filteredMembers"
            lines="none"
            class="member-item"
          >
            <ion-avatar
              slot="start"
              [class.admin-avatar]="member.role === 'admin'"
            >
              <ion-icon
                size="large"
                [name]="
                  member.role === 'admin'
                    ? 'shield-outline'
                    : 'person-outline'
                "
                [color]="member.role === 'admin' ? 'dark' : 'medium'"
              ></ion-icon>
            </ion-avatar>

            <ion-label>
              <h2>{{ member.name }}</h2>
              <p>{{ member.email }}</p>
              <p class="member-meta">
                <span class="join-date"
                  >Joined: {{ member.joinedAt | date : 'medium' }}</span
                >
                <ion-badge
                  [color]="
                    member.status === 'active' ? 'success' : 'medium'
                  "
                  class="status-badge"
                >
                  {{ member.status | titlecase }}
                </ion-badge>
              </p>
            </ion-label>

            <!-- Member Actions -->
            <div class="member-actions" slot="end">
              <!-- Admin Management -->
              <ion-button
                *ngIf="
                  (selectedFilter === 'all' ||
                    selectedFilter === 'players') &&
                  member.role !== 'admin' &&
                  member.status === 'active'
                "
                fill="clear"
                size="small"
                class="action-button make-admin-btn"
                (click)="makeAdmin(member)"
              >
                <ion-icon name="shield-outline" slot="start"></ion-icon>
                Make Admin
              </ion-button>

              <!-- Revoke Admin -->
              <ion-button
                *ngIf="
                  (selectedFilter === 'all' ||
                    selectedFilter === 'admins') &&
                  member.role === 'admin' &&
                  member.id !== currentAdminId &&
                  member.status === 'active'
                "
                fill="clear"
                size="small"
                class="action-button revoke-btn"
                (click)="revokeAdminStatus(member)"
              >
                <ion-icon
                  name="person-remove-outline"
                  slot="start"
                ></ion-icon>
                Revoke Admin
              </ion-button>

              <!-- Remove Member -->
              <ion-button
                *ngIf="
                  selectedFilter !== 'removed' &&
                  member.id !== currentAdminId &&
                  member.status === 'active'
                "
                fill="clear"
                size="small"
                color="danger"
                class="action-button remove-btn"
                (click)="removeMember(member)"
              >
                <ion-icon name="trash-outline" slot="start"></ion-icon>
                Remove
              </ion-button>

              <!-- Readmit Member -->
              <ion-button
                *ngIf="selectedFilter === 'removed' && member.status === 'inactive'"
                fill="clear"
                size="small"
                color="success"
                class="action-button readmit-btn"
                (click)="readmitMember(member)"
              >
                <ion-icon
                  name="checkmark-circle-outline"
                  slot="start"
                ></ion-icon>
                Readmit
              </ion-button>
            </div>
          </ion-item>

          <!-- Empty State -->
          <ion-item
            *ngIf="filteredMembers.length === 0 && !isLoading"
            lines="none"
            class="empty-state"
          >
            <ion-label class="ion-text-center">
              <ion-icon name="people-outline" size="large"></ion-icon>
              <h2>No members found</h2>
              <p>Try adjusting your search or filters</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>