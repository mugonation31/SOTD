<ion-header>
  <ion-toolbar>
    <div class="logo-container" (click)="navigateTo('/group-admin/dashboard')">
      <ion-icon name="football-outline" class="football-icon"></ion-icon>
      <div class="logo-text">
        <span class="logo-sotd">SOTD</span>
        <span class="logo-subtitle">Predict 3</span>
      </div>
    </div>
    <ion-buttons slot="end">
      <ion-button (click)="navigateTo('/group-admin/settings')">
        <ion-icon name="person-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <ion-segment [(ngModel)]="selectedTab" (ionChange)="tabChanged()">
      <ion-segment-button value="my">
        <ion-label>Make Predictions</ion-label>
      </ion-segment-button>
      <ion-segment-button value="all">
        <ion-label>All Predictions</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Make Predictions Tab -->
  <div *ngIf="selectedTab === 'my'">
    <!-- Gameweek Navigation Header -->
    <div class="gameweek-header">
      <ion-button fill="clear" (click)="navigateGameweek(-1)" [disabled]="currentGameWeek.number <= 1">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
      
      <div class="gameweek-info">
        <h2>Game Week {{ currentGameWeek.number }}</h2>
        <ion-badge color="primary">Predict 3</ion-badge>
      </div>
      
      <ion-button fill="clear" (click)="navigateGameweek(1)" [disabled]="currentGameWeek.number >= 38">
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </ion-button>
    </div>

    <!-- Deadline Info -->
    <div class="deadline-info-header">
      <div class="deadline-text">
        <ion-icon name="time-outline"></ion-icon>
        <span>Deadline: {{ currentGameWeek.deadline | date:'MMM d, yyyy, h:mm a' }}</span>
      </div>
      <ion-button fill="clear" size="small" (click)="resetPredictions()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        RESET ALL
      </ion-button>
    </div>

    <div class="selection-info-text">
      Make any 3 predictions for this game week
    </div>

    <!-- Match Cards -->
    <div class="match-cards">
      <div class="match-card" *ngFor="let match of currentGameWeek.matches">
        <div class="match-header">
          <div class="venue">
            <ion-icon name="footballOutline"></ion-icon>
            {{ match.venue }}
          </div>
          <div class="kickoff">
            <ion-icon name="time-outline"></ion-icon>
            {{ match.kickoff | date:'EEEE d MMM HH:mm' }}
          </div>
        </div>
        
        <div class="match-prediction">
          <div class="team-name">{{ getShortTeamName(match.homeTeam) }}</div>
          
          <div class="score-inputs">
            <input 
              type="tel" 
              maxlength="2" 
              [(ngModel)]="match.homeScore"
              (input)="onScoreChange(match)"
              placeholder="-"
              class="score-input">
            <span class="separator">-</span>
            <input 
              type="tel" 
              maxlength="2" 
              [(ngModel)]="match.awayScore"
              (input)="onScoreChange(match)"
              placeholder="-"
              class="score-input">
          </div>
          
          <div class="team-name">{{ getShortTeamName(match.awayTeam) }}</div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <ion-button expand="block" class="submit-button" [disabled]="!canSubmit" (click)="onSubmitPredictions()">
      Submit Predictions
    </ion-button>
  </div>

  <!-- All Predictions Tab - Keep existing -->
  <div *ngIf="selectedTab === 'all'" class="content-wrapper all-predictions">
    <!-- Gameweek Navigation -->
    <div class="gameweek-navigation">
      <ion-button
        fill="clear"
        (click)="previousGameweek()"
        [disabled]="currentGameweekIndex === 0"
      >
        <ion-icon name="chevron-back"></ion-icon>
      </ion-button>
      <div class="gameweek-info">
        <h2>Gameweek {{ selectedGameweek.number }}</h2>
        <ion-chip [color]="getGameweekStatusColor(selectedGameweek.status)">
          {{ selectedGameweek.status | titlecase }}
        </ion-chip>
        <div *ngIf="selectedGameweek.isSpecial" class="special-indicator">
          <ion-icon name="star" color="warning"></ion-icon>
          {{ getSpecialWeekLabel(selectedGameweek.specialType) }}
        </div>
      </div>
      <ion-button
        fill="clear"
        (click)="nextGameweek()"
        [disabled]="currentGameweekIndex === gameweeks.length - 1"
      >
        <ion-icon name="chevron-forward"></ion-icon>
      </ion-button>
    </div>

    <!-- Search and Filter -->
    <div class="search-filter">
      <ion-searchbar
        [(ngModel)]="searchTerm"
        placeholder="Search players..."
        (ionInput)="filterPredictions()"
        class="player-search"
      >
      </ion-searchbar>
      <ion-select
        [(ngModel)]="filterStatus"
        (ionChange)="filterPredictions()"
        placeholder="Filter by status"
        interface="popover"
      >
        <ion-select-option value="all">All Predictions</ion-select-option>
        <ion-select-option value="my">My Predictions</ion-select-option>
        <ion-select-option value="submitted">Submitted</ion-select-option>
        <ion-select-option value="pending">Pending</ion-select-option>
      </ion-select>
    </div>

    <!-- Players Predictions List -->
    <div class="players-list">
      <ion-card
        *ngFor="let player of filteredPredictions"
        class="player-card"
      >
        <ion-card-header>
          <div class="player-header">
            <div class="name-section">
              <div class="name-and-avatar">
                <ion-avatar *ngIf="player.avatar">
                  <img [src]="player.avatar" alt="avatar" />
                </ion-avatar>
                <h3>{{ player.playerName }}</h3>
              </div>
              <ion-chip *ngIf="player.jokerUsed" color="warning">
                <ion-icon name="star"></ion-icon>
                <ion-label>Joker Used</ion-label>
              </ion-chip>
            </div>
            <div class="player-info">
              <div class="total-points">
                Total Points: {{ player.totalPoints }}
              </div>
            </div>
          </div>
        </ion-card-header>

        <ion-card-content>
          <div
            class="predictions-grid"
            [class.special-week]="selectedGameweek.isSpecial"
          >
            <div
              *ngFor="let pred of player.predictions"
              class="prediction-item"
            >
              <div class="match-info">
                <div class="venue-info">
                  <span class="venue-name">{{ pred.venue }}</span>
                  <span class="kickoff">{{
                    pred.kickoff | date : 'EEE d MMM, HH:mm'
                  }}</span>
                </div>
              </div>
              <div class="teams-score">
                <span class="team home">{{ pred.homeTeam }}</span>
                <div
                  class="score"
                  [class.pending]="!pred.homeScore && !pred.awayScore"
                >
                  {{ pred.homeScore ?? '-' }} - {{ pred.awayScore ?? '-' }}
                </div>
                <span class="team away">{{ pred.awayTeam }}</span>
              </div>

              <!-- Prediction Result -->
              <div
                class="prediction-result"
                *ngIf="selectedGameweek.status === 'completed'"
              >
                <div
                  class="points"
                  [class.high-points]="(pred.points || 0) >= 9"
                >
                  {{ pred.points }} pts
                </div>
                <div class="accuracy">
                  <div class="accuracy-item">
                    <ion-icon
                      [name]="
                        pred.isCorrectScore
                          ? 'checkmark-circle'
                          : 'close-circle'
                      "
                      [color]="pred.isCorrectScore ? 'success' : 'medium'"
                    >
                    </ion-icon>
                    <span>Score</span>
                  </div>
                  <div class="accuracy-item">
                    <ion-icon
                      [name]="
                        pred.isCorrectResult
                          ? 'checkmark-circle'
                          : 'close-circle'
                      "
                      [color]="pred.isCorrectResult ? 'success' : 'medium'"
                    >
                    </ion-icon>
                    <span>Result</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>

<ion-alert 
  [isOpen]="showTooManyPredictionsWarning" 
  header="Warning" 
  message="You can't make more than 3 predictions for this game week" 
  [buttons]="['OK']"
  (didDismiss)="showTooManyPredictionsWarning = false">
</ion-alert>