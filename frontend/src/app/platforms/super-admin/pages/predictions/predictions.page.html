<ion-header>
  <ion-toolbar>
    <ion-title>Prediction Intelligence & Analytics Center</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <ion-segment [(ngModel)]="activeTab" value="analytics">
      <ion-segment-button value="analytics">
        <ion-label>Platform Analytics</ion-label>
      </ion-segment-button>
      <ion-segment-button value="performance">
        <ion-label>Performance Intelligence</ion-label>
      </ion-segment-button>
      <ion-segment-button value="behavior">
        <ion-label>User Behavior</ion-label>
      </ion-segment-button>
      <ion-segment-button value="interventions">
        <ion-label>Smart Interventions</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Platform Analytics Tab -->
  <div *ngIf="activeTab === 'analytics'">
    <!-- Prediction Platform Health Overview -->
    <div class="platform-health">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Prediction Platform Health Overview</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="health-metrics">
            <div class="metric-item">
              <div class="metric-icon">
                <ion-icon name="pulse-outline" color="primary"></ion-icon>
              </div>
              <div class="metric-info">
                <h3>{{ getPlatformHealthScore() }}/100</h3>
                <p>Platform Health Score</p>
              </div>
            </div>
            <div class="metric-item">
              <div class="metric-icon">
                <ion-icon name="trending-up-outline" color="success"></ion-icon>
              </div>
              <div class="metric-info">
                <h3>{{ getPredictionEngagementRate() }}%</h3>
                <p>Weekly Engagement Rate</p>
              </div>
            </div>
            <div class="metric-item">
              <div class="metric-icon">
                <ion-icon name="stats-chart-outline" color="secondary"></ion-icon>
              </div>
              <div class="metric-info">
                <h3>{{ getAveragePredictionAccuracy() }}%</h3>
                <p>Platform Avg Accuracy</p>
              </div>
            </div>
            <div class="metric-item">
              <div class="metric-icon">
                <ion-icon name="trophy-outline" color="warning"></ion-icon>
              </div>
              <div class="metric-info">
                <h3>{{ getTopPerformersCount() }}</h3>
                <p>Elite Predictors (90%+)</p>
              </div>
            </div>
            <div class="metric-item">
              <div class="metric-icon">
                <ion-icon name="warning-outline" color="danger"></ion-icon>
              </div>
              <div class="metric-info">
                <h3>{{ getUnderperformersCount() }}</h3>
                <p>Need Support (<40%)</p>
              </div>
            </div>
            <div class="metric-item">
              <div class="metric-icon">
                <ion-icon name="star-outline" color="tertiary"></ion-icon>
              </div>
              <div class="metric-info">
                <h3>{{ getJokerOptimizationRate() }}%</h3>
                <p>Joker Optimization Rate</p>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Real-time Submission Monitoring -->
    <div class="submission-monitoring">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Current Gameweek {{ currentGameweek }} - Live Monitoring</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="submission-stats">
            <div class="submission-metric">
              <span class="label">Submissions:</span>
              <span class="value">{{ getCurrentSubmissions() }}/{{ getTotalActivePlayers() }}</span>
              <ion-progress-bar [value]="getSubmissionProgress()" [color]="getSubmissionProgressColor()"></ion-progress-bar>
            </div>
            <div class="submission-metric">
              <span class="label">Time Remaining:</span>
              <span class="value">{{ getTimeRemaining() }}</span>
            </div>
            <div class="submission-metric">
              <span class="label">Late Submissions:</span>
              <span class="value">{{ getLateSubmissions() }}</span>
            </div>
            <div class="submission-metric">
              <span class="label">Quality Score:</span>
              <span class="value">{{ getAverageSubmissionQuality() }}/10</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Strategic Prediction Insights -->
    <div class="strategic-insights">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Strategic Prediction Insights</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="insights-grid">
            <div class="insight-card">
              <h4>üìà Trending Patterns</h4>
              <p><strong>Defensive Strategy Rise:</strong> 65% increase in low-scoring predictions this week</p>
              <p><strong>Joker Timing:</strong> Peak usage shifts to high-value matches</p>
            </div>
            <div class="insight-card">
              <h4>üéØ Accuracy Hotspots</h4>
              <p><strong>Best Performers:</strong> Premier League predictions (78% accuracy)</p>
              <p><strong>Challenge Areas:</strong> Europa League matches (52% accuracy)</p>
            </div>
            <div class="insight-card">
              <h4>‚ö° Engagement Drivers</h4>
              <p><strong>High Stakes:</strong> Derby matches drive 23% more engagement</p>
              <p><strong>Social Factor:</strong> Group rivalry increases participation by 31%</p>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Performance Intelligence Tab -->
  <div *ngIf="activeTab === 'performance'">
    <!-- Performance Distribution Analytics -->
    <div class="performance-analytics">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Platform Performance Distribution</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="performance-tiers">
            <div class="tier elite">
              <h3>üèÜ Elite Tier (90%+ Accuracy)</h3>
              <div class="tier-stats">
                <span>{{ getElitePredictors().length }} users</span>
                <span>Avg: {{ getEliteAverageAccuracy() }}%</span>
                <span>Retention: {{ getEliteRetentionRate() }}%</span>
              </div>
            </div>
            <div class="tier champion">
              <h3>ü•á Champion Tier (70-89%)</h3>
              <div class="tier-stats">
                <span>{{ getChampionPredictors().length }} users</span>
                <span>Avg: {{ getChampionAverageAccuracy() }}%</span>
                <span>Growth: {{ getChampionGrowthRate() }}%</span>
              </div>
            </div>
            <div class="tier contender">
              <h3>‚≠ê Contender Tier (50-69%)</h3>
              <div class="tier-stats">
                <span>{{ getContenderPredictors().length }} users</span>
                <span>Avg: {{ getContenderAverageAccuracy() }}%</span>
                <span>Potential: {{ getContenderPotential() }}% upside</span>
              </div>
            </div>
            <div class="tier developing">
              <h3>üìö Developing Tier (<50%)</h3>
              <div class="tier-stats">
                <span>{{ getDevelopingPredictors().length }} users</span>
                <span>Support Needed: {{ getDevelopingSupportCount() }} users</span>
                <span>Intervention Ready: {{ getDevelopingInterventionCount() }}</span>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Top Performers Intelligence -->
    <div class="top-performers">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Top Performers Deep Analytics</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="performers-grid">
            <ion-card *ngFor="let performer of getTopPerformers()" class="performer-card">
              <ion-card-header>
                <ion-card-title>{{ performer.name }}</ion-card-title>
                <ion-card-subtitle>{{ performer.groupName }}</ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <div class="performer-stats">
                  <div class="stat-row">
                    <span>Accuracy:</span>
                    <ion-badge color="success">{{ performer.accuracy }}%</ion-badge>
                  </div>
                  <div class="stat-row">
                    <span>Strategy:</span>
                    <span>{{ performer.strategy }}</span>
                  </div>
                  <div class="stat-row">
                    <span>Joker Efficiency:</span>
                    <span>{{ performer.jokerEfficiency }}%</span>
                  </div>
                  <div class="stat-row">
                    <span>Consistency:</span>
                    <span>{{ performer.consistencyScore }}/10</span>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- User Behavior Tab -->
  <div *ngIf="activeTab === 'behavior'">
    <!-- Prediction Behavior Patterns -->
    <div class="behavior-patterns">
      <ion-card>
        <ion-card-header>
          <ion-card-title>User Prediction Behavior Intelligence</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="behavior-insights">
            <div class="behavior-section">
              <h4>üïê Submission Timing Patterns</h4>
              <div class="timing-stats">
                <div class="timing-item">
                  <span>Early Birds (>48h before):</span>
                  <span>{{ getEarlySubmitters() }}% - Higher accuracy</span>
                </div>
                <div class="timing-item">
                  <span>Strategic (24-48h):</span>
                  <span>{{ getStrategicSubmitters() }}% - Best joker usage</span>
                </div>
                <div class="timing-item">
                  <span>Last Minute (<2h):</span>
                  <span>{{ getLastMinuteSubmitters() }}% - Stress indicators</span>
                </div>
              </div>
            </div>

            <div class="behavior-section">
              <h4>üé≤ Risk Profile Distribution</h4>
              <div class="risk-profiles">
                <div class="risk-item conservative">
                  <h5>Conservative Predictors</h5>
                  <p>{{ getConservativePredictors() }}% of users</p>
                  <p>Strategy: Safe bets, consistent performance</p>
                </div>
                <div class="risk-item balanced">
                  <h5>Balanced Strategists</h5>
                  <p>{{ getBalancedPredictors() }}% of users</p>
                  <p>Strategy: Mix of safe and bold predictions</p>
                </div>
                <div class="risk-item aggressive">
                  <h5>High-Risk Takers</h5>
                  <p>{{ getAggressivePredictors() }}% of users</p>
                  <p>Strategy: Bold predictions, high variance</p>
                </div>
              </div>
            </div>

            <div class="behavior-section">
              <h4>üÉè Joker Usage Intelligence</h4>
              <div class="joker-intelligence">
                <div class="joker-stat">
                  <span>Optimal Timing:</span>
                  <span>{{ getOptimalJokerUsers() }}% use data-driven timing</span>
                </div>
                <div class="joker-stat">
                  <span>Emotional Decisions:</span>
                  <span>{{ getEmotionalJokerUsers() }}% use team bias</span>
                </div>
                <div class="joker-stat">
                  <span>Strategic Efficiency:</span>
                  <span>{{ getJokerEfficiencyRate() }}% above-average performance</span>
                </div>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Smart Interventions Tab -->
  <div *ngIf="activeTab === 'interventions'">
    <!-- Automated Intervention Recommendations -->
    <div class="intervention-center">
      <ion-card>
        <ion-card-header>
          <ion-card-title>AI-Powered Intervention Center</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="intervention-categories">
            
            <!-- Performance Improvement Interventions -->
            <div class="intervention-category">
              <h4>üìà Performance Enhancement ({{ getPerformanceInterventions().length }} users)</h4>
              <div class="intervention-items">
                <div *ngFor="let intervention of getPerformanceInterventions()" class="intervention-item">
                  <div class="intervention-user">
                    <h5>{{ intervention.userName }}</h5>
                    <p>{{ intervention.groupName }} - {{ intervention.currentAccuracy }}% accuracy</p>
                  </div>
                  <div class="intervention-recommendation">
                    <p><strong>Issue:</strong> {{ intervention.issue }}</p>
                    <p><strong>Recommendation:</strong> {{ intervention.recommendation }}</p>
                  </div>
                  <div class="intervention-actions">
                    <ion-button size="small" fill="outline" color="primary" (click)="sendPredictionTips(intervention)">
                      Send Tips
                    </ion-button>
                    <ion-button size="small" fill="outline" color="secondary" (click)="assignMentor(intervention)">
                      Assign Mentor
                    </ion-button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Engagement Recovery Interventions -->
            <div class="intervention-category">
              <h4>üéØ Engagement Recovery ({{ getEngagementInterventions().length }} users)</h4>
              <div class="intervention-items">
                <div *ngFor="let intervention of getEngagementInterventions()" class="intervention-item">
                  <div class="intervention-user">
                    <h5>{{ intervention.userName }}</h5>
                    <p>{{ intervention.missedSubmissions }} missed submissions</p>
                  </div>
                  <div class="intervention-recommendation">
                    <p><strong>Pattern:</strong> {{ intervention.pattern }}</p>
                    <p><strong>Suggested Action:</strong> {{ intervention.action }}</p>
                  </div>
                  <div class="intervention-actions">
                    <ion-button size="small" fill="outline" color="warning" (click)="sendReEngagementCampaign(intervention)">
                      Re-engage
                    </ion-button>
                    <ion-button size="small" fill="outline" color="tertiary" (click)="offerIncentive(intervention)">
                      Offer Incentive
                    </ion-button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Behavioral Optimization -->
            <div class="intervention-category">
              <h4>üß† Behavioral Optimization ({{ getBehaviorInterventions().length }} users)</h4>
              <div class="intervention-items">
                <div *ngFor="let intervention of getBehaviorInterventions()" class="intervention-item">
                  <div class="intervention-user">
                    <h5>{{ intervention.userName }}</h5>
                    <p>{{ intervention.behaviorType }} - Optimization potential</p>
                  </div>
                  <div class="intervention-recommendation">
                    <p><strong>Opportunity:</strong> {{ intervention.opportunity }}</p>
                    <p><strong>Strategy:</strong> {{ intervention.strategy }}</p>
                  </div>
                  <div class="intervention-actions">
                    <ion-button size="small" fill="outline" color="success" (click)="sendPersonalizedCoaching(intervention)">
                      Personal Coach
                    </ion-button>
                    <ion-button size="small" fill="outline" color="primary" (click)="recommendStrategy(intervention)">
                      Strategy Guide
                    </ion-button>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Intervention Impact Tracking -->
    <div class="intervention-impact">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Intervention Impact Analytics</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="impact-metrics">
            <div class="impact-item">
              <h4>Success Rate</h4>
              <p>{{ getInterventionSuccessRate() }}% of users show improvement</p>
            </div>
            <div class="impact-item">
              <h4>Engagement Boost</h4>
              <p>{{ getEngagementImprovement() }}% average engagement increase</p>
            </div>
            <div class="impact-item">
              <h4>Accuracy Gains</h4>
              <p>{{ getAccuracyImprovement() }}% average accuracy improvement</p>
            </div>
            <div class="impact-item">
              <h4>Retention Impact</h4>
              <p>{{ getRetentionImprovement() }}% better retention rate</p>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>