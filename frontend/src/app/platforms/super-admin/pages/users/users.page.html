<ion-header *ngIf="!embedded">
  <ion-toolbar>
    <ion-title>Platform User Management</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <ion-segment [(ngModel)]="activeTab" value="admins">
      <ion-segment-button value="admins">
        <ion-label>Group Admins</ion-label>
      </ion-segment-button>
      <ion-segment-button value="all">
        <ion-label>All Users</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<!-- Content Container (different for embedded vs standalone) -->
<div [ngClass]="embedded ? 'embedded-content' : 'standalone-content'">
  <ion-content *ngIf="!embedded">
    <div class="content-wrapper">
      <ng-container *ngTemplateOutlet="mainContent"></ng-container>
    </div>
</ion-content>
  
  <div *ngIf="embedded" class="content-wrapper">
    <ng-container *ngTemplateOutlet="mainContent"></ng-container>
  </div>
</div>

<!-- Main Content Template -->
<ng-template #mainContent>
  <!-- Embedded Segment (only when embedded) -->
  <div *ngIf="embedded" class="embedded-segment">
    <ion-segment [(ngModel)]="activeTab" value="admins">
      <ion-segment-button value="admins">
        <ion-label>Group Admins</ion-label>
      </ion-segment-button>
      <ion-segment-button value="all">
        <ion-label>All Users</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>
  
  <div class="ion-padding">
    <!-- Admin Overview Tab -->
    <div *ngIf="activeTab === 'admins'">
      <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2>ðŸŽ¯ Group Admins Management</h2>
        <p><strong>Total Group Admins:</strong> {{ getGroupAdmins().length }}</p>
        <p><strong>Average Health Score:</strong> {{ getAverageAdminHealth() }}/100</p>
        <p><strong>Admins Needing Attention:</strong> {{ getAdminsNeedingAttention().length }}</p>
      </div>
      
      <!-- Admin Cards Grid -->
      <div class="admin-cards">
        <ion-card *ngFor="let admin of getGroupAdmins() | slice:0:6" class="admin-card">
          <ion-card-header>
            <ion-card-title>{{ admin.name }}</ion-card-title>
            <ion-card-subtitle>{{ admin.email }}</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p><strong>Health Score:</strong> {{ admin.health?.score || 'N/A' }}/100</p>
            <p><strong>Groups Managed:</strong> {{ admin.performance?.groupsManaged || 0 }}</p>
            <p><strong>Status:</strong> 
              <ion-badge [color]="getAdminHealthStatusColor(admin.health?.status || 'unknown')">
                {{ admin.health?.status || 'Unknown' }}
              </ion-badge>
            </p>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- All Users Tab -->
    <div *ngIf="activeTab === 'all'">
      <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2>ðŸ‘¥ Platform Users Management</h2>
        <p><strong>Total Platform Users:</strong> {{ getPlatformUsers().length }}</p>
        <p><strong>Average User Health:</strong> {{ getAverageUserHealth() }}/100</p>
        <p><strong>Users Needing Attention:</strong> {{ getUsersNeedingAttention().length }}</p>
      </div>
      
      <!-- User Cards Grid -->
      <div class="user-cards">
        <ion-card *ngFor="let user of getPlatformUsers() | slice:0:6" class="user-card">
          <ion-card-header>
            <ion-card-title>{{ user.name }}</ion-card-title>
            <ion-card-subtitle>{{ user.email }}</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p><strong>Health Score:</strong> {{ user.userHealth?.score || 'N/A' }}/100</p>
            <p><strong>Days on Platform:</strong> {{ user.userLifecycle?.daysOnPlatform || 0 }}</p>
            <p><strong>Status:</strong> 
              <ion-badge [color]="getUserHealthStatusColor(user.userHealth?.status || 'unknown')">
                {{ user.userHealth?.status || 'Unknown' }}
              </ion-badge>
            </p>
          </ion-card-content>
        </ion-card>
      </div>
    </div>
  </div>
</ng-template>