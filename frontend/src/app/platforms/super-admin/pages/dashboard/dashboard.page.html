<ion-header>
  <ion-toolbar>
    <ion-title>System Overview</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Quick Stats -->
  <ion-grid>
    <ion-row>
      <ion-col size="12" sizeMd="6" sizeLg="3">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="layers-outline" color="primary"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>{{ overview.totalGroups }}</h3>
              <p>Total Groups</p>
              <ion-badge color="success"
                >{{ overview.activeGroups }} Active</ion-badge
              >
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="12" sizeMd="6" sizeLg="3">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="people-outline" color="secondary"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>{{ overview.totalUsers }}</h3>
              <p>Total Users</p>
              <ion-badge color="success"
                >{{ overview.activeUsers }} Active</ion-badge
              >
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="12" sizeMd="6" sizeLg="3">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="football-outline" color="tertiary"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>Gameweek {{ overview.currentGameweek }}</h3>
              <p>Current Gameweek</p>
              <ion-badge color="warning">
                {{ overview.submittedPredictions }}/{{
                  overview.totalPredictions
                }}
                Predictions
              </ion-badge>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="12" sizeMd="6" sizeLg="3">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="time-outline" color="danger"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>Next Deadline</h3>
              <p>{{ overview.nextDeadline | date : 'short' }}</p>
              <ion-badge color="danger">{{
                getTimeUntilDeadline()
              }}</ion-badge>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- New Stats Row -->
    <ion-row>
      <ion-col size="12" sizeMd="4">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="star-outline" color="warning"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>Joker Usage</h3>
              <p>
                First Joker: {{ overview.jokerStats.firstJokerUsed }}/{{
                  overview.jokerStats.totalEligible
                }}
              </p>
              <p>
                Second Joker: {{ overview.jokerStats.secondJokerUsed }}/{{
                  overview.jokerStats.totalEligible
                }}
              </p>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="12" sizeMd="4">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="calendar-outline" color="tertiary"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>Special Events</h3>
              <p>{{ getNextEventDisplay() }}</p>
              <ion-badge
                color="tertiary"
                *ngIf="overview.specialEvents.nextEvent"
              >
                In {{ overview.specialEvents.daysUntil }} days
              </ion-badge>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="12" sizeMd="4">
        <ion-card class="stat-card">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="wallet-outline" color="success"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>Payment Status</h3>
              <p>
                {{ overview.paymentStats.totalPaid }}/{{
                  overview.paymentStats.totalGroups
                }}
                Groups Paid
              </p>
              <ion-badge
                color="warning"
                *ngIf="overview.paymentStats.totalPending > 0"
              >
                {{ overview.paymentStats.totalPending }} Pending
              </ion-badge>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Business Intelligence -->
  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Business Intelligence & Analytics</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <!-- Growth Metrics Row -->
            <ion-grid>
              <ion-row>
                <ion-col size="12" sizeMd="6" sizeLg="3">
                  <div class="bi-card growth">
                    <div class="bi-icon">
                      <ion-icon name="trending-up-outline" color="success"></ion-icon>
                    </div>
                    <div class="bi-info">
                      <h3>Growth Metrics</h3>
                      <p>{{ businessIntelligence.growth.newUsersThisWeek }} new users this week</p>
                      <p>{{ businessIntelligence.growth.newGroupsThisWeek }} new groups this week</p>
                      <ion-badge color="success">
                        +{{ businessIntelligence.growth.growthRateWeekly }}% weekly
                      </ion-badge>
                    </div>
                  </div>
                </ion-col>

                <ion-col size="12" sizeMd="6" sizeLg="3">
                  <div class="bi-card revenue">
                    <div class="bi-icon">
                      <ion-icon name="cash-outline" color="warning"></ion-icon>
                    </div>
                    <div class="bi-info">
                      <h3>Revenue Analytics</h3>
                      <p>${{ businessIntelligence.revenue.monthlyRecurringRevenue | number:'1.0-0' }} MRR</p>
                      <p>${{ businessIntelligence.revenue.averageRevenuePerUser | number:'1.2-2' }} ARPU</p>
                      <ion-badge color="warning">
                        {{ businessIntelligence.revenue.conversionRate }}% conversion
                      </ion-badge>
                    </div>
                  </div>
                </ion-col>

                <ion-col size="12" sizeMd="6" sizeLg="3">
                  <div class="bi-card engagement">
                    <div class="bi-icon">
                      <ion-icon name="pulse-outline" color="tertiary"></ion-icon>
                    </div>
                    <div class="bi-info">
                      <h3>User Engagement</h3>
                      <p>{{ businessIntelligence.engagement.dailyActiveUsers }} daily active users</p>
                      <p>{{ businessIntelligence.engagement.averageSessionDuration | number:'1.1-1' }}min avg session</p>
                      <ion-badge color="tertiary">
                        {{ businessIntelligence.engagement.retentionRate }}% retention
                      </ion-badge>
                    </div>
                  </div>
                </ion-col>

                <ion-col size="12" sizeMd="6" sizeLg="3">
                  <div class="bi-card adoption">
                    <div class="bi-icon">
                      <ion-icon name="stats-chart-outline" color="secondary"></ion-icon>
                    </div>
                    <div class="bi-info">
                      <h3>Feature Adoption</h3>
                      <p>{{ businessIntelligence.adoption.featuresUsed.predictions }}% use predictions</p>
                      <p>{{ businessIntelligence.adoption.featuresUsed.jokers }}% use jokers</p>
                      <ion-badge color="secondary">
                        {{ businessIntelligence.adoption.platformUsage.mobile }}% mobile
                      </ion-badge>
                    </div>
                  </div>
                </ion-col>
              </ion-row>

              <!-- Detailed Analytics Row -->
              <ion-row>
                <ion-col size="12" sizeMd="8">
                  <div class="analytics-details">
                    <h4>Platform Usage Breakdown</h4>
                    <ion-grid>
                      <ion-row>
                        <ion-col size="6">
                          <div class="usage-stat">
                            <ion-icon name="phone-portrait-outline" color="primary"></ion-icon>
                            <div>
                              <strong>{{ businessIntelligence.adoption.platformUsage.mobile }}%</strong>
                              <p>Mobile Users</p>
                            </div>
                          </div>
                        </ion-col>
                        <ion-col size="6">
                          <div class="usage-stat">
                            <ion-icon name="desktop-outline" color="primary"></ion-icon>
                            <div>
                              <strong>{{ businessIntelligence.adoption.platformUsage.web }}%</strong>
                              <p>Web Users</p>
                            </div>
                          </div>
                        </ion-col>
                      </ion-row>
                    </ion-grid>

                    <h4>Feature Usage Statistics</h4>
                    <div class="feature-stats">
                      <div class="feature-bar">
                        <span>Predictions</span>
                        <div class="bar">
                          <div class="fill" [style.width.%]="businessIntelligence.adoption.featuresUsed.predictions"></div>
                        </div>
                        <span>{{ businessIntelligence.adoption.featuresUsed.predictions }}%</span>
                      </div>
                      <div class="feature-bar">
                        <span>Leaderboards</span>
                        <div class="bar">
                          <div class="fill" [style.width.%]="businessIntelligence.adoption.featuresUsed.leaderboards"></div>
                        </div>
                        <span>{{ businessIntelligence.adoption.featuresUsed.leaderboards }}%</span>
                      </div>
                      <div class="feature-bar">
                        <span>Jokers</span>
                        <div class="bar">
                          <div class="fill" [style.width.%]="businessIntelligence.adoption.featuresUsed.jokers"></div>
                        </div>
                        <span>{{ businessIntelligence.adoption.featuresUsed.jokers }}%</span>
                      </div>
                      <div class="feature-bar">
                        <span>Group Chat</span>
                        <div class="bar">
                          <div class="fill" [style.width.%]="businessIntelligence.adoption.featuresUsed.groupChat"></div>
                        </div>
                        <span>{{ businessIntelligence.adoption.featuresUsed.groupChat }}%</span>
                      </div>
                    </div>
                  </div>
                </ion-col>

                <ion-col size="12" sizeMd="4">
                  <div class="top-groups">
                    <h4>Top Performing Groups</h4>
                    <ion-list>
                      <ion-item *ngFor="let group of businessIntelligence.adoption.topGroups" lines="none">
                        <ion-icon name="trophy-outline" slot="start" color="warning"></ion-icon>
                        <ion-label>
                          <h3>{{ group.name }}</h3>
                          <p>{{ group.members }} members</p>
                        </ion-label>
                        <ion-badge color="success" slot="end">
                          {{ group.engagement }}%
                        </ion-badge>
                      </ion-item>
                    </ion-list>
                  </div>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- System Status & Actions -->
  <ion-grid>
    <ion-row>
      <ion-col size="12" sizeMd="6">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Quick Actions</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-button
              expand="block"
              (click)="manageSpecialEvent()"
              class="ion-margin-bottom"
            >
              <ion-icon name="calendar-outline" slot="start"></ion-icon>
              Manage Special Events
            </ion-button>

            <ion-button
              expand="block"
              (click)="manageJokers()"
              class="ion-margin-bottom"
            >
              <ion-icon name="star-outline" slot="start"></ion-icon>
              Manage Joker Rules
            </ion-button>

            <ion-button expand="block" (click)="managePayments()">
              <ion-icon name="wallet-outline" slot="start"></ion-icon>
              Payment Overview
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="12" sizeMd="6">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Recent Activity</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let activity of recentActivities">
                <ion-icon
                  [name]="getActivityIcon(activity.type)"
                  slot="start"
                  [color]="getActivityColor(activity.type)"
                >
                </ion-icon>
                <ion-label>
                  <h3>{{ activity.description }}</h3>
                  <p>{{ activity.timestamp | date : 'short' }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>