{"version":3,"file":"main.js","mappings":";;;;;;;;;;;;;;;;;;;;;;AACuD;AAIX;;;;;;AAQtC,MAAOE,YAAY;EAGvBC,YACUC,eAAgC,EAChCC,WAAwB,EACxBC,eAAgC,EAChCC,MAAc;IAHd,KAAAH,eAAe,GAAfA,eAAe;IACf,KAAAC,WAAW,GAAXA,WAAW;IACX,KAAAC,eAAe,GAAfA,eAAe;IACf,KAAAC,MAAM,GAANA,MAAM;IANR,KAAAC,QAAQ,GAAGP,sDAAS,CAACQ,gBAAgB,EAAE;EAO5C;EAEGC,QAAQA,CAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,+IAAA;MACZC,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC;MAErC;MACA;MAEA;MACA,MAAMH,KAAI,CAACI,iBAAiB,EAAE;MAE9BF,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC;IAAC;EAC/C;EAEA;;;EAGcC,iBAAiBA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAJ,+IAAA;MAC7B,IAAI;QACFC,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;QAEzC;QACA,IAAI,CAACE,MAAI,CAACR,QAAQ,EAAE;UAClB,MAAMS,cAAc,GAAGD,MAAI,CAACZ,eAAe,CAACc,kBAAkB,EAAE;UAChE,IAAID,cAAc,EAAE;YAClBJ,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC;YACzD,MAAMK,OAAO,SAASH,MAAI,CAACZ,eAAe,CAACgB,iBAAiB,EAAE;YAC9D,IAAID,OAAO,EAAE;cACXN,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC;cACjD;YACF;UACF;QACF;QAEA;QACA,MAAMO,OAAO,GAAGL,MAAI,CAACZ,eAAe,CAACkB,cAAc;QACnD,MAAMC,IAAI,GAAGP,MAAI,CAACZ,eAAe,CAACoB,WAAW;QAE7C,IAAIH,OAAO,IAAIE,IAAI,EAAE;UACnBV,OAAO,CAACC,GAAG,CAAC,iDAAiD,CAAC;UAC9D;UACA,MAAME,MAAI,CAACX,WAAW,CAACoB,wBAAwB,EAAE;QACnD,CAAC,MAAM;UACLZ,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC;QAC7C;MAEF,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACvD;IAAC;EACH;EAEA;;;EAGcC,eAAeA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAhB,+IAAA;MAC3B,IAAI;QACF,MAAMW,IAAI,GAAGK,MAAI,CAACxB,eAAe,CAACoB,WAAW;QAC7C,MAAMK,OAAO,GAAGD,MAAI,CAACxB,eAAe,CAAC0B,cAAc;QAEnD,IAAIP,IAAI,IAAIM,OAAO,EAAE;UACnB;UACA,MAAME,YAAY,GAAG;YACnBC,KAAK,EAAE,wBAAwB;YAC/BT,IAAI,EAAE;cACJU,EAAE,EAAEJ,OAAO,CAACI,EAAE;cACdC,KAAK,EAAEL,OAAO,CAACK,KAAK;cACpBC,IAAI,EAAEN,OAAO,CAACM,IAAI;cAClBC,QAAQ,EAAEP,OAAO,CAACO,QAAQ;cAC1BC,SAAS,EAAER,OAAO,CAACS,UAAU;cAC7BC,QAAQ,EAAEV,OAAO,CAACW;;WAErB;UAED;UACAZ,MAAI,CAACvB,WAAW,CAAC,oBAAoB,CAAC,CAACoC,IAAI,CAACV,YAAY,CAAC;UAEzDlB,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC;QAC3D;MACF,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;MACtD;IAAC;EACH;;gBAzFWxB,YAAY;;mCAAZA,aAAY,EAAAwC,+DAAA,CAAAE,uEAAA,GAAAF,+DAAA,CAAAI,oEAAA,GAAAJ,+DAAA,CAAAM,6EAAA,GAAAN,+DAAA,CAAAQ,mDAAA;AAAA;;QAAZhD,aAAY;EAAAkD,SAAA;EAAAC,UAAA;EAAAC,QAAA,GAAAZ,iEAAA;EAAAc,KAAA;EAAAC,IAAA;EAAAC,QAAA,WAAAC,sBAAAC,EAAA,EAAAC,GAAA;IAAA,IAAAD,EAAA;MAFZlB,uDAAA,oBAA+B;;;iBADhC1C,yDAAY;EAAA+D,aAAA;AAAA,G;;;;;;;;;;;;;;;;;;;;;;;ACTwB;AACS;AACO;AAC1B;AACqB;AACc;AAChB;AACoC;AACzB;AAE7D,MAAMQ,SAAS,GAAsB;EAC1CC,SAAS,EAAE,CACTR,8DAAa,CAACG,+CAAM,CAAC,EACrBF,uEAAiB,EAAE,EACnBC,8EAAmB,EAAE,EACrBnB,oEAAW,EACXuB,sGAA2B,EAC3BrB,6EAAe,EACf;IAAEwB,OAAO,EAAEJ,mEAAiB;IAAEK,QAAQ,EAAEN,kFAAgB;IAAEO,KAAK,EAAE;EAAI,CAAE;CAE1E,C;;;;;;;;;;;;;;;;;ACpBiE;AAChB;AAE3C,MAAMR,MAAM,GAAW,CAC5B;EACEY,IAAI,EAAE,YAAY;EAClBC,SAAS,EAAEF,2DAAaA;CACzB,EACD;EACEC,IAAI,EAAE,SAAS;EACfE,WAAW,EAAE,CAACJ,gEAAW,CAAC;EAC1BK,YAAY,EAAEA,CAAA,KACZ,uLAA4C,CAACC,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACjB,MAAM;CACpE,EACD;EACEY,IAAI,EAAE,MAAM;EACZE,WAAW,EAAE,CAACJ,gEAAW,CAAC;EAC1BK,YAAY,EAAEA,CAAA,KACZ,4KAAsC,CAACC,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACjB,MAAM;CAC9D,EACD;EACEY,IAAI,EAAE,QAAQ;EACdE,WAAW,EAAE,CAACL,8DAAS,CAAC;EACxBS,IAAI,EAAE;IAAEC,YAAY,EAAE;EAAQ,CAAE;EAChCJ,YAAY,EAAEA,CAAA,KACZ,oLAA0C,CAACC,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACjB,MAAM;CAClE,EACD;EACEY,IAAI,EAAE,aAAa;EACnBE,WAAW,EAAE,CAACL,8DAAS,CAAC;EACxBS,IAAI,EAAE;IAAEC,YAAY,EAAE;EAAa,CAAE;EACrCJ,YAAY,EAAEA,CAAA,KACZ,mVAAoD,CAACC,IAAI,CACtDC,CAAC,IAAKA,CAAC,CAACjB,MAAM;CAEpB;AACD;AACA;EACEY,IAAI,EAAE,aAAa;EACnBG,YAAY,EAAEA,CAAA,KACZ,mVAAoD,CAACC,IAAI,CACtDC,CAAC,IAAKA,CAAC,CAACjB,MAAM;CAEpB,EACD;EACEY,IAAI,EAAE,EAAE;EACRQ,UAAU,EAAE,SAAS;EACrBC,SAAS,EAAE;CACZ;AACD;AACA;EACET,IAAI,EAAE,IAAI;EACVQ,UAAU,EAAE;CACb,CACF,C;;;;;;;;;;;;;;;;;;;;;;ACpD0C;;;;AAKrC,MAAOX,SAAS;EACpBzE,YACUI,MAAc,EACdF,WAAwB;IADxB,KAAAE,MAAM,GAANA,MAAM;IACN,KAAAF,WAAW,GAAXA,WAAW;EAClB;EAEKsF,aAAaA,CAACL,YAAqB;IACzC,QAAQA,YAAY;MAClB,KAAK,aAAa;QAChB,OAAO,oBAAoB;MAC7B;QACE,OAAO,aAAa;IACxB;EACF;EAEAL,WAAWA,CAACW,KAA6B;IACvC,OAAO,IAAI,CAACvF,WAAW,CAACmB,WAAW,CAACqE,IAAI,CACtCH,oDAAI,CAAC,CAAC,CAAC,EACPD,mDAAG,CAAC1D,YAAY,IAAG;MACjB,IAAI;QAAA,IAAA+D,WAAA;QACF;QACA,MAAMR,YAAY,IAAAQ,WAAA,GAAGF,KAAK,CAACP,IAAI,cAAAS,WAAA,uBAAVA,WAAA,CAAa,cAAc,CAAC;QAEjD;QACA,IAAI,CAAC/D,YAAY,IAAI,CAACA,YAAY,CAACR,IAAI,EAAE;UACvC,MAAMwE,UAAU,GAAG,IAAI,CAACJ,aAAa,CAACL,YAAY,CAAC;UACnD,IAAI,CAAC/E,MAAM,CAACyF,QAAQ,CAAC,CAACD,UAAU,CAAC,CAAC;UAClC,OAAO,KAAK;QACd;QAEA;QACA,MAAME,QAAQ,GAAGlE,YAAY,CAACR,IAAI,CAACY,IAAI;QAEvC;QACA,IAAI,CAACmD,YAAY,EAAE;UACjB,OAAO,IAAI;QACb;QAEA;QACA,IAAIW,QAAQ,KAAKX,YAAY,EAAE;UAC7B,OAAO,IAAI;QACb;QAEA;QACA,MAAMS,UAAU,GAAG,IAAI,CAACJ,aAAa,CAACL,YAAY,CAAC;QACnD,IAAI,CAAC/E,MAAM,CAACyF,QAAQ,CAAC,CAACD,UAAU,CAAC,CAAC;QAClC,OAAO,KAAK;MACd,CAAC,CAAC,OAAOrE,KAAK,EAAE;QAAA,IAAAwE,YAAA;QACd;QACA,MAAMH,UAAU,GAAG,IAAI,CAACJ,aAAa,EAAAO,YAAA,GAACN,KAAK,CAACP,IAAI,cAAAa,YAAA,uBAAVA,YAAA,CAAa,cAAc,CAAC,CAAC;QACnErF,OAAO,CAACa,KAAK,CAAC,2DAA2D,EAAEA,KAAK,CAAC;QACjF,IAAI,CAACnB,MAAM,CAACyF,QAAQ,CAAC,CAACD,UAAU,CAAC,CAAC;QAClC,OAAO,KAAK;MACd;IACF,CAAC,CAAC,CACH;EACH;;aAxDWnB,SAAS;;mCAATA,UAAS,EAAAlC,sDAAA,CAAAE,mDAAA,GAAAF,sDAAA,CAAAI,+DAAA;AAAA;;SAAT8B,UAAS;EAAAwB,OAAA,EAATxB,UAAS,CAAAyB,IAAA;EAAAC,UAAA,EADI;AAAM;AA6D1B,MAAOzB,WAAW;EACtB1E,YACUI,MAAc,EACdF,WAAwB;IADxB,KAAAE,MAAM,GAANA,MAAM;IACN,KAAAF,WAAW,GAAXA,WAAW;EAClB;EAEH4E,WAAWA,CAACW,KAA6B;IACvC,OAAO,IAAI,CAACvF,WAAW,CAACmB,WAAW,CAACqE,IAAI,CACtCH,oDAAI,CAAC,CAAC,CAAC,EACPD,mDAAG,CAAC1D,YAAY,IAAG;MACjB,IAAI;QAAA,IAAAwE,kBAAA;QACF;QACA,IAAI,EAAAA,kBAAA,GAAAX,KAAK,CAACY,WAAW,cAAAD,kBAAA,uBAAjBA,kBAAA,CAAmBxB,IAAI,MAAK,gBAAgB,EAAE;UAChD,OAAO,IAAI;QACb;QAEA;QACA,MAAM0B,UAAU,GAAG,IAAI,CAAClG,MAAM,CAACmG,GAAG;QAClC,IAAID,UAAU,CAACE,QAAQ,CAAC,gBAAgB,CAAC,EAAE;UACzC,OAAO,IAAI;QACb;QAEA,IAAI,CAAC5E,YAAY,IAAI,CAACA,YAAY,CAACR,IAAI,EAAE;UACvC,OAAO,IAAI,CAAC,CAAC;QACf;QAEA;QACA,MAAM0E,QAAQ,GAAGlE,YAAY,CAACR,IAAI,CAACY,IAAI;QAEvC;QACA;QACA,MAAMyE,YAAY,GAAG,IAAI,CAACvG,WAAW,CAACwG,eAAe,EAAE;QAEvD,IAAID,YAAY,EAAE;UAChB;UACA,QAAQX,QAAQ;YACd,KAAK,aAAa;cAChB,IAAI,CAAC1F,MAAM,CAACyF,QAAQ,CAAC,CAAC,wBAAwB,CAAC,CAAC;cAChD;YACF,KAAK,aAAa;cAChB,IAAI,CAACzF,MAAM,CAACyF,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC;cAC7C;YACF,KAAK,QAAQ;cACX,IAAI,CAACzF,MAAM,CAACyF,QAAQ,CAAC,CAAC,oBAAoB,CAAC,CAAC;cAC5C;YACF;cACE,IAAI,CAACzF,MAAM,CAACyF,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;UACtC;QACF,CAAC,MAAM;UACL;UACA,QAAQC,QAAQ;YACd,KAAK,aAAa;cAChB,IAAI,CAAC1F,MAAM,CAACyF,QAAQ,CAAC,CAAC,wBAAwB,CAAC,CAAC;cAChD;YACF,KAAK,aAAa;cAChB,IAAI,CAACzF,MAAM,CAACyF,QAAQ,CAAC,CAAC,wBAAwB,CAAC,CAAC;cAChD;YACF,KAAK,QAAQ;cACX,IAAI,CAACzF,MAAM,CAACyF,QAAQ,CAAC,CAAC,mBAAmB,CAAC,CAAC;cAC3C;YACF;cACE,IAAI,CAACzF,MAAM,CAACyF,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;UACtC;QACF;QAEA,OAAO,KAAK;MACd,CAAC,CAAC,OAAOtE,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;QAC7D,OAAO,IAAI,CAAC,CAAC;MACf;IACF,CAAC,CAAC,CACH;EACH;;eAxEWmD,WAAW;;mCAAXA,YAAW,EAAAnC,sDAAA,CAAAE,mDAAA,GAAAF,sDAAA,CAAAI,+DAAA;AAAA;;SAAX+B,YAAW;EAAAuB,OAAA,EAAXvB,YAAW,CAAAwB,IAAA;EAAAC,UAAA,EADE;AAAM,G;;;;;;;;;;;;;;;;;;;;AC1Dc;AACF;;;AAGtC,MAAOlC,gBAAgB;EAC3BjE,YAAoBI,MAAc;IAAd,KAAAA,MAAM,GAANA,MAAM;EAAW;EAErCyG,SAASA,CACPC,OAAyB,EACzBxE,IAAiB;IAEjB,OAAOA,IAAI,CAACyE,MAAM,CAACD,OAAO,CAAC,CAACpB,IAAI,CAC9BkB,0DAAU,CAAErF,KAAwB,IAAI;MACtC,IAAIA,KAAK,CAACyF,MAAM,KAAK,CAAC,EAAE;QACtB;QACAtG,OAAO,CAACa,KAAK,CAAC,gCAAgC,CAAC;MACjD;MACA,OAAOoF,gDAAU,CAAC,MAAMpF,KAAK,CAAC;IAChC,CAAC,CAAC,CACH;EACH;;oBAhBW0C,gBAAgB;;mCAAhBA,iBAAgB,EAAA1B,sDAAA,CAAAE,mDAAA;AAAA;;SAAhBwB,iBAAgB;EAAAgC,OAAA,EAAhBhC,iBAAgB,CAAAiC;AAAA,G;;;;;;;;;;;;;;;;;;;;;;;;;ACXyC;AACV;AACI;;;;AAUhE;AACA,MAAMkB,YAAY,GAAG;EACnBC,YAAY,EAAE,mBAAmB;EACjCC,aAAa,EAAE,mBAAmB;EAClCC,UAAU,EAAE,iBAAiB;EAC7BC,YAAY,EAAE,aAAa,CAAE;CACrB;AAEV;AACA,MAAMC,mBAAmB,GAAG,mBAAmB;AAC/C,MAAMC,sBAAsB,GAAG,IAAI,CAAC,CAAC;AA8BrC,MAAMC,eAAe,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;AACxC,MAAMC,kBAAkB,GAAG,CAAC;AAC5B,MAAMC,gBAAgB,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;AAKnC,MAAOjF,WAAW;EAmBtB5C,YACU8H,IAAgB,EAChB7H,eAAgC;IADhC,KAAA6H,IAAI,GAAJA,IAAI;IACJ,KAAA7H,eAAe,GAAfA,eAAe;IAlBjB,KAAA8H,MAAM,GAAGZ,kEAAW,CAACY,MAAM;IAG3B,KAAAC,gBAAgB,GAAW,EAAE;IAC7B,KAAAC,aAAa,GAAG,IAAIC,GAAG,EAG5B;IACK,KAAAC,WAAW,GAAG,IAAI,CAAC,CAAC;IACpB,KAAAC,4BAA4B,GAAG,KAAK;IACpC,KAAAC,aAAa,GAAG,KAAK;IACrB,KAAAC,uBAAuB,GAAG,KAAK,CAAC,CAAC;IACjC,KAAAC,eAAe,GAAG,KAAK,CAAC,CAAC;IACzB,KAAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC;IACd,KAAAC,qBAAqB,GAAG,IAAI,CAAC,CAAC;IAM7C;IACA,IAAI,CAACT,gBAAgB,GAAG,IAAI,CAACU,iBAAiB,EAAE;IAEhD,IAAI,CAACC,kBAAkB,GAAG,IAAI1B,iDAAe,CAAsB,IAAI,CAAC;IACxE,IAAI,CAAC5F,WAAW,GAAG,IAAI,CAACsH,kBAAkB,CAACC,YAAY,EAAE;IAEzD;IACA,IAAI,CAACC,cAAc,EAAE;EACvB;EAEA;EACAC,WAAWA,CAAA;IACT,IAAI,IAAI,CAACC,YAAY,EAAE;MACrBC,aAAa,CAAC,IAAI,CAACD,YAAY,CAAC;IAClC;IACA,IAAI,IAAI,CAACE,aAAa,EAAE;MACtBD,aAAa,CAAC,IAAI,CAACC,aAAa,CAAC;IACnC;IACAC,MAAM,CAACC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAACC,mBAAmB,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;EAC5E;EAEA;EACMC,4BAA4BA,CAAA;IAAA,IAAA9I,KAAA;IAAA,OAAAC,+IAAA;MAChCC,OAAO,CAACC,GAAG,CAAC,4DAA4D,CAAC;MACzE,IAAI;QACF,MAAMH,KAAI,CAAC+I,sBAAsB,EAAE;QACnC7I,OAAO,CAACC,GAAG,CAAC,2CAA2C,CAAC;QAExD;QACA6I,UAAU,CAAC,MAAK;UACd,MAAMC,WAAW,GAAGjJ,KAAI,CAACkG,eAAe,EAAE;UAC1ChG,OAAO,CAACC,GAAG,CAAC,qDAAqD,EAAE8I,WAAW,CAAC;QACjF,CAAC,EAAE,IAAI,CAAC;MACV,CAAC,CAAC,OAAOlI,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,gDAAgD,EAAEA,KAAK,CAAC;MACxE;IAAC;EACH;EAEA;EACMmI,mBAAmBA,CAAA;IAAA,IAAA7I,MAAA;IAAA,OAAAJ,+IAAA;MACvBC,OAAO,CAACC,GAAG,CAAC,2CAA2C,CAAC;MACxD,IAAI;QACF;QACA,MAAOE,MAAI,CAACZ,eAAuB,CAAC0J,cAAc,EAAE;QACpDjJ,OAAO,CAACC,GAAG,CAAC,wCAAwC,CAAC;MACvD,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;MAC7D;IAAC;EACH;EAEcsH,cAAcA,CAAA;IAAA,IAAApH,MAAA;IAAA,OAAAhB,+IAAA;MAC1B,IAAIgB,MAAI,CAAC4G,aAAa,EAAE;MAExB3H,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAC;MAE1D,IAAI;QACF;QACAc,MAAI,CAAC0G,WAAW,GAAGyB,YAAY,CAACC,OAAO,CAACzC,YAAY,CAACI,YAAY,CAAC,KAAK,OAAO;QAC9E,IAAI/F,MAAI,CAAC0G,WAAW,EAAE;UACpByB,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACI,YAAY,EAAE,MAAM,CAAC;QACzD;QAEA;QACAoC,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACG,UAAU,EAAE9F,MAAI,CAACuG,gBAAgB,CAAC;QAEpE,IAAIvG,MAAI,CAAC0G,WAAW,EAAE;UACpB,MAAM1G,MAAI,CAACsI,sBAAsB,EAAE;QACrC,CAAC,MAAM;UACLtI,MAAI,CAACuI,sBAAsB,EAAE;QAC/B;QAEA;QACAvI,MAAI,CAACwI,sBAAsB,EAAE;QAE7B;QACA,MAAMxI,MAAI,CAACyI,cAAc,EAAE;QAE3BzI,MAAI,CAAC4G,aAAa,GAAG,IAAI;QACzB3H,OAAO,CAACC,GAAG,CAAC,wCAAwC,CAAC;MAEvD,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,kDAAkD,EAAEA,KAAK,CAAC;QACxEE,MAAI,CAAC4G,aAAa,GAAG,IAAI,CAAC,CAAC;MAC7B;IAAC;EACH;EAEc0B,sBAAsBA,CAAA;IAAA,IAAAI,MAAA;IAAA,OAAA1J,+IAAA;MAClC;MACA0J,MAAI,CAAClK,eAAe,CAACmK,KAAK,CAACC,SAAS,CAACjJ,IAAI,IAAG;QAC1C+I,MAAI,CAACG,6BAA6B,CAAClJ,IAAI,CAAC;MAC1C,CAAC,CAAC;IAAC;EACL;EAEckJ,6BAA6BA,CAAClJ,IAAS;IAAA,IAAAmJ,MAAA;IAAA,OAAA9J,+IAAA;MACnD,IAAIW,IAAI,EAAE;QACRmJ,MAAI,CAACnC,4BAA4B,GAAG,IAAI;QAExC,IAAI;UACF;UACAmC,MAAI,CAACtK,eAAe,CAACuK,QAAQ,CAAC9E,IAAI,CAACH,oDAAI,CAAC,CAAC,CAAC,CAAC,CAAC8E,SAAS,CAAC3I,OAAO,IAAG;YAC9D,IAAIA,OAAO,EAAE;cACX,MAAME,YAAY,GAAiB;gBACjCC,KAAK,EAAE,oBAAoB4I,IAAI,CAACC,GAAG,EAAE,EAAE;gBACvCtJ,IAAI,EAAE;kBACJU,EAAE,EAAEJ,OAAO,CAACI,EAAE;kBACdC,KAAK,EAAEL,OAAO,CAACK,KAAK;kBACpBC,IAAI,EAAEN,OAAO,CAACM,IAAI;kBAClBC,QAAQ,EAAEP,OAAO,CAACO,QAAQ;kBAC1BC,SAAS,EAAER,OAAO,CAACS,UAAU;kBAC7BC,QAAQ,EAAEV,OAAO,CAACW;;eAErB;cAEDkI,MAAI,CAACI,oBAAoB,CAAC/I,YAAY,CAAC;cACvClB,OAAO,CAACC,GAAG,CAAC,sCAAsC,EAAE;gBAClDiK,MAAM,EAAExJ,IAAI,CAACU,EAAE;gBACfE,IAAI,EAAEN,OAAO,CAACM,IAAI;gBAClB6I,UAAU,EAAEnJ,OAAO,CAACoJ;eACrB,CAAC;YACJ;YACAP,MAAI,CAACnC,4BAA4B,GAAG,KAAK;UAC3C,CAAC,CAAC;QACJ,CAAC,CAAC,OAAO7G,KAAK,EAAE;UACdb,OAAO,CAACa,KAAK,CAAC,kDAAkD,EAAEA,KAAK,CAAC;UACxEgJ,MAAI,CAACnC,4BAA4B,GAAG,KAAK;QAC3C;MACF,CAAC,MAAM;QACL;QACA,IAAI,CAACmC,MAAI,CAACnC,4BAA4B,IAAI,CAACmC,MAAI,CAAChC,eAAe,EAAE;UAC/DgC,MAAI,CAACQ,8BAA8B,EAAE;UACrCrK,OAAO,CAACC,GAAG,CAAC,sCAAsC,CAAC;QACrD;MACF;IAAC;EACH;EAEA;EACAqK,kBAAkBA,CAAA;IAChB,IAAI,CAAC7C,WAAW,GAAG,IAAI;IACvByB,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACI,YAAY,EAAE,MAAM,CAAC;EACzD;EAEA;EACAyD,mBAAmBA,CAAA;IACjB,IAAI,CAAC9C,WAAW,GAAG,KAAK;IACxByB,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACI,YAAY,EAAE,OAAO,CAAC;EAC1D;EAEA;EACQkB,iBAAiBA,CAAA;IACvB,OAAO,WAAW+B,IAAI,CAACC,GAAG,EAAE,IAAIQ,IAAI,CAACC,MAAM,EAAE,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC,EAAE;EAC3E;EAEA;EACQpB,sBAAsBA,CAAA;IAC5B;IACAf,MAAM,CAACoC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAClC,mBAAmB,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;IAEvE;IACA,IAAI,CAACJ,aAAa,GAAGsC,WAAW,CAAC,MAAK;MACpC,IAAI,CAACC,oBAAoB,EAAE;IAC7B,CAAC,EAAE9D,sBAAsB,CAAC;EAC5B;EAEQ0B,mBAAmBA,CAACqC,KAAmB;IAC7C,IAAIA,KAAK,CAACC,GAAG,KAAKjE,mBAAmB,IAAI,CAAC,IAAI,CAACa,uBAAuB,EAAE;MACtE,MAAMqD,WAAW,GAAGF,KAAK,CAACG,QAAQ;MAClC,IAAID,WAAW,EAAE;QACf,IAAI;UACF,MAAM;YAAEE,MAAM;YAAEC;UAAS,CAAE,GAAGC,IAAI,CAACC,KAAK,CAACL,WAAW,CAAC;UAErD;UACA,IAAIG,SAAS,KAAK,IAAI,CAAC9D,gBAAgB,EAAE;UAEzC;UACA,IAAI,CAACM,uBAAuB,GAAG,IAAI;UAEnC,QAAQuD,MAAM;YACZ,KAAK,OAAO;cACVnL,OAAO,CAACC,GAAG,CAAC,0CAA0C,CAAC;cACvD,IAAI,CAACuJ,cAAc,EAAE;cACrB;YACF,KAAK,QAAQ;cACXxJ,OAAO,CAACC,GAAG,CAAC,2CAA2C,CAAC;cACxD;cACA,IAAI,CAACoK,8BAA8B,EAAE;cACrC;UACJ;QACF,CAAC,CAAC,OAAOxJ,KAAK,EAAE;UACdb,OAAO,CAACa,KAAK,CAAC,sDAAsD,EAAEA,KAAK,CAAC;QAC9E,CAAC,SAAS;UACR;UACAiI,UAAU,CAAC,MAAK;YACd,IAAI,CAAClB,uBAAuB,GAAG,KAAK;UACtC,CAAC,EAAE,GAAG,CAAC;QACT;MACF;IACF;EACF;EAEQkD,oBAAoBA,CAAA;IAC1B;IACA,IAAI,IAAI,CAAClD,uBAAuB,IAAI,IAAI,CAACC,eAAe,EAAE;IAE1D,MAAMlH,WAAW,GAAG,IAAI,CAAC4K,gBAAgB;IACzC,MAAMC,UAAU,GAAG,IAAI,CAACC,aAAa,EAAE;IAEvC;IACA,IAAI,CAAC9K,WAAW,IAAI6K,UAAU,EAAE;MAC9BxL,OAAO,CAACC,GAAG,CAAC,wDAAwD,CAAC;MACrE,IAAI,CAACyH,4BAA4B,GAAG,IAAI;MACxC,IAAI,CAACO,kBAAkB,CAACrG,IAAI,CAAC4J,UAAU,CAAC;MACxC,IAAI,CAAC9D,4BAA4B,GAAG,KAAK;IAC3C,CAAC,MAAM,IAAI/G,WAAW,IAAI,CAAC6K,UAAU,EAAE;MACrCxL,OAAO,CAACC,GAAG,CAAC,+DAA+D,CAAC;MAC5E,IAAI,CAACgI,kBAAkB,CAACrG,IAAI,CAAC,IAAI,CAAC;IACpC;IACA;EACF;EAEA;EACQqI,oBAAoBA,CAAC/I,YAA0B;IAAA,IAAAwK,iBAAA;IACrD;IACA,MAAM/K,WAAW,GAAG,IAAI,CAAC4K,gBAAgB;IACzC,MAAMI,UAAU,GAAG,CAAAhL,WAAW,aAAXA,WAAW,gBAAA+K,iBAAA,GAAX/K,WAAW,CAAED,IAAI,cAAAgL,iBAAA,uBAAjBA,iBAAA,CAAmBtK,EAAE,MAAKF,YAAY,CAACR,IAAI,CAACU,EAAE;IAEjE;IACA,MAAMwK,eAAe,GAAG,CAACjL,WAAW,IAClCA,WAAW,CAACD,IAAI,CAACU,EAAE,KAAKF,YAAY,CAACR,IAAI,CAACU,EAAE,IAC5CT,WAAW,CAACD,IAAI,CAACW,KAAK,KAAKH,YAAY,CAACR,IAAI,CAACW,KAAK,IAClDV,WAAW,CAACD,IAAI,CAACY,IAAI,KAAKJ,YAAY,CAACR,IAAI,CAACY,IAAI;IAElD;IACA,IAAI,CAAC2G,kBAAkB,CAACrG,IAAI,CAACV,YAAY,CAAC;IAE1C;IACAgI,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACC,YAAY,EAAE0E,IAAI,CAACQ,SAAS,CAAC3K,YAAY,CAAC,CAAC;IAC7EgI,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACE,aAAa,EAAEmD,IAAI,CAACC,GAAG,EAAE,CAACU,QAAQ,EAAE,CAAC;IAEvE;IACA,IAAIkB,eAAe,IAAI,CAAC,IAAI,CAAClE,4BAA4B,IAAI,CAAC,IAAI,CAACG,eAAe,EAAE;MAClF,IAAI,CAACiE,sBAAsB,CAAC,OAAO,CAAC;MACpC9L,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAC;IAC5D,CAAC,MAAM;MACLD,OAAO,CAACC,GAAG,CAAC,yEAAyE,CAAC;IACxF;IAEAD,OAAO,CAACC,GAAG,CAAC,sDAAsD,CAAC;EACrE;EAEQ8L,sBAAsBA,CAAA;IAC5B;IACA,IAAI,CAAC9D,kBAAkB,CAACrG,IAAI,CAAC,IAAI,CAAC;IAElC;IACA,IAAI,CAACoK,gBAAgB,EAAE;IAEvB;IACA,IAAI,CAAC,IAAI,CAACpE,uBAAuB,EAAE;MACjC,IAAI,CAACkE,sBAAsB,CAAC,QAAQ,CAAC;IACvC;IAEA9L,OAAO,CAACC,GAAG,CAAC,gDAAgD,CAAC;EAC/D;EAEA;EACQoK,8BAA8BA,CAAA;IACpC;IACA,IAAI,CAACpC,kBAAkB,CAACrG,IAAI,CAAC,IAAI,CAAC;IAElC;IACA,IAAI,CAACoK,gBAAgB,EAAE;IAEvB;IAEAhM,OAAO,CAACC,GAAG,CAAC,4DAA4D,CAAC;EAC3E;EAEQ6L,sBAAsBA,CAACX,MAA0B;IACvD;IACA,IAAI,IAAI,CAACvD,uBAAuB,EAAE;IAElC;IACA,MAAMoC,GAAG,GAAGD,IAAI,CAACC,GAAG,EAAE;IACtB,IAAIA,GAAG,GAAG,IAAI,CAAClC,iBAAiB,GAAG,IAAI,CAACC,qBAAqB,EAAE;MAC7D/H,OAAO,CAACC,GAAG,CAAC,8BAA8BkL,MAAM,uBAAuB,CAAC;MACxE;IACF;IACA,IAAI,CAACrD,iBAAiB,GAAGkC,GAAG;IAE5B,MAAMiB,WAAW,GAAG;MAClBE,MAAM;MACNC,SAAS,EAAE,IAAI,CAAC9D,gBAAgB;MAChC2E,SAAS,EAAElC,IAAI,CAACC,GAAG;KACpB;IAED,IAAI;MACFd,YAAY,CAACE,OAAO,CAACrC,mBAAmB,EAAEsE,IAAI,CAACQ,SAAS,CAACZ,WAAW,CAAC,CAAC;MACtEjL,OAAO,CAACC,GAAG,CAAC,gCAAgCkL,MAAM,gBAAgB,CAAC;MAEnE;MACArC,UAAU,CAAC,MAAK;QACd,IAAI;UACF,MAAMoD,WAAW,GAAGhD,YAAY,CAACC,OAAO,CAACpC,mBAAmB,CAAC;UAC7D,IAAImF,WAAW,KAAKb,IAAI,CAACQ,SAAS,CAACZ,WAAW,CAAC,EAAE;YAC/C/B,YAAY,CAACiD,UAAU,CAACpF,mBAAmB,CAAC;UAC9C;QACF,CAAC,CAAC,OAAOlG,KAAK,EAAE;UACd;QAAA;MAEJ,CAAC,EAAE,GAAG,CAAC;IACT,CAAC,CAAC,OAAOA,KAAK,EAAE;MACdb,OAAO,CAACa,KAAK,CAAC,mDAAmD,EAAEA,KAAK,CAAC;IAC3E;EACF;EAEQmL,gBAAgBA,CAAA;IACtB9C,YAAY,CAACiD,UAAU,CAACzF,YAAY,CAACC,YAAY,CAAC;IAClDuC,YAAY,CAACiD,UAAU,CAACzF,YAAY,CAACE,aAAa,CAAC;IACnDsC,YAAY,CAACiD,UAAU,CAACpF,mBAAmB,CAAC;IAE5C;IACA,MAAMqF,UAAU,GAAG,CAAC,MAAM,EAAE,iBAAiB,EAAE,cAAc,CAAC;IAC9DA,UAAU,CAACC,OAAO,CAACrB,GAAG,IAAI9B,YAAY,CAACiD,UAAU,CAACnB,GAAG,CAAC,CAAC;IAEvD;IACA,MAAMsB,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACpD,YAAY,CAAC;IACtCoD,IAAI,CAACD,OAAO,CAACrB,GAAG,IAAG;MACjB,IAAIA,GAAG,CAACwB,UAAU,CAAC,SAAS,CAAC,IAAIxB,GAAG,CAACwB,UAAU,CAAC,YAAY,CAAC,EAAE;QAC7DtD,YAAY,CAACiD,UAAU,CAACnB,GAAG,CAAC;MAC9B;IACF,CAAC,CAAC;EACJ;EAEcxB,cAAcA,CAAA;IAAA,IAAAiD,MAAA;IAAA,OAAA1M,+IAAA;MAC1B,IAAI;QACF,MAAMyL,UAAU,GAAGiB,MAAI,CAAChB,aAAa,EAAE;QACvC,IAAID,UAAU,IAAIiB,MAAI,CAACC,cAAc,EAAE,EAAE;UACvCD,MAAI,CAACxE,kBAAkB,CAACrG,IAAI,CAAC4J,UAAU,CAAC;UACxCxL,OAAO,CAACC,GAAG,CAAC,8CAA8C,CAAC;QAC7D,CAAC,MAAM;UACLD,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAC;QAC5D;MACF,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;MACjE;IAAC;EACH;EAEQ6L,cAAcA,CAAA;IACpB,MAAMC,YAAY,GAAGzD,YAAY,CAACC,OAAO,CAACzC,YAAY,CAACE,aAAa,CAAC;IACrE,IAAI,CAAC+F,YAAY,EAAE,OAAO,KAAK;IAE/B,MAAMC,qBAAqB,GAAG7C,IAAI,CAACC,GAAG,EAAE,GAAG6C,MAAM,CAACF,YAAY,CAAC;IAC/D,OAAOC,qBAAqB,IAAI3F,eAAe;EACjD;EAEQwE,aAAaA,CAAA;IACnB,MAAMD,UAAU,GAAGtC,YAAY,CAACC,OAAO,CAACzC,YAAY,CAACC,YAAY,CAAC;IAClE,IAAI,CAAC6E,UAAU,EAAE,OAAO,IAAI;IAE5B,IAAI;MACJ,MAAM9K,IAAI,GAAG2K,IAAI,CAACC,KAAK,CAACE,UAAU,CAAC;MACnC,MAAMmB,YAAY,GAAGzD,YAAY,CAACC,OAAO,CAACzC,YAAY,CAACE,aAAa,CAAC;MAErE,IAAI+F,YAAY,IAAI5C,IAAI,CAACC,GAAG,EAAE,GAAG6C,MAAM,CAACF,YAAY,CAAC,GAAG1F,eAAe,EAAE;QACvE,IAAI,CAAC+E,gBAAgB,EAAE;QACvB,OAAO,IAAI;MACb;MAEE;MACA,IAAItL,IAAI,IAAIA,IAAI,CAACA,IAAI,IAAIA,IAAI,CAACS,KAAK,EAAE;QACvC,OAAOT,IAAI;MACT;MAEA;MACA,IAAIA,IAAI,IAAIA,IAAI,CAACY,IAAI,IAAI,CAACZ,IAAI,CAACA,IAAI,EAAE;QACnC,OAAO;UACLS,KAAK,EAAE,gBAAgB;UACvBT,IAAI,EAAE;YACJU,EAAE,EAAEV,IAAI,CAACU,EAAE,IAAI,SAAS;YACxBC,KAAK,EAAEX,IAAI,CAACW,KAAK,IAAI,kBAAkB;YACvCC,IAAI,EAAEZ,IAAI,CAACY,IAAI;YACfC,QAAQ,EAAEb,IAAI,CAACa,QAAQ,IAAI,MAAM;YACjCC,SAAS,EAAEd,IAAI,CAACc,SAAS,IAAI,SAAS;YACtCE,QAAQ,EAAEhB,IAAI,CAACgB,QAAQ,IAAI;;SAE9B;MACH;MAEA,OAAO,IAAI;IACb,CAAC,CAAC,OAAOb,KAAK,EAAE;MACdb,OAAO,CAACa,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MACvD,IAAI,CAACmL,gBAAgB,EAAE;MACvB,OAAO,IAAI;IACb;EACF;EAEQ1C,sBAAsBA,CAAA;IAC5B,IAAI,IAAI,CAACjB,YAAY,EAAE;MACrBC,aAAa,CAAC,IAAI,CAACD,YAAY,CAAC;IAClC;IAEA,IAAI,CAACA,YAAY,GAAGwC,WAAW,CAAC,MAAK;MACnC,MAAM8B,YAAY,GAAGzD,YAAY,CAACC,OAAO,CAACzC,YAAY,CAACE,aAAa,CAAC;MACrE,IAAI+F,YAAY,IAAI5C,IAAI,CAACC,GAAG,EAAE,GAAG6C,MAAM,CAACF,YAAY,CAAC,GAAG1F,eAAe,EAAE;QACvE,IAAI,CAAC6F,MAAM,EAAE;MACf;IACF,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;EACb;EAEQC,kBAAkBA,CAAA;IACxB7D,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACE,aAAa,EAAEmD,IAAI,CAACC,GAAG,EAAE,CAACU,QAAQ,EAAE,CAAC;EACzE;EAEQsC,kBAAkBA,CAAC3L,KAAa;IACtC,MAAM4L,QAAQ,GAAG,IAAI,CAAC1F,aAAa,CAAC2F,GAAG,CAAC7L,KAAK,CAAC;IAE9C,IAAI4L,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEE,YAAY,IAAIpD,IAAI,CAACC,GAAG,EAAE,GAAGiD,QAAQ,CAACE,YAAY,EAAE;MAChE,MAAM,IAAIC,KAAK,CACb,mCAAmC,IAAIrD,IAAI,CACzCkD,QAAQ,CAACE,YAAY,CACtB,CAACE,kBAAkB,EAAE,EAAE,CACzB;IACH;IAEA,MAAMC,YAAY,GAAG,CAAAL,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEM,KAAK,KAAI,CAAC;IACzC,IAAID,YAAY,IAAIpG,kBAAkB,EAAE;MACtC,MAAMiG,YAAY,GAAGpD,IAAI,CAACC,GAAG,EAAE,GAAG7C,gBAAgB;MAClD,IAAI,CAACI,aAAa,CAACiG,GAAG,CAACnM,KAAK,EAAE;QAAEkM,KAAK,EAAE,CAAC;QAAEJ;MAAY,CAAE,CAAC;MACzD,MAAM,IAAIC,KAAK,CACb,iDAAiD,IAAIrD,IAAI,CACvDoD,YAAY,CACb,CAACE,kBAAkB,EAAE,EAAE,CACzB;IACH;IAEA,OAAO,IAAI;EACb;EAEA,IAAW9B,gBAAgBA,CAAA;IACzB,OAAO,IAAI,CAACtD,kBAAkB,CAACwF,KAAK;EACtC;EAEAC,KAAKA,CAACC,SAAoB;IACxB,IAAI,IAAI,CAAClG,WAAW,EAAE;MACpB,OAAO,IAAI,CAACmG,iBAAiB,CAACD,SAAS,CAAC;IAC1C,CAAC,MAAM;MACL,OAAO,IAAI,CAACE,aAAa,CAACF,SAAS,CAAC;IACtC;EACF;EAEQC,iBAAiBA,CAACD,SAAoB;IAC5C,OAAO,IAAInH,4CAAU,CAACsH,UAAU,IAAG;MACjC;MACA,MAAMnN,WAAW,GAAG,IAAI,CAAC4K,gBAAgB;MACzC,IAAI5K,WAAW,IAAIA,WAAW,CAACD,IAAI,CAACW,KAAK,KAAKsM,SAAS,CAACtM,KAAK,EAAE;QAC7DrB,OAAO,CAACC,GAAG,CAAC,2DAA2D,CAAC;QACxE6N,UAAU,CAAClM,IAAI,CAACjB,WAAW,CAAC;QAC5BmN,UAAU,CAACC,QAAQ,EAAE;QACrB;MACF;MAEA;MACA,MAAMC,YAAY,GAAG,IAAI,CAACzO,eAAe,CAACoB,WAAW;MACrD,IAAIqN,YAAY,IAAIA,YAAY,CAAC3M,KAAK,KAAKsM,SAAS,CAACtM,KAAK,EAAE;QAC1DrB,OAAO,CAACC,GAAG,CAAC,0DAA0D,CAAC;QACvE,IAAI,CAACgO,6BAA6B,CAACD,YAAY,EAAEF,UAAU,CAAC;QAC5D;MACF;MAEA;MACA,IAAI,IAAI,CAACpG,4BAA4B,EAAE;QACrC1H,OAAO,CAACC,GAAG,CAAC,4DAA4D,CAAC;QACzE,MAAMiO,aAAa,GAAGrD,WAAW,CAAC,MAAK;UACrC,IAAI,CAAC,IAAI,CAACnD,4BAA4B,EAAE;YACtCY,aAAa,CAAC4F,aAAa,CAAC;YAC5B,MAAMC,YAAY,GAAG,IAAI,CAAC5C,gBAAgB;YAC1C,IAAI4C,YAAY,IAAIA,YAAY,CAACzN,IAAI,CAACW,KAAK,KAAKsM,SAAS,CAACtM,KAAK,EAAE;cAC/DrB,OAAO,CAACC,GAAG,CAAC,mEAAmE,CAAC;cAChF6N,UAAU,CAAClM,IAAI,CAACuM,YAAY,CAAC;cAC7BL,UAAU,CAACC,QAAQ,EAAE;cACrB;YACF;UACF;QACF,CAAC,EAAE,GAAG,CAAC;QAEP;QACAjF,UAAU,CAAC,MAAK;UACdR,aAAa,CAAC4F,aAAa,CAAC;UAC5B,IAAI,IAAI,CAACxG,4BAA4B,EAAE;YACrC1H,OAAO,CAACC,GAAG,CAAC,2EAA2E,CAAC;YACxF,IAAI,CAACmO,oBAAoB,CAACT,SAAS,EAAEG,UAAU,CAAC;UAClD;QACF,CAAC,EAAE,IAAI,CAAC;QACR;MACF;MAEA;MACA,IAAI,CAACM,oBAAoB,CAACT,SAAS,EAAEG,UAAU,CAAC;IAClD,CAAC,CAAC;EACJ;EAEcG,6BAA6BA,CAACD,YAAiB,EAAEF,UAAe;IAAA,IAAAO,MAAA;IAAA,OAAAtO,+IAAA;MAC5E,IAAI;QACFC,OAAO,CAACC,GAAG,CAAC,uDAAuD,CAAC;QAEpE;QACA,MAAMqO,aAAa,SAASD,MAAI,CAAC9O,eAAe,CAACgP,MAAM,CACpDC,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,IAAI,EAAEV,YAAY,CAAC5M,EAAE,CAAC,CACzBuN,MAAM,EAAE;QAEX,IAAIL,aAAa,CAACzN,KAAK,EAAE;UAAA,IAAA+N,mBAAA;UACvB5O,OAAO,CAACC,GAAG,CAAC,mEAAmE,CAAC;UAChF,MAAM4O,YAAY,GAAGb,YAAY,CAACc,aAAa,IAAI,EAAE;UACrD,MAAMC,gBAAgB,GAAiB;YACrC5N,KAAK,EAAE,wBAAwB;YAC/BT,IAAI,EAAE;cACJU,EAAE,EAAE4M,YAAY,CAAC5M,EAAE;cACnBC,KAAK,EAAE2M,YAAY,CAAC3M,KAAK,IAAI,qBAAqB;cAClDC,IAAI,EAAEuN,YAAY,CAACvN,IAAI,IAAI,QAAoB;cAC/CC,QAAQ,EAAEsN,YAAY,CAACtN,QAAQ,MAAAqN,mBAAA,GAAIZ,YAAY,CAAC3M,KAAK,cAAAuN,mBAAA,uBAAlBA,mBAAA,CAAoBI,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAI,MAAM;cAC9ExN,SAAS,EAAEqN,YAAY,CAACpN,UAAU,IAAI,MAAM;cAC5CC,QAAQ,EAAEmN,YAAY,CAAClN,SAAS,IAAI;;WAEvC;UAEDuH,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACC,YAAY,EAAE0E,IAAI,CAACQ,SAAS,CAACkD,gBAAgB,CAAC,CAAC;UACjFV,MAAI,CAACpG,kBAAkB,CAACrG,IAAI,CAACmN,gBAAgB,CAAC;UAC9CjB,UAAU,CAAClM,IAAI,CAACmN,gBAAgB,CAAC;UACjCjB,UAAU,CAACC,QAAQ,EAAE;UACrB;QACF;QAEA,MAAM/M,OAAO,GAAGsN,aAAa,CAAC9J,IAAI;QAClC,MAAMtD,YAAY,GAAiB;UACjCC,KAAK,EAAE,wBAAwB;UAC/BT,IAAI,EAAE;YACJU,EAAE,EAAEJ,OAAO,CAACI,EAAE;YACdC,KAAK,EAAEL,OAAO,CAACK,KAAK;YACpBC,IAAI,EAAEN,OAAO,CAACM,IAAI;YAClBC,QAAQ,EAAEP,OAAO,CAACO,QAAQ;YAC1BC,SAAS,EAAER,OAAO,CAACS,UAAU;YAC7BC,QAAQ,EAAEV,OAAO,CAACW;;SAErB;QAED0M,MAAI,CAACpE,oBAAoB,CAAC/I,YAAY,CAAC;QACvC4M,UAAU,CAAClM,IAAI,CAACV,YAAY,CAAC;QAC7B4M,UAAU,CAACC,QAAQ,EAAE;MACvB,CAAC,CAAC,OAAOlN,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,6CAA6C,EAAEA,KAAK,CAAC;QACnEiN,UAAU,CAACjN,KAAK,CAACA,KAAK,CAAC;MACzB;IAAC;EACH;EAEcuN,oBAAoBA,CAACT,SAAoB,EAAEG,UAAe;IAAA,IAAAmB,MAAA;IAAA,OAAAlP,+IAAA;MACtE,IAAI;QACFC,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC;QACzDgP,MAAI,CAACpH,eAAe,GAAG,IAAI;QAE3B;QACAoH,MAAI,CAAC5E,8BAA8B,EAAE;QAErCrK,OAAO,CAACC,GAAG,CAAC,mDAAmD,CAAC;QAEhE;QACA,MAAMiP,aAAa,GAAGD,MAAI,CAAC1P,eAAe,CAAC4P,MAAM,CAACxB,SAAS,CAACtM,KAAK,EAAEsM,SAAS,CAACyB,QAAQ,CAAC;QACtF,MAAMC,cAAc,GAAG,IAAIC,OAAO,CAAC,CAACC,CAAC,EAAEC,MAAM,KAAI;UAC/C1G,UAAU,CAAC,MAAM0G,MAAM,CAAC,IAAIpC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;QAChE,CAAC,CAAC;QAEF,IAAIqC,MAAM;QACV,IAAI;UAAA,IAAAC,YAAA;UACFD,MAAM,SAASH,OAAO,CAACK,IAAI,CAAC,CAACT,aAAa,EAAEG,cAAc,CAAC,CAAQ;UACnErP,OAAO,CAACC,GAAG,CAAC,2CAA2C,EAAEwP,MAAM,CAAC;UAChEzP,OAAO,CAACC,GAAG,CAAC,kDAAkD,GAAAyP,YAAA,GAAED,MAAM,CAAC/O,IAAI,cAAAgP,YAAA,uBAAXA,YAAA,CAAatO,EAAE,CAAC;QAClF,CAAC,CAAC,OAAOwO,WAAW,EAAE;UACpB5P,OAAO,CAACa,KAAK,CAAC,4CAA4C,EAAE+O,WAAW,CAAC;UACxEX,MAAI,CAACpH,eAAe,GAAG,KAAK;UAC5B;UACAiG,UAAU,CAACjN,KAAK,CAAC+O,WAAW,CAAC;UAC7B;QACF;QAEE;QACA,IAAIH,MAAM,CAAC/O,IAAI,IAAI+O,MAAM,CAACjP,OAAO,EAAE;UACjC;UACA,IAAI;YACFR,OAAO,CAACC,GAAG,CAAC,mDAAmD,CAAC;YAChE,MAAMqO,aAAa,SAASW,MAAI,CAAC1P,eAAe,CAACgP,MAAM,CACpDC,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,IAAI,EAAEe,MAAM,CAAC/O,IAAI,CAACU,EAAE,CAAC,CACxBuN,MAAM,EAAE;YACX3O,OAAO,CAACC,GAAG,CAAC,uCAAuC,EAAEqO,aAAa,CAAC;YAEnE,IAAIA,aAAa,CAACzN,KAAK,EAAE;cACvBb,OAAO,CAACC,GAAG,CAAC,8DAA8D,CAAC;cAC3E;cACA;cACA,MAAM4O,YAAY,GAAIY,MAAM,CAAC/O,IAAY,CAACoO,aAAa,IAAI,EAAE;cAC7D,MAAMvN,QAAQ,GAAGsN,YAAY,CAACtN,QAAQ,KAAKkO,MAAM,CAAC/O,IAAI,CAACW,KAAK,GAAGoO,MAAM,CAAC/O,IAAI,CAACW,KAAK,CAAC2N,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;cACxG,MAAMxN,SAAS,GAAGqN,YAAY,CAACpN,UAAU,IAAI,MAAM;cACnD,MAAMC,QAAQ,GAAGmN,YAAY,CAAClN,SAAS,IAAI,MAAM;cACjD,MAAML,IAAI,GAAGuN,YAAY,CAACvN,IAAI,IAAI,QAAQ;cAE1C,MAAMyN,gBAAgB,GAAiB;gBACrC5N,KAAK,EAAEsO,MAAM,CAACjP,OAAO,CAACqP,YAAY;gBAClCnP,IAAI,EAAE;kBACJU,EAAE,EAAEqO,MAAM,CAAC/O,IAAI,CAACU,EAAE;kBAClBC,KAAK,EAAEoO,MAAM,CAAC/O,IAAI,CAACW,KAAK,IAAI,qBAAqB;kBACjDC,IAAI,EAAEA,IAAgB;kBACtBC,QAAQ,EAAEA,QAAQ;kBAClBC,SAAS,EAAEA,SAAS;kBACpBE,QAAQ,EAAEA;;eAEb;cAED;cACAwH,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACC,YAAY,EAAE0E,IAAI,CAACQ,SAAS,CAACkD,gBAAgB,CAAC,CAAC;cAEjF;cACAE,MAAI,CAAChH,kBAAkB,CAACrG,IAAI,CAACmN,gBAAgB,CAAC;cAE9CjB,UAAU,CAAClM,IAAI,CAACmN,gBAAgB,CAAC;cACjCjB,UAAU,CAACC,QAAQ,EAAE;cACrB;YACF;YAEA,MAAM/M,OAAO,GAAGsN,aAAa,CAAC9J,IAAI;YAClC,IAAIxD,OAAO,EAAE;cACX,MAAME,YAAY,GAAiB;gBACjCC,KAAK,EAAEsO,MAAM,CAACjP,OAAO,CAACqP,YAAY;gBAClCnP,IAAI,EAAE;kBACJU,EAAE,EAAEJ,OAAO,CAACI,EAAE;kBACdC,KAAK,EAAEL,OAAO,CAACK,KAAK;kBACpBC,IAAI,EAAEN,OAAO,CAACM,IAAI;kBAClBC,QAAQ,EAAEP,OAAO,CAACO,QAAQ;kBAC1BC,SAAS,EAAER,OAAO,CAACS,UAAU;kBAC7BC,QAAQ,EAAEV,OAAO,CAACW;;eAErB;cAED;cACAsN,MAAI,CAAChF,oBAAoB,CAAC/I,YAAY,CAAC;cAEvC+N,MAAI,CAACpH,eAAe,GAAG,KAAK;cAC5BiG,UAAU,CAAClM,IAAI,CAACV,YAAY,CAAC;cAC7B4M,UAAU,CAACC,QAAQ,EAAE;YACvB,CAAC,MAAM;cACL/N,OAAO,CAACC,GAAG,CAAC,qDAAqD,CAAC;cAClE;cACA;cACA,MAAM4O,YAAY,GAAIY,MAAM,CAAC/O,IAAY,CAACoO,aAAa,IAAI,EAAE;cAC7D,MAAMvN,QAAQ,GAAGsN,YAAY,CAACtN,QAAQ,KAAKkO,MAAM,CAAC/O,IAAI,CAACW,KAAK,GAAGoO,MAAM,CAAC/O,IAAI,CAACW,KAAK,CAAC2N,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;cACxG,MAAMxN,SAAS,GAAGqN,YAAY,CAACpN,UAAU,IAAI,MAAM;cACnD,MAAMC,QAAQ,GAAGmN,YAAY,CAAClN,SAAS,IAAI,MAAM;cACjD,MAAML,IAAI,GAAGuN,YAAY,CAACvN,IAAI,IAAI,QAAQ;cAE1C,MAAMyN,gBAAgB,GAAiB;gBACrC5N,KAAK,EAAEsO,MAAM,CAACjP,OAAO,CAACqP,YAAY;gBAClCnP,IAAI,EAAE;kBACJU,EAAE,EAAEqO,MAAM,CAAC/O,IAAI,CAACU,EAAE;kBAClBC,KAAK,EAAEoO,MAAM,CAAC/O,IAAI,CAACW,KAAK,IAAI,qBAAqB;kBACjDC,IAAI,EAAEA,IAAgB;kBACtBC,QAAQ,EAAEA,QAAQ;kBAClBC,SAAS,EAAEA,SAAS;kBACpBE,QAAQ,EAAEA;;eAEb;cAEDwH,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACC,YAAY,EAAE0E,IAAI,CAACQ,SAAS,CAACkD,gBAAgB,CAAC,CAAC;cACjFE,MAAI,CAAChH,kBAAkB,CAACrG,IAAI,CAACmN,gBAAgB,CAAC;cAE9CE,MAAI,CAACpH,eAAe,GAAG,KAAK;cAC5BiG,UAAU,CAAClM,IAAI,CAACmN,gBAAgB,CAAC;cACjCjB,UAAU,CAACC,QAAQ,EAAE;YACvB;UACF,CAAC,CAAC,OAAOlN,KAAK,EAAE;YACdb,OAAO,CAACa,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;YACjDb,OAAO,CAACC,GAAG,CAAC,8DAA8D,CAAC;YAC3E;YACA,MAAM4O,YAAY,GAAIY,MAAM,CAAC/O,IAAY,CAACoO,aAAa,IAAI,EAAE;YAC7D,MAAMvN,QAAQ,GAAGsN,YAAY,CAACtN,QAAQ,KAAKkO,MAAM,CAAC/O,IAAI,CAACW,KAAK,GAAGoO,MAAM,CAAC/O,IAAI,CAACW,KAAK,CAAC2N,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;YACxG,MAAMxN,SAAS,GAAGqN,YAAY,CAACpN,UAAU,IAAI,MAAM;YACnD,MAAMC,QAAQ,GAAGmN,YAAY,CAAClN,SAAS,IAAI,MAAM;YACjD,MAAML,IAAI,GAAGuN,YAAY,CAACvN,IAAI,IAAI,QAAQ;YAE1C,MAAMyN,gBAAgB,GAAiB;cACrC5N,KAAK,EAAEsO,MAAM,CAACjP,OAAO,CAACqP,YAAY;cAClCnP,IAAI,EAAE;gBACJU,EAAE,EAAEqO,MAAM,CAAC/O,IAAI,CAACU,EAAE;gBAClBC,KAAK,EAAEoO,MAAM,CAAC/O,IAAI,CAACW,KAAK,IAAI,qBAAqB;gBACjDC,IAAI,EAAEA,IAAgB;gBACtBC,QAAQ,EAAEA,QAAQ;gBAClBC,SAAS,EAAEA,SAAS;gBACpBE,QAAQ,EAAEA;;aAEb;YAEDwH,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACC,YAAY,EAAE0E,IAAI,CAACQ,SAAS,CAACkD,gBAAgB,CAAC,CAAC;YACjFE,MAAI,CAAChH,kBAAkB,CAACrG,IAAI,CAACmN,gBAAgB,CAAC;YAE9CE,MAAI,CAACpH,eAAe,GAAG,KAAK;YAC5BiG,UAAU,CAAClM,IAAI,CAACmN,gBAAgB,CAAC;YACjCjB,UAAU,CAACC,QAAQ,EAAE;UACvB;QACF,CAAC,MAAM;UACL/N,OAAO,CAACa,KAAK,CAAC,iCAAiC,CAAC;UAChDoO,MAAI,CAACpH,eAAe,GAAG,KAAK;UAC5BiG,UAAU,CAACjN,KAAK,CAAC,IAAIuM,KAAK,CAAC,sBAAsB,CAAC,CAAC;QACrD;MACJ,CAAC,CAAC,OAAOvM,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;QAChDoO,MAAI,CAACpH,eAAe,GAAG,KAAK;QAC5BiG,UAAU,CAACjN,KAAK,CAACA,KAAK,CAAC;MACzB;IAAC;EACH;EAEQgN,aAAaA,CAACF,SAAoB;IACxC;IACA,IAAIvI,QAAQ,GAAa,QAAQ;IACjC,IAAI7D,QAAQ,GAAG,MAAM;IACrB,IAAIC,SAAS,GAAG,MAAM;IACtB,IAAIE,QAAQ,GAAG,KAAK;IAEpB;IACA,MAAMoO,UAAU,GAAG5G,YAAY,CAACC,OAAO,CAAC,eAAewE,SAAS,CAACtM,KAAK,EAAE,CAAC;IACzE,MAAM0O,cAAc,GAAG7G,YAAY,CAACC,OAAO,CAAC,mBAAmBwE,SAAS,CAACtM,KAAK,EAAE,CAAC;IACjF,MAAM2O,eAAe,GAAG9G,YAAY,CAACC,OAAO,CAAC,oBAAoBwE,SAAS,CAACtM,KAAK,EAAE,CAAC;IACnF,MAAM4O,cAAc,GAAG/G,YAAY,CAACC,OAAO,CAAC,mBAAmBwE,SAAS,CAACtM,KAAK,EAAE,CAAC;IAEjF,IAAIyO,UAAU,IAAI,CAAC,QAAQ,EAAE,aAAa,EAAE,aAAa,CAAC,CAAChK,QAAQ,CAACgK,UAAU,CAAC,EAAE;MAC/E1K,QAAQ,GAAG0K,UAAsB;IACnC;IACA,IAAIC,cAAc,EAAE;MAClBxO,QAAQ,GAAGwO,cAAc;IAC3B;IACA,IAAIC,eAAe,EAAE;MACnBxO,SAAS,GAAGwO,eAAe;IAC7B;IACA,IAAIC,cAAc,EAAE;MAClBvO,QAAQ,GAAGuO,cAAc;IAC3B;IAEA;IACA,MAAMC,YAAY,GAAiB;MACjC/O,KAAK,EAAE,gBAAgB;MACvBT,IAAI,EAAE;QACJU,EAAE,EAAE,QAAQuM,SAAS,CAACtM,KAAK,CAAC8O,OAAO,CAAC,eAAe,EAAE,GAAG,CAAC,EAAE;QAC3D9O,KAAK,EAAEsM,SAAS,CAACtM,KAAK;QACtBE,QAAQ,EAAEA,QAAQ;QAClBC,SAAS,EAAEA,SAAS;QACpBE,QAAQ,EAAEA,QAAQ;QAClBJ,IAAI,EAAE8D;;KAET;IAED;IACA,OAAO,IAAIoB,4CAAU,CAAEsH,UAAU,IAAI;MACnChF,UAAU,CAAC,MAAK;QACd;QACAI,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACC,YAAY,EAAE0E,IAAI,CAACQ,SAAS,CAACqE,YAAY,CAAC,CAAC;QAC7EhH,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACE,aAAa,EAAEmD,IAAI,CAACC,GAAG,EAAE,CAACU,QAAQ,EAAE,CAAC;QAEvE;QACA,MAAM0F,sBAAsB,GAAGlH,YAAY,CAACC,OAAO,CAAC,sBAAsB+G,YAAY,CAACxP,IAAI,CAACW,KAAK,EAAE,CAAC,KAAK,MAAM;QAC/G,MAAM0E,YAAY,GAAG,CAACqK,sBAAsB;QAE5C;QACA,MAAMC,WAAW,GAAS;UACxBjP,EAAE,EAAE8O,YAAY,CAACxP,IAAI,CAACU,EAAE;UACxBE,IAAI,EAAE4O,YAAY,CAACxP,IAAI,CAACY,IAAI;UAC5B6I,UAAU,EAAEpE,YAAY;UACxBxE,QAAQ,EAAEA,QAAQ;UAClBC,SAAS,EAAE0O,YAAY,CAACxP,IAAI,CAACc,SAAS;UACtCE,QAAQ,EAAEwO,YAAY,CAACxP,IAAI,CAACgB,QAAQ;UACpCL,KAAK,EAAE6O,YAAY,CAACxP,IAAI,CAACW;SAC1B;QAEDrB,OAAO,CAACC,GAAG,CAAC,oCAAoC,EAAEoQ,WAAW,CAAC;QAC9D;QACArQ,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAC;QAE1D;QACAiJ,YAAY,CAACiD,UAAU,CAAC,eAAewB,SAAS,CAACtM,KAAK,EAAE,CAAC;QACzD6H,YAAY,CAACiD,UAAU,CAAC,mBAAmBwB,SAAS,CAACtM,KAAK,EAAE,CAAC;QAC7D6H,YAAY,CAACiD,UAAU,CAAC,oBAAoBwB,SAAS,CAACtM,KAAK,EAAE,CAAC;QAC9D6H,YAAY,CAACiD,UAAU,CAAC,mBAAmBwB,SAAS,CAACtM,KAAK,EAAE,CAAC;QAE7D,IAAI,CAAC4G,kBAAkB,CAACrG,IAAI,CAACsO,YAAY,CAAC;QAC1CpC,UAAU,CAAClM,IAAI,CAACsO,YAAY,CAAC;QAC7BpC,UAAU,CAACC,QAAQ,EAAE;MACvB,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAuC,MAAMA,CAACC,QAAoB;IACzB,IAAI,IAAI,CAAC9I,WAAW,EAAE;MACpB,OAAO,IAAI,CAAC+I,kBAAkB,CAACD,QAAQ,CAAC;IAC1C,CAAC,MAAM;MACL,OAAO,IAAI,CAACE,cAAc,CAACF,QAAQ,CAAC;IACtC;EACF;EAEQC,kBAAkBA,CAACD,QAAoB;IAC7C,OAAO,IAAI/J,4CAAU,CAACsH,UAAU,IAAG;MACjC,IAAI,CAACvO,eAAe,CAACmR,MAAM,CAACH,QAAQ,CAAClP,KAAK,EAAEkP,QAAQ,CAACnB,QAAQ,EAAE;QAC7D9N,IAAI,EAAEiP,QAAQ,CAACjP,IAAI;QACnBC,QAAQ,EAAEgP,QAAQ,CAAChP,QAAQ,IAAI,EAAE;QACjCE,UAAU,EAAE8O,QAAQ,CAAC/O,SAAS;QAC9BG,SAAS,EAAE4O,QAAQ,CAAC7O;OACrB,CAAC,CACD4C,IAAI,CAACmL,MAAM,IAAG;QAAA,IAAAkB,aAAA;QACb;QACA,MAAMzP,YAAY,GAAiB;UACjCC,KAAK,EAAE,uBAAuB;UAC9BT,IAAI,EAAE;YACJU,EAAE,EAAE,EAAAuP,aAAA,GAAAlB,MAAM,CAAC/O,IAAI,cAAAiQ,aAAA,uBAAXA,aAAA,CAAavP,EAAE,KAAI,SAAS;YAChCC,KAAK,EAAEkP,QAAQ,CAAClP,KAAK;YACrBC,IAAI,EAAEiP,QAAQ,CAACjP,IAAI;YACnBC,QAAQ,EAAEgP,QAAQ,CAAChP,QAAQ,IAAI,EAAE;YACjCC,SAAS,EAAE+O,QAAQ,CAAC/O,SAAS;YAC7BE,QAAQ,EAAE6O,QAAQ,CAAC7O;;SAEtB;QAEDoM,UAAU,CAAClM,IAAI,CAACV,YAAY,CAAC;QAC7B4M,UAAU,CAACC,QAAQ,EAAE;MACvB,CAAC,CAAC,CACD6C,KAAK,CAAC/P,KAAK,IAAG;QACbb,OAAO,CAACa,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;QAC/CiN,UAAU,CAACjN,KAAK,CAACA,KAAK,CAAC;MACzB,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEQ4P,cAAcA,CAACF,QAAoB;IACzC;IACArH,YAAY,CAACE,OAAO,CAAC,eAAemH,QAAQ,CAAClP,KAAK,EAAE,EAAEkP,QAAQ,CAACjP,IAAI,CAAC;IACpE4H,YAAY,CAACE,OAAO,CAAC,mBAAmBmH,QAAQ,CAAClP,KAAK,EAAE,EAAEkP,QAAQ,CAAChP,QAAQ,IAAI,EAAE,CAAC;IAClF2H,YAAY,CAACE,OAAO,CAAC,oBAAoBmH,QAAQ,CAAClP,KAAK,EAAE,EAAEkP,QAAQ,CAAC/O,SAAS,CAAC;IAC9E0H,YAAY,CAACE,OAAO,CAAC,mBAAmBmH,QAAQ,CAAClP,KAAK,EAAE,EAAEkP,QAAQ,CAAC7O,QAAQ,CAAC;IAE5E;IACA,MAAMwO,YAAY,GAAiB;MACjC/O,KAAK,EAAE,gBAAgB;MACvBT,IAAI,EAAE;QACJU,EAAE,EAAE,QAAQmP,QAAQ,CAAClP,KAAK,CAAC8O,OAAO,CAAC,eAAe,EAAE,GAAG,CAAC,EAAE;QAC1D9O,KAAK,EAAEkP,QAAQ,CAAClP,KAAK;QACrBC,IAAI,EAAEiP,QAAQ,CAACjP,IAAI;QACnBC,QAAQ,EAAEgP,QAAQ,CAAChP,QAAQ,IAAI,EAAE;QACjCC,SAAS,EAAE+O,QAAQ,CAAC/O,SAAS;QAC7BE,QAAQ,EAAE6O,QAAQ,CAAC7O;;KAEtB;IAED;IACA,OAAO,IAAI8E,4CAAU,CAAEsH,UAAU,IAAI;MACnChF,UAAU,CAAC,MAAK;QACdgF,UAAU,CAAClM,IAAI,CAACsO,YAAY,CAAC;QAC7BpC,UAAU,CAACC,QAAQ,EAAE;MACvB,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAjB,MAAMA,CAAA;IACJ9M,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC;IAEzD;IACA,IAAI,IAAI,CAACoI,YAAY,EAAE;MACrBC,aAAa,CAAC,IAAI,CAACD,YAAY,CAAC;MAChC,IAAI,CAACA,YAAY,GAAG,IAAI;IAC1B;IAEA,IAAI,IAAI,CAACZ,WAAW,EAAE;MACpB;MACA,IAAI,CAACsE,sBAAsB,EAAE;MAE7B;MACA,IAAI,CAACxM,eAAe,CAACsR,OAAO,EAAE,CAC3BvM,IAAI,CAAC,MAAK;QACTtE,OAAO,CAACC,GAAG,CAAC,uDAAuD,CAAC;MACtE,CAAC,CAAC,CACD2Q,KAAK,CAAC/P,KAAK,IAAG;QACbb,OAAO,CAAC8Q,IAAI,CAAC,uEAAuE,EAAEjQ,KAAK,CAACkQ,OAAO,CAAC;QACpG;MACF,CAAC,CAAC;IACN,CAAC,MAAM;MACL,IAAI,CAAChF,sBAAsB,EAAE;IAC/B;IAEA/L,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;EACxD;EAEA;EACA+Q,YAAYA,CAAA;IACVhR,OAAO,CAACC,GAAG,CAAC,sCAAsC,CAAC;IACnD,IAAI,CAAC8L,sBAAsB,EAAE;IAC7B/L,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAC;EAC/C;EAEA;EACAgR,YAAYA,CAAA;IACVjR,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAC;IAE1D,IAAI,CAACgI,kBAAkB,CAACrG,IAAI,CAAC,IAAI,CAAC;IAClC,IAAI,CAACoK,gBAAgB,EAAE;IAEvB,IAAI,IAAI,CAACvE,WAAW,EAAE;MACpB,IAAI,CAAClI,eAAe,CAACsR,OAAO,EAAE,CAACD,KAAK,CAAC/P,KAAK,IAAG;QAC3Cb,OAAO,CAACa,KAAK,CAAC,+CAA+C,EAAEA,KAAK,CAAC;MACvE,CAAC,CAAC;IACJ;IAEAb,OAAO,CAACC,GAAG,CAAC,wCAAwC,CAAC;EACvD;EAGA;EACM4I,sBAAsBA,CAAA;IAAA,IAAAqI,MAAA;IAAA,OAAAnR,+IAAA;MAC1BC,OAAO,CAACC,GAAG,CAAC,oDAAoD,CAAC;MAEjE,IAAIiR,MAAI,CAACzJ,WAAW,EAAE;QAAA,IAAA0J,kBAAA;QACpB,MAAMxQ,WAAW,GAAGuQ,MAAI,CAAC3F,gBAAgB;QACzC,MAAMyC,YAAY,GAAGkD,MAAI,CAAC3R,eAAe,CAACoB,WAAW;QAErD,IAAI,EAACA,WAAW,aAAXA,WAAW,gBAAAwQ,kBAAA,GAAXxQ,WAAW,CAAED,IAAI,cAAAyQ,kBAAA,eAAjBA,kBAAA,CAAmB/P,EAAE,KAAI,EAAC4M,YAAY,aAAZA,YAAY,eAAZA,YAAY,CAAE5M,EAAE,GAAE;UAC/CpB,OAAO,CAACa,KAAK,CAAC,4CAA4C,CAAC;UAC3Db,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEU,WAAW,CAAC;UACxCX,OAAO,CAACC,GAAG,CAAC,eAAe,EAAE+N,YAAY,CAAC;UAC1C,MAAM,IAAIZ,KAAK,CAAC,6BAA6B,CAAC;QAChD;QAEA,IAAI;UACFpN,OAAO,CAACC,GAAG,CAAC,+DAA+D,EAAEU,WAAW,CAACD,IAAI,CAACU,EAAE,CAAC;UACjGpB,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAE+N,YAAY,CAAC5M,EAAE,CAAC;UAEjE;UACA,MAAM8P,MAAI,CAAC3R,eAAe,CAACsJ,sBAAsB,CAAClI,WAAW,CAACD,IAAI,CAACU,EAAE,CAAC;UACtEpB,OAAO,CAACC,GAAG,CAAC,kDAAkD,CAAC;UAE/D;UACA,MAAM,IAAIqP,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,GAAG,CAAC,CAAC;UAEtD;UACA,MAAMF,MAAI,CAACG,kBAAkB,EAAE;UAE/B;UACAvI,UAAU,cAAA/I,+IAAA,CAAC,aAAW;YACpB,MAAMmR,MAAI,CAACG,kBAAkB,EAAE,CAAC,CAAC;YACjC,MAAMrQ,OAAO,GAAGkQ,MAAI,CAAC3R,eAAe,CAAC0B,cAAc;YACnD,MAAMqQ,gBAAgB,GAAGJ,MAAI,CAAClL,eAAe,EAAE;YAE/ChG,OAAO,CAACC,GAAG,CAAC,sDAAsD,CAAC;YACnED,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAEqR,gBAAgB,CAAC;YACrDtR,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEe,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEoJ,WAAW,CAAC;YAC7DpK,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEe,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEK,KAAK,CAAC;YAEjD,IAAIiQ,gBAAgB,EAAE;cACpBtR,OAAO,CAAC8Q,IAAI,CAAC,+EAA+E,CAAC;cAC7F,MAAMI,MAAI,CAACK,4BAA4B,CAAC5Q,WAAW,CAACD,IAAI,CAACU,EAAE,CAAC;YAC9D;UACF,CAAC,GAAE,IAAI,CAAC;QAEV,CAAC,CAAC,OAAOP,KAAK,EAAE;UACdb,OAAO,CAACa,KAAK,CAAC,qDAAqD,EAAEA,KAAK,CAAC;UAC3Eb,OAAO,CAACC,GAAG,CAAC,gDAAgD,CAAC;UAE7D;UACA,IAAI;YACF,IAAIiR,MAAI,CAAC3R,eAAe,CAACgP,MAAM,EAAE;cAC/B,MAAM2C,MAAI,CAACK,4BAA4B,CAAC5Q,WAAW,CAACD,IAAI,CAACU,EAAE,CAAC;YAC9D,CAAC,MAAM;cACLpB,OAAO,CAACC,GAAG,CAAC,sEAAsE,CAAC;YACrF;UACF,CAAC,CAAC,OAAOuR,WAAW,EAAE;YACpBxR,OAAO,CAACa,KAAK,CAAC,2CAA2C,EAAE2Q,WAAW,CAAC;YACvE;YACA,IAAIN,MAAI,CAAC3R,eAAe,CAACgP,MAAM,EAAE;cAC/B,MAAM1N,KAAK;YACb;UACF;QACF;MACF,CAAC,MAAM;QACLqI,YAAY,CAACE,OAAO,CAAC,cAAc,EAAE,OAAO,CAAC;QAC7CpJ,OAAO,CAACC,GAAG,CAAC,6DAA6D,CAAC;MAC5E;IAAC;EACH;EAEA;EACcoR,kBAAkBA,CAAA;IAAA,IAAAI,MAAA;IAAA,OAAA1R,+IAAA;MAC9B,MAAMW,IAAI,GAAG+Q,MAAI,CAAClS,eAAe,CAACoB,WAAW;MAC7C,IAAID,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEU,EAAE,IAAIqQ,MAAI,CAAClS,eAAe,CAACgP,MAAM,EAAE;QAC3C,IAAI;UACF,MAAM;YAAE/J,IAAI,EAAExD,OAAO;YAAEH;UAAK,CAAE,SAAS4Q,MAAI,CAAClS,eAAe,CAACgP,MAAM,CAC/DC,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,IAAI,EAAEhO,IAAI,CAACU,EAAE,CAAC,CACjBuN,MAAM,EAAE;UAEX,IAAI,CAAC9N,KAAK,IAAIG,OAAO,EAAE;YACrBhB,OAAO,CAACC,GAAG,CAAC,iDAAiD,EAAEe,OAAO,CAAC;YACvEhB,OAAO,CAACC,GAAG,CAAC,6CAA6C,EAAEe,OAAO,CAACoJ,WAAW,CAAC;YAE/E;YACA,MAAMqH,MAAI,CAAClS,eAAe,CAACmS,yBAAyB,EAAE;UACxD;QACF,CAAC,CAAC,OAAO7Q,KAAK,EAAE;UACdb,OAAO,CAACa,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;QACjE;MACF;IAAC;EACH;EAEA;EACc0Q,4BAA4BA,CAACrH,MAAc;IAAA,IAAAyH,MAAA;IAAA,OAAA5R,+IAAA;MACvD,IAAI,CAAC4R,MAAI,CAACpS,eAAe,CAACgP,MAAM,EAAE;QAChCvO,OAAO,CAACC,GAAG,CAAC,gEAAgE,CAAC;QAC7E;MACF;MAEA,IAAI;QACFD,OAAO,CAACC,GAAG,CAAC,kDAAkD,EAAEiK,MAAM,CAAC;QAEvE,MAAM;UAAE1F,IAAI;UAAE3D;QAAK,CAAE,SAAS8Q,MAAI,CAACpS,eAAe,CAACgP,MAAM,CACtDC,IAAI,CAAC,UAAU,CAAC,CAChBoD,MAAM,CAAC;UACNxH,WAAW,EAAE,KAAK;UAClByH,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;SACnC,CAAC,CACDpD,EAAE,CAAC,IAAI,EAAExE,MAAM,CAAC,CAChBuE,MAAM,EAAE,CACRE,MAAM,EAAE;QAEX,IAAI9N,KAAK,EAAE;UACTb,OAAO,CAACa,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;UAC3D,MAAMA,KAAK;QACb;QAEAb,OAAO,CAACC,GAAG,CAAC,0CAA0C,EAAEuE,IAAI,CAAC;QAE7D;QACAxE,OAAO,CAACC,GAAG,CAAC,iDAAiD,EAAEuE,IAAI,CAAC;QAEpE,MAAMmN,MAAI,CAACN,kBAAkB,EAAE,CAAC,CAAC;MAEnC,CAAC,CAAC,OAAOxQ,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;QAC5D,MAAMA,KAAK;MACb;IAAC;EACH;EAEAkR,eAAeA,CAAA;IAAA,IAAAC,qBAAA;IACb,OAAO,CAAC,GAAAA,qBAAA,GAAC,IAAI,CAACzG,gBAAgB,cAAAyG,qBAAA,eAArBA,qBAAA,CAAuB7Q,KAAK;EACvC;EAEA8Q,YAAYA,CAAA;IAAA,IAAAC,sBAAA;IACV,OAAO,EAAAA,sBAAA,OAAI,CAAC3G,gBAAgB,cAAA2G,sBAAA,uBAArBA,sBAAA,CAAuBxR,IAAI,CAACY,IAAI,MAAK,aAAa;EAC3D;EAEA6Q,QAAQA,CAAA;IAAA,IAAAC,sBAAA;IACN,OAAO,EAAAA,sBAAA,OAAI,CAAC7G,gBAAgB,cAAA6G,sBAAA,uBAArBA,sBAAA,CAAuBjR,KAAK,KAAI,IAAI;EAC7C;EAEA;EACA6E,eAAeA,CAAA;IACbhG,OAAO,CAACC,GAAG,CAAC,mDAAmD,CAAC;IAChED,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAE,IAAI,CAACwH,WAAW,CAAC;IAE7D,IAAI,IAAI,CAACA,WAAW,EAAE;MACpB;MACA,MAAMzG,OAAO,GAAG,IAAI,CAACzB,eAAe,CAAC0B,cAAc;MACnDjB,OAAO,CAACC,GAAG,CAAC,kCAAkC,EAAEe,OAAO,CAAC;MAExD;MACA,IAAIA,OAAO,EAAE;QACXhB,OAAO,CAACC,GAAG,CAAC,sDAAsD,EAAEe,OAAO,CAACoJ,WAAW,EAAE,WAAW,EAAEpJ,OAAO,CAACK,KAAK,CAAC;QACpH,MAAM0H,WAAW,GAAG/H,OAAO,CAACoJ,WAAW,KAAK,IAAI;QAChDpK,OAAO,CAACC,GAAG,CAAC,wCAAwC,EAAE8I,WAAW,CAAC;QAClE,OAAOA,WAAW;MACpB;MAEA;MACA,MAAMrI,IAAI,GAAG,IAAI,CAACnB,eAAe,CAACoB,WAAW;MAC7CX,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAES,IAAI,CAAC;MAClD,IAAIA,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEoO,aAAa,EAAE;QACvB9O,OAAO,CAACC,GAAG,CAAC,6DAA6D,EAAES,IAAI,CAACoO,aAAa,CAAC;QAC9F;QACA,MAAM/F,WAAW,GAAGrI,IAAI,CAACoO,aAAa,CAAC,aAAa,CAAC,KAAK,KAAK;QAC/D9O,OAAO,CAACC,GAAG,CAAC,kDAAkD,EAAE8I,WAAW,CAAC;QAC5E,OAAOA,WAAW;MACpB;MAEA;MACA/I,OAAO,CAACC,GAAG,CAAC,sFAAsF,CAAC;MACnG,OAAO,IAAI;IACb,CAAC,MAAM;MACL;MACA,MAAM8F,YAAY,GAAGmD,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;MACzDnJ,OAAO,CAACC,GAAG,CAAC,wDAAwD,EAAE8F,YAAY,CAAC;MACnF,MAAM0J,MAAM,GAAG1J,YAAY,KAAK,IAAI,IAAIA,YAAY,KAAK,MAAM;MAC/D/F,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEwP,MAAM,CAAC;MACxD,OAAOA,MAAM;IACf;EACF;EAEA;EACA4C,mBAAmBA,CAAA;IAAA,IAAAC,sBAAA;IACjB,MAAM5R,IAAI,IAAA4R,sBAAA,GAAG,IAAI,CAAC/G,gBAAgB,cAAA+G,sBAAA,uBAArBA,sBAAA,CAAuB5R,IAAI;IACxC,IAAIA,IAAI,EAAE;MACR;MACAV,OAAO,CAACC,GAAG,CAAC,4DAA4D,CAAC;IAC3E;EACF;EAEAsS,WAAWA,CAAA;IAAA,IAAAC,sBAAA,EAAAC,sBAAA;IACT,MAAM/R,IAAI,IAAA8R,sBAAA,GAAG,IAAI,CAACjH,gBAAgB,cAAAiH,sBAAA,uBAArBA,sBAAA,CAAuB9R,IAAI;IACxC,OAAO,CAAAA,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEY,IAAI,OAAAmR,sBAAA,GAAI,IAAI,CAAClH,gBAAgB,cAAAkH,sBAAA,uBAArBA,sBAAA,CAAuB/R,IAAI,CAACY,IAAI,KAAI,IAAI;EAC/D;EAEAoR,wBAAwBA,CAAA;IACtB,MAAMpR,IAAI,GAAG,IAAI,CAACiR,WAAW,EAAE;IAC/B,QAAQjR,IAAI;MACV,KAAK,aAAa;QAChB,OAAO,wBAAwB;MACjC,KAAK,aAAa;QAChB,OAAO,wBAAwB;MACjC,KAAK,QAAQ;QACX,OAAO,mBAAmB;MAC5B;QACE,OAAO,UAAU;IACrB;EACF;EAEA;EACAqR,iBAAiBA,CAAA;IACf,MAAMrR,IAAI,GAAG,IAAI,CAACiR,WAAW,EAAE;IAC/B,QAAQjR,IAAI;MACV,KAAK,aAAa;QAChB,OAAO,qBAAqB;MAC9B,KAAK,QAAQ;QACX,OAAO,oBAAoB;MAC7B,KAAK,aAAa;QAChB,OAAO,wBAAwB;MAAE;MACnC;QACE,OAAO,UAAU;IACrB;EACF;EAEA;EACAsR,kBAAkBA,CAAA;IAAA,IAAAC,sBAAA;IAChB,MAAMnS,IAAI,IAAAmS,sBAAA,GAAG,IAAI,CAACtH,gBAAgB,cAAAsH,sBAAA,uBAArBA,sBAAA,CAAuBnS,IAAI;IACxC;IACA,OAAO,CAAAA,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEa,QAAQ,KAAI,MAAM;EACjC;EAEA;EACAuR,oBAAoBA,CAAA;IAClB,MAAMC,IAAI,GAAG,IAAIhJ,IAAI,EAAE,CAACiJ,QAAQ,EAAE;IAClC,IAAID,IAAI,GAAG,EAAE,EAAE,OAAO,cAAc;IACpC,IAAIA,IAAI,GAAG,EAAE,EAAE,OAAO,gBAAgB;IACtC,OAAO,cAAc;EACvB;EAEA;EACAE,uBAAuBA,CAAA;IACrB,MAAM1R,QAAQ,GAAG,IAAI,CAACqR,kBAAkB,EAAE;IAC1C,MAAMM,YAAY,GAAG,IAAI,CAACJ,oBAAoB,EAAE;IAChD,OAAO,GAAGI,YAAY,KAAK3R,QAAQ,GAAG;EACxC;EAEA;EACA4R,cAAcA,CAAA;IAAA,IAAAC,sBAAA;IACZ,MAAMzS,WAAW,IAAAyS,sBAAA,GAAG,IAAI,CAAC7H,gBAAgB,cAAA6H,sBAAA,uBAArBA,sBAAA,CAAuB1S,IAAI;IAC/C,IAAI,CAACC,WAAW,EAAE,OAAO,IAAI;IAE7B;IACA,OAAO;MACLS,EAAE,EAAET,WAAW,CAACS,EAAE;MAClBC,KAAK,EAAEV,WAAW,CAACU,KAAK;MACxBC,IAAI,EAAEX,WAAW,CAACW,IAAI;MACtBC,QAAQ,EAAEZ,WAAW,CAACY,QAAQ;MAC9BC,SAAS,EAAEb,WAAW,CAACa,SAAS;MAChCE,QAAQ,EAAEf,WAAW,CAACe,QAAQ;MAC9ByI,UAAU,EAAE,IAAI,CAACnE,eAAe;KACjC;EACH;EAEA;;;EAGOqN,gBAAgBA,CAAA;IACrB;IACA,MAAMC,OAAO,GAAG/G,MAAM,CAACD,IAAI,CAACpD,YAAY,CAAC;IAEzC;IACAoK,OAAO,CAACjH,OAAO,CAACrB,GAAG,IAAG;MACpB,IAAIA,GAAG,CAACwB,UAAU,CAAC,MAAM,CAAC,IACtBxB,GAAG,CAACwB,UAAU,CAAC,SAAS,CAAC,IACzBxB,GAAG,CAACwB,UAAU,CAAC,YAAY,CAAC,IAC5BxB,GAAG,CAAClF,QAAQ,CAAC,OAAO,CAAC,IACrBkF,GAAG,KAAK,cAAc,IACtBA,GAAG,KAAK,cAAc,IACtBA,GAAG,KAAK,iBAAiB,IACzBA,GAAG,CAACwB,UAAU,CAAC,KAAK,CAAC;MAAK;MAC1BxB,GAAG,CAAClF,QAAQ,CAAC,UAAU,CAAC,EAAE;QAC5BoD,YAAY,CAACiD,UAAU,CAACnB,GAAG,CAAC;MAC9B;IACF,CAAC,CAAC;IAEF;IACAuI,cAAc,CAACC,KAAK,EAAE;IAEtB;IACA,IAAI,CAACvL,kBAAkB,CAACrG,IAAI,CAAC,IAAI,CAAC;EACpC;EAEA;;;EAGO6R,kBAAkBA,CAAA;IACvB;IACAvK,YAAY,CAACsK,KAAK,EAAE;IACpBD,cAAc,CAACC,KAAK,EAAE;IAEtB;IACA,IAAI,CAACvL,kBAAkB,CAACrG,IAAI,CAAC,IAAI,CAAC;IAElC;IACA,IAAI,IAAI,CAACyG,YAAY,EAAE;MACrBC,aAAa,CAAC,IAAI,CAACD,YAAY,CAAC;MAChC,IAAI,CAACA,YAAY,GAAG,IAAI;IAC1B;EACF;EAEA;;;EAGaY,cAAcA,CAAA;IAAA,IAAAyK,OAAA;IAAA,OAAA3T,+IAAA;MACzBC,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC;MAEzD;MACAyT,OAAI,CAACzL,kBAAkB,CAACrG,IAAI,CAAC,IAAI,CAAC;MAClCsH,YAAY,CAACsK,KAAK,EAAE;MACpBD,cAAc,CAACC,KAAK,EAAE;MAEtB;MACA,IAAI;QACF;QACA,MAAME,OAAI,CAACnU,eAAe,CAACgP,MAAM,CAACoF,IAAI,CAAC9C,OAAO,EAAE;MAClD,CAAC,CAAC,OAAO+C,CAAC,EAAE;QACV;MAAA;MAGF;MACA,IAAI;QACF,IAAI,OAAO,IAAIC,SAAS,EAAE;UACxB,MAAOA,SAAiB,CAACC,KAAK,CAACC,KAAK,EAAE,CAACzP,IAAI,CAAEwP,KAAY,IAAI;YAC3DA,KAAK,CAACzH,OAAO,CAAC2H,IAAI,IAAG;cACnB,IAAIA,IAAI,CAACC,IAAI,CAACnO,QAAQ,CAAC,KAAK,CAAC,IAAIkO,IAAI,CAACC,IAAI,CAACnO,QAAQ,CAAC,UAAU,CAAC,EAAE;gBAC/D9F,OAAO,CAACC,GAAG,CAAC,+DAA+D,CAAC;cAC9E;YACF,CAAC,CAAC;UACJ,CAAC,CAAC;QACJ;MACF,CAAC,CAAC,OAAO2T,CAAC,EAAE;QACV;MAAA;MAGF;MACA,MAAM,IAAItE,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,IAAI,CAAC,CAAC;MAEvDpR,OAAO,CAACC,GAAG,CAAC,uCAAuC,CAAC;IAAC;EACvD;EAEA;;;EAGaiU,cAAcA,CAAA;IAAA,IAAAC,OAAA;IAAA,OAAApU,+IAAA;MACzBC,OAAO,CAACC,GAAG,CAAC,+CAA+C,CAAC;MAE5D,IAAI;QACF;QACAiJ,YAAY,CAACsK,KAAK,EAAE;QACpBD,cAAc,CAACC,KAAK,EAAE;QAEtB;QACAW,OAAI,CAAClM,kBAAkB,CAACrG,IAAI,CAAC,IAAI,CAAC;QAElC;QACA,IAAIuS,OAAI,CAAC9L,YAAY,EAAE;UACrBC,aAAa,CAAC6L,OAAI,CAAC9L,YAAY,CAAC;UAChC8L,OAAI,CAAC9L,YAAY,GAAG,IAAI;QAC1B;QAEA;QACA8L,OAAI,CAAC1M,WAAW,GAAG,IAAI;QACvByB,YAAY,CAACE,OAAO,CAAC1C,YAAY,CAACI,YAAY,EAAE,MAAM,CAAC;QAEvD;QACA,MAAM,IAAIwI,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,IAAI,CAAC,CAAC;QAEvDpR,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;MACxD,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAAC;MAChE;IAAC;EACH;EAEA;;;EAGAuT,aAAaA,CAAC/S,KAAa;IACzB,OAAO,IAAI,CAAC9B,eAAe,CAACgP,MAAM,CAACoF,IAAI,CAACU,qBAAqB,CAAChT,KAAK,EAAE;MACnEqD,UAAU,EAAE;KACb,CAAC;EACJ;EAEE;;;EAGI4P,sBAAsBA,CAAA;IAAA,IAAAC,OAAA;IAAA,OAAAxU,+IAAA;MAC1B,IAAI;QACF;QACA,MAAM8F,GAAG,GAAG,IAAI2O,GAAG,CAAChM,MAAM,CAACiM,QAAQ,CAACC,IAAI,CAAC;QACzC,MAAMC,UAAU,GAAG,IAAIC,eAAe,CAAC/O,GAAG,CAACgP,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC,CAAC;QACzD,MAAMC,WAAW,GAAGJ,UAAU,CAACzH,GAAG,CAAC,cAAc,CAAC;QAClD,MAAM8H,YAAY,GAAGL,UAAU,CAACzH,GAAG,CAAC,eAAe,CAAC;QAEpD,IAAI,CAAC6H,WAAW,IAAI,CAACC,YAAY,EAAE;UACjChV,OAAO,CAACa,KAAK,CAAC,gCAAgC,CAAC;UAC/C,OAAO,KAAK;QACd;QAEA;QACA,MAAM;UAAEA;QAAK,CAAE,SAAS0T,OAAI,CAAChV,eAAe,CAACgP,MAAM,CAACoF,IAAI,CAACsB,UAAU,CAAC;UAClEpF,YAAY,EAAEkF,WAAW;UACzBG,aAAa,EAAEF;SAChB,CAAC;QAEF,IAAInU,KAAK,EAAE;UACTb,OAAO,CAACa,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;UACvD,OAAO,KAAK;QACd;QAEA,OAAO,IAAI;MAEb,CAAC,CAAC,OAAOsU,GAAG,EAAE;QACZnV,OAAO,CAACa,KAAK,CAAC,iCAAiC,EAAEsU,GAAG,CAAC;QACrD,OAAO,KAAK;MACd;IAAC;EACH;EAEA;;;;EAIMvU,wBAAwBA,CAAA;IAAA,IAAAwU,OAAA;IAAA,OAAArV,+IAAA;MAC5B,IAAI,CAACqV,OAAI,CAAC3N,WAAW,EAAE;QACrB;MACF;MAEA,IAAI;QACF,MAAM/G,IAAI,GAAG0U,OAAI,CAAC7V,eAAe,CAACoB,WAAW;QAC7C,MAAMK,OAAO,GAAGoU,OAAI,CAAC7V,eAAe,CAAC0B,cAAc;QAEnD,IAAIP,IAAI,IAAIM,OAAO,EAAE;UACnBhB,OAAO,CAACC,GAAG,CAAC,yDAAyD,EAAE;YACrEiK,MAAM,EAAExJ,IAAI,CAACU,EAAE;YACfE,IAAI,EAAEN,OAAO,CAACM,IAAI;YAClB6I,UAAU,EAAEnJ,OAAO,CAACoJ;WACrB,CAAC;UAEF;UACA;UACA,MAAMlJ,YAAY,GAAiB;YACjCC,KAAK,EAAE,wBAAwB;YAC/BT,IAAI,EAAE;cACJU,EAAE,EAAEJ,OAAO,CAACI,EAAE;cACdC,KAAK,EAAEL,OAAO,CAACK,KAAK;cACpBC,IAAI,EAAEN,OAAO,CAACM,IAAI;cAClBC,QAAQ,EAAEP,OAAO,CAACO,QAAQ;cAC1BC,SAAS,EAAER,OAAO,CAACS,UAAU;cAC7BC,QAAQ,EAAEV,OAAO,CAACW;;WAErB;UAEDyT,OAAI,CAACnL,oBAAoB,CAAC/I,YAAY,CAAC;UACvClB,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAC;QAC5D;MACF,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,kDAAkD,EAAEA,KAAK,CAAC;MAC1E;IAAC;EACH;EAEA;;;EAGMwU,wBAAwBA,CAACC,WAAmB;IAAA,OAAAvV,+IAAA;MAChD,IAAI;QACF;QACA,IAAIgV,WAAW,GAAG,EAAE;QAEpB;QACA,MAAMlP,GAAG,GAAG,IAAI2O,GAAG,CAAChM,MAAM,CAACiM,QAAQ,CAACC,IAAI,CAAC;QACzC,MAAMC,UAAU,GAAG,IAAIC,eAAe,CAAC/O,GAAG,CAACgP,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC,CAAC;QACzDC,WAAW,GAAGJ,UAAU,CAACzH,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE;QAElD;QACA,IAAI,CAAC6H,WAAW,EAAE;UAChBA,WAAW,GAAG7L,YAAY,CAACC,OAAO,CAAC,qBAAqB,CAAC,IAAI,EAAE;QACjE;QAEA;QACA,IAAI,CAAC4L,WAAW,EAAE;UAChBA,WAAW,GAAGxB,cAAc,CAACpK,OAAO,CAAC,qBAAqB,CAAC,IAAI,EAAE;QACnE;QAEA,IAAI,CAAC4L,WAAW,EAAE;UAChB/U,OAAO,CAACa,KAAK,CAAC,wEAAwE,CAAC;UACvF,OAAO,KAAK;QACd;QAEA;QACA,MAAM0U,QAAQ,SAASC,KAAK,CAAC,GAAG/O,kEAAW,CAACgP,QAAQ,CAAC5P,GAAG,eAAe,EAAE;UACvE6P,MAAM,EAAE,KAAK;UACbC,OAAO,EAAE;YACP,cAAc,EAAE,kBAAkB;YAClC,eAAe,EAAE,UAAUZ,WAAW,EAAE;YACxC,QAAQ,EAAEtO,kEAAW,CAACgP,QAAQ,CAACzK;WAChC;UACD4K,IAAI,EAAEvK,IAAI,CAACQ,SAAS,CAAC;YACnBuD,QAAQ,EAAEkG;WACX;SACF,CAAC;QAEF,IAAI,CAACC,QAAQ,CAACM,EAAE,EAAE;UAChB,MAAMC,SAAS,SAASP,QAAQ,CAACQ,IAAI,EAAE,CAACnF,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;UACzD5Q,OAAO,CAACa,KAAK,CAAC,yBAAyB,EAAE;YACvCyF,MAAM,EAAEiP,QAAQ,CAACjP,MAAM;YACvB0P,UAAU,EAAET,QAAQ,CAACS,UAAU;YAC/BnV,KAAK,EAAEiV;WACR,CAAC;UACF,OAAO,KAAK;QACd;QAEA,OAAO,IAAI;MAEb,CAAC,CAAC,OAAOX,GAAG,EAAE;QACZnV,OAAO,CAACa,KAAK,CAAC,kCAAkC,EAAEsU,GAAG,CAAC;QAEtD;QACA,IAAIA,GAAG,YAAY/H,KAAK,IAAI+H,GAAG,CAACpE,OAAO,CAACjL,QAAQ,CAAC,kCAAkC,CAAC,EAAE;UACpF;UACA,OAAO,IAAI;QACb;QAEA,OAAO,KAAK;MACd;IAAC;EACH;EAEA;EACMmQ,4BAA4BA,CAAAC,EAAA,EAAkD;IAAA,IAAAC,OAAA;IAAA,OAAApW,+IAAA,YAAjDsB,KAAa,EAAE+U,iBAAA,GAA6B,KAAK;MAClF,IAAI,CAACD,OAAI,CAAC1O,WAAW,EAAE;QACrBzH,OAAO,CAACC,GAAG,CAAC,uDAAuD,CAAC;QACpE,OAAO,KAAK;MACd;MAEA,IAAI;QACFD,OAAO,CAACC,GAAG,CAAC,uCAAuCmW,iBAAiB,cAAc/U,KAAK,EAAE,CAAC;QAE1F,MAAM;UAAER;QAAK,CAAE,SAASsV,OAAI,CAAC5W,eAAe,CAACgP,MAAM,CAChDC,IAAI,CAAC,UAAU,CAAC,CAChBoD,MAAM,CAAC;UACNxH,WAAW,EAAEgM,iBAAiB;UAC9BvE,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;SACnC,CAAC,CACDpD,EAAE,CAAC,OAAO,EAAErN,KAAK,CAAC;QAErB,IAAIR,KAAK,EAAE;UACTb,OAAO,CAACa,KAAK,CAAC,sCAAsCQ,KAAK,GAAG,EAAER,KAAK,CAAC;UACpE,OAAO,KAAK;QACd;QAEAb,OAAO,CAACC,GAAG,CAAC,4CAA4CoB,KAAK,qBAAqB,CAAC;QAEnF;QACA,MAAMV,WAAW,GAAGwV,OAAI,CAAC5K,gBAAgB;QACzC,IAAI,CAAA5K,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAED,IAAI,CAACW,KAAK,MAAKA,KAAK,EAAE;UACrCrB,OAAO,CAACC,GAAG,CAAC,oDAAoD,CAAC;UACjE;UACA6I,UAAU,CAAC,MAAK;YACd,MAAMuN,aAAa,GAAGF,OAAI,CAACnQ,eAAe,EAAE;YAC5ChG,OAAO,CAACC,GAAG,CAAC,0DAA0D,EAAEoW,aAAa,CAAC;UACxF,CAAC,EAAE,IAAI,CAAC;QACV;QAEA,OAAO,IAAI;MACb,CAAC,CAAC,OAAOxV,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,uDAAuD,EAAEA,KAAK,CAAC;QAC7E,OAAO,KAAK;MACd;IAAC,GAAAyV,KAAA,OAAAC,SAAA;EACH;;eAr/CWrU,WAAW;;mCAAXA,YAAW,EAAAL,sDAAA,CAAAE,4DAAA,GAAAF,sDAAA,CAAAI,uEAAA;AAAA;;SAAXC,YAAW;EAAAqD,OAAA,EAAXrD,YAAW,CAAAsD,IAAA;EAAAC,UAAA,EAFV;AAAM,G;;;;;;;;;;;;;;;;;;;;;AC1DiC;AACT;;AAE5C;;;;;AAQM,MAAOhC,2BAA2B;EAHxCnE,YAAA;IAIU,KAAAK,QAAQ,GAAGP,sDAAS,CAACQ,gBAAgB,EAAE;;EAE/C;;;EAGM4N,GAAGA,CAACxC,GAAW,EAAEyC,KAAU;IAAA,IAAA3N,KAAA;IAAA,OAAAC,+IAAA;MAC/B,MAAM2W,WAAW,GAAGrL,IAAI,CAACQ,SAAS,CAAC4B,KAAK,CAAC;MAEzC,IAAI3N,KAAI,CAACH,QAAQ,EAAE;QACjB,MAAM8W,+DAAW,CAACjJ,GAAG,CAAC;UACpBxC,GAAG;UACHyC,KAAK,EAAEiJ;SACR,CAAC;MACJ,CAAC,MAAM;QACLxN,YAAY,CAACE,OAAO,CAAC4B,GAAG,EAAE0L,WAAW,CAAC;MACxC;IAAC;EACH;EAEA;;;EAGMxJ,GAAGA,CAAClC,GAAW;IAAA,IAAA7K,MAAA;IAAA,OAAAJ,+IAAA;MACnB,IAAI;QACF,IAAI0N,KAAoB;QAExB,IAAItN,MAAI,CAACR,QAAQ,EAAE;UACjB,MAAM8P,MAAM,SAASgH,+DAAW,CAACvJ,GAAG,CAAC;YAAElC;UAAG,CAAE,CAAC;UAC7CyC,KAAK,GAAGgC,MAAM,CAAChC,KAAK;QACtB,CAAC,MAAM;UACLA,KAAK,GAAGvE,YAAY,CAACC,OAAO,CAAC6B,GAAG,CAAC;QACnC;QAEA,OAAOyC,KAAK,GAAGpC,IAAI,CAACC,KAAK,CAACmC,KAAK,CAAC,GAAG,IAAI;MACzC,CAAC,CAAC,OAAO5M,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,+BAA+BmK,GAAG,GAAG,EAAEnK,KAAK,CAAC;QAC3D,OAAO,IAAI;MACb;IAAC;EACH;EAEA;;;EAGM8V,MAAMA,CAAC3L,GAAW;IAAA,IAAAjK,MAAA;IAAA,OAAAhB,+IAAA;MACtB,IAAIgB,MAAI,CAACpB,QAAQ,EAAE;QACjB,MAAM8W,+DAAW,CAACE,MAAM,CAAC;UAAE3L;QAAG,CAAE,CAAC;MACnC,CAAC,MAAM;QACL9B,YAAY,CAACiD,UAAU,CAACnB,GAAG,CAAC;MAC9B;IAAC;EACH;EAEA;;;EAGMwI,KAAKA,CAAA;IAAA,IAAA/J,MAAA;IAAA,OAAA1J,+IAAA;MACT,IAAI0J,MAAI,CAAC9J,QAAQ,EAAE;QACjB,MAAM8W,+DAAW,CAACjD,KAAK,EAAE;MAC3B,CAAC,MAAM;QACLtK,YAAY,CAACsK,KAAK,EAAE;MACtB;IAAC;EACH;EAEA;;;EAGMlH,IAAIA,CAAA;IAAA,IAAAzC,MAAA;IAAA,OAAA9J,+IAAA;MACR,IAAI8J,MAAI,CAAClK,QAAQ,EAAE;QACjB,MAAM8P,MAAM,SAASgH,+DAAW,CAACnK,IAAI,EAAE;QACvC,OAAOmD,MAAM,CAACnD,IAAI;MACpB,CAAC,MAAM;QACL,OAAOC,MAAM,CAACD,IAAI,CAACpD,YAAY,CAAC;MAClC;IAAC;EACH;EAEA;;;EAGM0N,GAAGA,CAAC5L,GAAW;IAAA,IAAAyB,MAAA;IAAA,OAAA1M,+IAAA;MACnB,MAAM0N,KAAK,SAAShB,MAAI,CAACS,GAAG,CAAClC,GAAG,CAAC;MACjC,OAAOyC,KAAK,KAAK,IAAI;IAAC;EACxB;EAEA;;;EAGMoJ,WAAWA,CAACvK,IAAc;IAAA,IAAA+B,MAAA;IAAA,OAAAtO,+IAAA;MAC9B,MAAM0P,MAAM,GAA2B,EAAE;MAEzC,KAAK,MAAMzE,GAAG,IAAIsB,IAAI,EAAE;QACtBmD,MAAM,CAACzE,GAAG,CAAC,SAASqD,MAAI,CAACnB,GAAG,CAAClC,GAAG,CAAC;MACnC;MAEA,OAAOyE,MAAM;IAAC;EAChB;EAEA;;;EAGMqH,WAAWA,CAACC,aAAqC;IAAA,IAAA9H,MAAA;IAAA,OAAAlP,+IAAA;MACrD,MAAMiX,QAAQ,GAAGzK,MAAM,CAAC0K,OAAO,CAACF,aAAa,CAAC,CAACnS,GAAG,CAAC,CAAC,CAACoG,GAAG,EAAEyC,KAAK,CAAC,KAC9DwB,MAAI,CAACzB,GAAG,CAACxC,GAAG,EAAEyC,KAAK,CAAC,CACrB;MAED,MAAM6B,OAAO,CAAC4H,GAAG,CAACF,QAAQ,CAAC;IAAC;EAC9B;EAEA;;;EAGMG,cAAcA,CAAC7K,IAAc;IAAA,IAAA4E,MAAA;IAAA,OAAAnR,+IAAA;MACjC,MAAMiX,QAAQ,GAAG1K,IAAI,CAAC1H,GAAG,CAACoG,GAAG,IAAIkG,MAAI,CAACyF,MAAM,CAAC3L,GAAG,CAAC,CAAC;MAClD,MAAMsE,OAAO,CAAC4H,GAAG,CAACF,QAAQ,CAAC;IAAC;EAC9B;;+BAhHWvT,2BAA2B;;mCAA3BA,4BAA2B;AAAA;;SAA3BA,4BAA2B;EAAA8B,OAAA,EAA3B9B,4BAA2B,CAAA+B,IAAA;EAAAC,UAAA,EAF1B;AAAM,G;;;;;;;;;;;;;;;;;;;;;;;ACTiB;AACO;;;;AAI5C;;;;AAOM,MAAOrD,eAAe;EAG1B9C,YACUC,eAAgC,EAChCG,MAAc;IADd,KAAAH,eAAe,GAAfA,eAAe;IACf,KAAAG,MAAM,GAANA,MAAM;IAJR,KAAAC,QAAQ,GAAGP,sDAAS,CAACQ,gBAAgB,EAAE;IAM7C,IAAI,CAACyX,0BAA0B,EAAE;EACnC;EAEA;;;EAGQA,0BAA0BA,CAAA;IAAA,IAAAvX,KAAA;IAChC,IAAI,CAAC,IAAI,CAACH,QAAQ,EAAE;MAClBK,OAAO,CAACC,GAAG,CAAC,0DAA0D,CAAC;MACvE;IACF;IAEAD,OAAO,CAACC,GAAG,CAAC,+DAA+D,CAAC;IAE5E;IACAmX,+CAAG,CAACE,WAAW,CAAC,gBAAgB,EAAE,CAAC;MAAEC;IAAQ,CAAE,KAAI;MACjDvX,OAAO,CAACC,GAAG,CAAC,kCAAkC,EAAEsX,QAAQ,CAAC;IAC3D,CAAC,CAAC;IAEF;IACAH,+CAAG,CAACE,WAAW,CAAC,YAAY;MAAA,IAAAE,IAAA,GAAAzX,+IAAA,CAAE,WAAOgL,KAAK,EAAI;QAC5C/K,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAE8K,KAAK,CAAClF,GAAG,CAAC;QAChD,MAAM/F,KAAI,CAAC2X,cAAc,CAAC1M,KAAK,CAAClF,GAAG,CAAC;MACtC,CAAC;MAAA,iBAAAqQ,EAAA;QAAA,OAAAsB,IAAA,CAAAlB,KAAA,OAAAC,SAAA;MAAA;IAAA,IAAC;IAEF;IACA,IAAI,CAACmB,oBAAoB,EAAE;EAC7B;EAEA;;;EAGcA,oBAAoBA,CAAA;IAAA,IAAAvX,MAAA;IAAA,OAAAJ,+IAAA;MAChC,IAAI;QACF,MAAM4X,SAAS,SAASP,+CAAG,CAACQ,YAAY,EAAE;QAC1C,IAAID,SAAS,IAAIA,SAAS,CAAC9R,GAAG,EAAE;UAC9B7F,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAE0X,SAAS,CAAC9R,GAAG,CAAC;UAC5D,MAAM1F,MAAI,CAACsX,cAAc,CAACE,SAAS,CAAC9R,GAAG,CAAC;QAC1C;MACF,CAAC,CAAC,OAAOhF,KAAK,EAAE;QACd;QACAb,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC;MACjD;IAAC;EACH;EAEA;;;EAGcwX,cAAcA,CAAC5R,GAAW;IAAA,IAAA9E,MAAA;IAAA,OAAAhB,+IAAA;MACtC,IAAI;QACFC,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAE4F,GAAG,CAAC;QAE5C;QACA,IAAI9E,MAAI,CAAC8W,cAAc,CAAChS,GAAG,CAAC,EAAE;UAC5B,MAAMvF,OAAO,SAASS,MAAI,CAACxB,eAAe,CAACuY,qBAAqB,CAACjS,GAAG,CAAC;UAErE,IAAIvF,OAAO,EAAE;YACXN,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;YACtD;YACA,MAAMc,MAAI,CAACgX,iBAAiB,EAAE;UAChC,CAAC,MAAM;YACL/X,OAAO,CAACa,KAAK,CAAC,oCAAoC,CAAC;YACnD;YACAE,MAAI,CAACrB,MAAM,CAACyF,QAAQ,CAAC,CAAC,aAAa,CAAC,EAAE;cACpC6S,WAAW,EAAE;gBAAEnX,KAAK,EAAE;cAAa;aACpC,CAAC;UACJ;QACF,CAAC,MAAM;UACLb,OAAO,CAACC,GAAG,CAAC,uDAAuD,CAAC;UACpE;QACF;MACF,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;QACnD;QACAE,MAAI,CAACrB,MAAM,CAACyF,QAAQ,CAAC,CAAC,aAAa,CAAC,EAAE;UACpC6S,WAAW,EAAE;YAAEnX,KAAK,EAAE;UAAkB;SACzC,CAAC;MACJ;IAAC;EACH;EAEA;;;EAGQgX,cAAcA,CAAChS,GAAW;IAChC,OAAOA,GAAG,CAACC,QAAQ,CAAC,cAAc,CAAC,IAAID,GAAG,CAACC,QAAQ,CAAC,eAAe,CAAC;EACtE;EAEA;;;EAGciS,iBAAiBA,CAAA;IAAA,IAAAtO,MAAA;IAAA,OAAA1J,+IAAA;MAC7B,IAAI;QACF;QACA,MAAM,IAAIuP,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,IAAI,CAAC,CAAC;QAEvD;QACA,MAAM1Q,IAAI,GAAG+I,MAAI,CAAClK,eAAe,CAACoB,WAAW;QAC7C,MAAMK,OAAO,GAAGyI,MAAI,CAAClK,eAAe,CAAC0B,cAAc;QAEnD,IAAIP,IAAI,IAAIM,OAAO,EAAE;UACnB;UACA,IAAIA,OAAO,CAACoJ,WAAW,EAAE;YACvB;YACA,QAAQpJ,OAAO,CAACM,IAAI;cAClB,KAAK,aAAa;gBAChBmI,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC;gBAC7C;cACF,KAAK,QAAQ;gBACXsE,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,oBAAoB,CAAC,CAAC;gBAC5C;cACF,KAAK,aAAa;gBAChBsE,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,wBAAwB,CAAC,CAAC;gBAChD;cACF;gBACEsE,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;YACtC;UACF,CAAC,MAAM;YACL;YACA,QAAQnE,OAAO,CAACM,IAAI;cAClB,KAAK,aAAa;gBAChBmI,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,wBAAwB,CAAC,CAAC;gBAChD;cACF,KAAK,QAAQ;gBACXsE,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,mBAAmB,CAAC,CAAC;gBAC3C;cACF,KAAK,aAAa;gBAChBsE,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,wBAAwB,CAAC,CAAC;gBAChD;cACF;gBACEsE,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;YACtC;UACF;QACF,CAAC,MAAM;UACL;UACAsE,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;QACpC;MACF,CAAC,CAAC,OAAOtE,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;QACtD4I,MAAI,CAAC/J,MAAM,CAACyF,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;MACpC;IAAC;EACH;EAEA;;;EAGM8S,SAASA,CAACpS,GAAW;IAAA,IAAAgE,MAAA;IAAA,OAAA9J,+IAAA;MACzB,MAAM8J,MAAI,CAAC4N,cAAc,CAAC5R,GAAG,CAAC;IAAC;EACjC;;mBA1JWzD,eAAe;;mCAAfA,gBAAe,EAAAP,sDAAA,CAAAE,uEAAA,GAAAF,sDAAA,CAAAI,mDAAA;AAAA;;SAAfG,gBAAe;EAAAmD,OAAA,EAAfnD,gBAAe,CAAAoD,IAAA;EAAAC,UAAA,EAFd;AAAM,G;;;;;;;;;;;;;;;;;;;;;;;;ACV2B;AACF;AAcV;;;;;AAgG7B,MAAOxB,aAAa;EAUxB3E,YACUE,WAAwB,EACxBD,eAAgC;IADhC,KAAAC,WAAW,GAAXA,WAAW;IACX,KAAAD,eAAe,GAAfA,eAAe;IAXzB,KAAAwZ,QAAQ,GAAG,MAAM;IACjB,KAAA/K,YAAY,GAAQ,IAAI;IACxB,KAAAgL,eAAe,GAAQ,IAAI;IAC3B,KAAAC,eAAe,GAAQ,IAAI;IAC3B,KAAA3S,MAAM,GAAG,OAAO;IAEhB,KAAA4S,SAAS,GAAG,uBAAuB;IACnC,KAAAC,YAAY,GAAG,EAAE;IAMf,IAAI,CAACC,YAAY,EAAE;EACrB;EAEAA,YAAYA,CAAA;IACV;IACA,MAAM3R,WAAW,GAAGyB,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,KAAK,MAAM;IAClE,IAAI,CAAC4P,QAAQ,GAAGtR,WAAW,GAAG,UAAU,GAAG,MAAM;IAEjD;IACA,IAAI,CAACuG,YAAY,GAAG,IAAI,CAACzO,eAAe,CAACoB,WAAW;IACpD,IAAI,CAACqY,eAAe,GAAG,IAAI,CAACzZ,eAAe,CAACkB,cAAc;IAC1D,IAAI,CAACwY,eAAe,GAAG,IAAI,CAACzZ,WAAW,CAAC+L,gBAAgB;EAC1D;EAEM8N,cAAcA,CAAA;IAAA,IAAAvZ,KAAA;IAAA,OAAAC,+IAAA;MAClBD,KAAI,CAACwG,MAAM,GAAG,sBAAsB;MACpCxG,KAAI,CAACN,WAAW,CAAC8K,kBAAkB,EAAE;MACrC,MAAM,IAAIgF,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,IAAI,CAAC,CAAC;MACvDtR,KAAI,CAACsZ,YAAY,EAAE;MACnBtZ,KAAI,CAACwG,MAAM,GAAG,mBAAmB;IAAC;EACpC;EAEMgT,UAAUA,CAAA;IAAA,IAAAnZ,MAAA;IAAA,OAAAJ,+IAAA;MACdI,MAAI,CAACmG,MAAM,GAAG,mBAAmB;MACjC,MAAMnG,MAAI,CAACX,WAAW,CAACyJ,cAAc,EAAE;MACvC,MAAM,IAAIqG,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,IAAI,CAAC,CAAC;MACvDjR,MAAI,CAACiZ,YAAY,EAAE;MACnBjZ,MAAI,CAACmG,MAAM,GAAG,gBAAgB;IAAC;EACjC;EAEM4N,cAAcA,CAAA;IAAA,IAAAnT,MAAA;IAAA,OAAAhB,+IAAA;MAClBgB,MAAI,CAACuF,MAAM,GAAG,oBAAoB;MAClC,MAAMvF,MAAI,CAACvB,WAAW,CAAC0U,cAAc,EAAE;MACvC,MAAM,IAAI5E,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,IAAI,CAAC,CAAC;MACvDrQ,MAAI,CAACqY,YAAY,EAAE;MACnBrY,MAAI,CAACuF,MAAM,GAAG,2BAA2B;IAAC;EAC5C;EAEMiT,SAASA,CAAA;IAAA,IAAA9P,MAAA;IAAA,OAAA1J,+IAAA;MACb,IAAI,CAAC0J,MAAI,CAACyP,SAAS,IAAI,CAACzP,MAAI,CAAC0P,YAAY,EAAE;QACzC1P,MAAI,CAACnD,MAAM,GAAG,iCAAiC;QAC/C;MACF;MAEAmD,MAAI,CAACnD,MAAM,GAAG,kBAAkB;MAEhC,IAAI;QACF,MAAMmJ,MAAM,SAAShG,MAAI,CAACjK,WAAW,CAACkO,KAAK,CAAC;UAC1CrM,KAAK,EAAEoI,MAAI,CAACyP,SAAS;UACrB9J,QAAQ,EAAE3F,MAAI,CAAC0P,YAAY;UAC3BK,gBAAgB,EAAE,EAAE;UACpBC,cAAc,EAAE;SACjB,CAAC,CAACC,SAAS,EAAE;QAEdjQ,MAAI,CAAC2P,YAAY,EAAE;QACnB3P,MAAI,CAACnD,MAAM,GAAG,2BAA2BmJ,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAE/O,IAAI,CAACW,KAAK,EAAE;MAC/D,CAAC,CAAC,OAAOR,KAAK,EAAE;QACd4I,MAAI,CAACnD,MAAM,GAAG,iBAAiBzF,KAAK,EAAE;QACtCb,OAAO,CAACa,KAAK,CAAC,cAAc,EAAEA,KAAK,CAAC;MACtC;IAAC;EACH;;iBA1EWoD,aAAa;;mCAAbA,cAAa,EAAApC,+DAAA,CAAAE,oEAAA,GAAAF,+DAAA,CAAAI,uEAAA;AAAA;;QAAbgC,cAAa;EAAA1B,SAAA;EAAAC,UAAA;EAAAC,QAAA,GAAAZ,iEAAA;EAAAc,KAAA;EAAAC,IAAA;EAAA+W,MAAA;EAAA9W,QAAA,WAAA+W,uBAAA7W,EAAA,EAAAC,GAAA;IAAA,IAAAD,EAAA;MAvFlBlB,4DAFJ,iBAAY,kBACG,gBACA;MAAAA,oDAAA,2BAAoB;MAEnCA,0DAFmC,EAAY,EAC/B,EACH;MAKPA,4DAHN,qBAAiC,eACrB,uBACU,SACZ;MAAAA,oDAAA,iCAA0B;MAAAA,0DAAA,EAAK;MAGjCA,4DADF,eAAU,iBACG;MAAAA,oDAAA,0BAAkB;MAAAA,0DAAA,EAAY;MACzCA,4DAAA,mBAA0B;MAAAA,oDAAA,IAAc;MAC1CA,0DAD0C,EAAW,EAC1C;MAGTA,4DADF,gBAAU,iBACG;MAAAA,oDAAA,sBAAc;MAAAA,0DAAA,EAAY;MACrCA,4DAAA,mBAA0B;MAAAA,oDAAA,IAAgD;MAC5EA,0DAD4E,EAAW,EAC5E;MAGTA,4DADF,gBAAU,iBACG;MAAAA,oDAAA,yBAAiB;MAAAA,0DAAA,EAAY;MACxCA,4DAAA,mBAA0B;MAAAA,oDAAA,IAAyC;MACrEA,0DADqE,EAAW,EACrE;MAGTA,4DADF,gBAAU,iBACG;MAAAA,oDAAA,yBAAiB;MAAAA,0DAAA,EAAY;MACxCA,4DAAA,mBAA0B;MAAAA,oDAAA,IAA2D;MACvFA,0DADuF,EAAW,EACvF;MAGTA,4DADF,cAA+B,qBACyC;MAA1DA,wDAAA,mBAAAoY,oDAAA;QAAA,OAASjX,GAAA,CAAAqW,cAAA,EAAgB;MAAA,EAAC;MACpCxX,oDAAA,8BACF;MAAAA,0DAAA,EAAa;MAEbA,4DAAA,qBAAkE;MAAtDA,wDAAA,mBAAAqY,oDAAA;QAAA,OAASlX,GAAA,CAAAsW,UAAA,EAAY;MAAA,EAAC;MAChCzX,oDAAA,0BACF;MAAAA,0DAAA,EAAa;MAEbA,4DAAA,qBAAqE;MAAzDA,wDAAA,mBAAAsY,oDAAA;QAAA,OAASnX,GAAA,CAAAkR,cAAA,EAAgB;MAAA,EAAC;MACpCrS,oDAAA,yBACF;MAAAA,0DAAA,EAAa;MAEbA,4DAAA,qBAAiE;MAArDA,wDAAA,mBAAAuY,oDAAA;QAAA,OAASpX,GAAA,CAAAuW,SAAA,EAAW;MAAA,EAAC;MAC/B1X,oDAAA,oBACF;MACFA,0DADE,EAAa,EACT;MAGJA,4DADF,cAA+B,UACzB;MAAAA,oDAAA,kBAAU;MAAAA,0DAAA,EAAK;MAEjBA,4DADF,gBAAU,oBACsB;MAAAA,oDAAA,aAAK;MAAAA,0DAAA,EAAY;MAC/CA,4DAAA,oBAAuE;MAA5DA,8DAAA,2BAAAyY,2DAAAC,MAAA;QAAA1Y,gEAAA,CAAAmB,GAAA,CAAAkW,SAAA,EAAAqB,MAAA,MAAAvX,GAAA,CAAAkW,SAAA,GAAAqB,MAAA;QAAA,OAAAA,MAAA;MAAA,EAAuB;MACpC1Y,0DADyE,EAAY,EAC1E;MAGTA,4DADF,gBAAU,oBACsB;MAAAA,oDAAA,gBAAQ;MAAAA,0DAAA,EAAY;MAClDA,4DAAA,oBAAkF;MAAvEA,8DAAA,2BAAA4Y,2DAAAF,MAAA;QAAA1Y,gEAAA,CAAAmB,GAAA,CAAAmW,YAAA,EAAAoB,MAAA,MAAAvX,GAAA,CAAAmW,YAAA,GAAAoB,MAAA;QAAA,OAAAA,MAAA;MAAA,EAA0B;MAEzC1Y,0DAFsF,EAAY,EACrF,EACP;MAIFA,4DAFJ,cAA+B,oBACJ,SACpB;MAAAA,oDAAA,IAAoB;MAKjCA,0DALiC,EAAI,EAClB,EACP,EACW,EACV,EACC;;;MAxDoBA,uDAAA,IAAc;MAAdA,+DAAA,CAAAmB,GAAA,CAAA+V,QAAA,CAAc;MAKdlX,uDAAA,GAAgD;MAAhDA,+DAAA,CAAAmB,GAAA,CAAAgL,YAAA,GAAAhL,GAAA,CAAAgL,YAAA,CAAA3M,KAAA,UAAgD;MAKhDQ,uDAAA,GAAyC;MAAzCA,+DAAA,CAAAmB,GAAA,CAAAgW,eAAA,qBAAyC;MAKzCnX,uDAAA,GAA2D;MAA3DA,+DAAA,CAAAmB,GAAA,CAAAiW,eAAA,GAAAjW,GAAA,CAAAiW,eAAA,CAAAvY,IAAA,CAAAW,KAAA,UAA2D;MAyBxEQ,uDAAA,IAAuB;MAAvBA,8DAAA,YAAAmB,GAAA,CAAAkW,SAAA,CAAuB;MAKvBrX,uDAAA,GAA0B;MAA1BA,8DAAA,YAAAmB,GAAA,CAAAmW,YAAA,CAA0B;MAMlCtX,uDAAA,GAAoB;MAApBA,gEAAA,aAAAmB,GAAA,CAAAsD,MAAA,KAAoB;;;iBASjC8R,iEAAU,EACVC,gEAAS,EACTC,+DAAQ,EACRC,iEAAU,EACVC,8DAAO,EACPC,qEAAc,EACdC,gEAAS,EACTC,8DAAO,EACPC,+DAAQ,EACRC,+DAAQ,EACRC,8DAAO,EAEPZ,yDAAY,EACZC,uDAAW,EAAAhW,2DAAA,EAAAA,mDAAA;EAAAe,aAAA;AAAA,G;;;;;;;;;;;;;;;;;;;;;;;AC5GqE;AACvB;AACV;;;AAwE7C,MAAOlB,eAAe;EAM1B1C,YAAoB2b,cAA2C;IAAA,IAAAnb,KAAA;IAA3C,KAAAmb,cAAc,GAAdA,cAAc;IAJ1B,KAAAC,YAAY,GAAG,IAAI3U,iDAAe,CAAc,IAAI,CAAC;IACrD,KAAA4U,eAAe,GAAG,IAAI5U,iDAAe,CAAiB,IAAI,CAAC;IAC3D,KAAA6U,eAAe,GAAG,IAAI7U,iDAAe,CAAiB,IAAI,CAAC;IAGjE;IACA,IAAI;MACF,IAAI,CAACkP,QAAQ,GAAGuF,mEAAY,CAC1BvU,kEAAW,CAACgP,QAAQ,CAAC5P,GAAG,EACxBY,kEAAW,CAACgP,QAAQ,CAACzK,GAAG,EACxB;QACE2I,IAAI,EAAE;UACJ0H,cAAc,EAAE,IAAI;UAAE;UACtBC,gBAAgB,EAAE,IAAI;UAAE;UACxBC,kBAAkB,EAAE,IAAI;UAAE;UAC1BC,OAAO,EAAE;YACPrS,OAAO;cAAA,IAAAqO,IAAA,GAAAzX,+IAAA,CAAE,WAAOiL,GAAW,EAAI;gBAC7B,IAAI;kBACF,aAAalL,KAAI,CAACmb,cAAc,CAAC/N,GAAG,CAAClC,GAAG,CAAC;gBAC3C,CAAC,CAAC,OAAOnK,KAAK,EAAE;kBACdb,OAAO,CAAC8Q,IAAI,CAAC,0CAA0C9F,GAAG,GAAG,EAAEnK,KAAK,CAAC;kBACrE,OAAO,IAAI;gBACb;cACF,CAAC;cAAA,gBAPDsI,OAAOA,CAAA+M,EAAA;gBAAA,OAAAsB,IAAA,CAAAlB,KAAA,OAAAC,SAAA;cAAA;YAAA,GAON;YACDnN,OAAO;cAAA,IAAAqS,KAAA,GAAA1b,+IAAA,CAAE,WAAOiL,GAAW,EAAEyC,KAAa,EAAI;gBAC5C,IAAI;kBACF,MAAM3N,KAAI,CAACmb,cAAc,CAACzN,GAAG,CAACxC,GAAG,EAAEyC,KAAK,CAAC;gBAC3C,CAAC,CAAC,OAAO5M,KAAK,EAAE;kBACdb,OAAO,CAAC8Q,IAAI,CAAC,0CAA0C9F,GAAG,GAAG,EAAEnK,KAAK,CAAC;gBACvE;cACF,CAAC;cAAA,gBANDuI,OAAOA,CAAAsS,GAAA,EAAAC,GAAA;gBAAA,OAAAF,KAAA,CAAAnF,KAAA,OAAAC,SAAA;cAAA;YAAA,GAMN;YACDpK,UAAU;cAAA,IAAAyP,KAAA,GAAA7b,+IAAA,CAAE,WAAOiL,GAAW,EAAI;gBAChC,IAAI;kBACF,MAAMlL,KAAI,CAACmb,cAAc,CAACtE,MAAM,CAAC3L,GAAG,CAAC;gBACvC,CAAC,CAAC,OAAOnK,KAAK,EAAE;kBACdb,OAAO,CAAC8Q,IAAI,CAAC,2CAA2C9F,GAAG,GAAG,EAAEnK,KAAK,CAAC;gBACxE;cACF,CAAC;cAAA,gBANDsL,UAAUA,CAAA0P,GAAA;gBAAA,OAAAD,KAAA,CAAAtF,KAAA,OAAAC,SAAA;cAAA;YAAA;;;OASf,CACF;MAED;MACA,IAAI,CAACpO,cAAc,EAAE;IACvB,CAAC,CAAC,OAAOtH,KAAK,EAAE;MACdb,OAAO,CAACa,KAAK,CAAC,0DAA0D,EAAEA,KAAK,CAAC;IAClF;EACF;EAEcsH,cAAcA,CAAA;IAAA,IAAAhI,MAAA;IAAA,OAAAJ,+IAAA;MAC1B,IAAI,CAACI,MAAI,CAACsV,QAAQ,EAAE;QAClBzV,OAAO,CAACa,KAAK,CAAC,oDAAoD,CAAC;QACnE;MACF;MAEA,IAAI;QACF;QACA,MAAM;UAAE2D,IAAI,EAAE;YAAEhE;UAAO;QAAE,CAAE,SAASL,MAAI,CAACsV,QAAQ,CAAC9B,IAAI,CAACmI,UAAU,EAAE;QACnE3b,MAAI,CAACgb,eAAe,CAACvZ,IAAI,CAACpB,OAAO,CAAC;QAClCL,MAAI,CAAC+a,YAAY,CAACtZ,IAAI,CAAC,CAAApB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEE,IAAI,KAAI,IAAI,CAAC;QAE7C;QACA,IAAIF,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEE,IAAI,EAAE;UACjB,MAAMP,MAAI,CAAC4b,eAAe,CAACvb,OAAO,CAACE,IAAI,CAACU,EAAE,CAAC;QAC7C;QAEA;QACAjB,MAAI,CAACsV,QAAQ,CAAC9B,IAAI,CAACqI,iBAAiB;UAAA,IAAAC,KAAA,GAAAlc,+IAAA,CAAC,WAAOgL,KAAK,EAAEvK,OAAO,EAAI;YAC5DL,MAAI,CAACgb,eAAe,CAACvZ,IAAI,CAACpB,OAAO,CAAC;YAClCL,MAAI,CAAC+a,YAAY,CAACtZ,IAAI,CAAC,CAAApB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEE,IAAI,KAAI,IAAI,CAAC;YAE7C,IAAIF,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEE,IAAI,EAAE;cACjB,MAAMP,MAAI,CAAC4b,eAAe,CAACvb,OAAO,CAACE,IAAI,CAACU,EAAE,CAAC;YAC7C,CAAC,MAAM;cACLjB,MAAI,CAACib,eAAe,CAACxZ,IAAI,CAAC,IAAI,CAAC;YACjC;UACF,CAAC;UAAA,iBAAAsa,GAAA,EAAAC,GAAA;YAAA,OAAAF,KAAA,CAAA3F,KAAA,OAAAC,SAAA;UAAA;QAAA,IAAC;MACJ,CAAC,CAAC,OAAO1V,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,6CAA6C,EAAEA,KAAK,CAAC;MACrE;IAAC;EACH;EAEckb,eAAeA,CAAC7R,MAAc;IAAA,IAAAnJ,MAAA;IAAA,OAAAhB,+IAAA;MAC1C,IAAI,CAACgB,MAAI,CAAC0U,QAAQ,EAAE;QAClBzV,OAAO,CAACa,KAAK,CAAC,oDAAoD,CAAC;QACnE;MACF;MAEA,IAAI;QACF,MAAM;UAAE2D,IAAI,EAAExD,OAAO;UAAEH;QAAK,CAAE,SAASE,MAAI,CAAC0U,QAAQ,CACjDjH,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,IAAI,EAAExE,MAAM,CAAC,CAChByE,MAAM,EAAE;QAEX,IAAI9N,KAAK,EAAE;UACTb,OAAO,CAACa,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;UACnD;QACF;QAEAE,MAAI,CAACqa,eAAe,CAACxZ,IAAI,CAACZ,OAAO,CAAC;MACpC,CAAC,CAAC,OAAOH,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACnD;IAAC;EACH;EAEA;EACA,IAAI0N,MAAMA,CAAA;IACR,OAAO,IAAI,CAACkH,QAAQ;EACtB;EAEA,IAAI/L,KAAKA,CAAA;IACP,OAAO,IAAI,CAACwR,YAAY,CAAChT,YAAY,EAAE;EACzC;EAEA,IAAIkU,QAAQA,CAAA;IACV,OAAO,IAAI,CAACjB,eAAe,CAACjT,YAAY,EAAE;EAC5C;EAEA,IAAI4B,QAAQA,CAAA;IACV,OAAO,IAAI,CAACsR,eAAe,CAAClT,YAAY,EAAE;EAC5C;EAEA,IAAIvH,WAAWA,CAAA;IACb,OAAO,IAAI,CAACua,YAAY,CAACzN,KAAK;EAChC;EAEA,IAAIhN,cAAcA,CAAA;IAChB,OAAO,IAAI,CAAC0a,eAAe,CAAC1N,KAAK;EACnC;EAEA,IAAIxM,cAAcA,CAAA;IAChB,OAAO,IAAI,CAACma,eAAe,CAAC3N,KAAK;EACnC;EAEA;EACMiD,MAAMA,CACVrP,KAAa,EACb+N,QAAgB,EAChBiN,QAAqF,EACrF3X,UAAmB,CAAC;EAAA,E;;;MAEpB,IAAI;QACF;QACA,MAAM4X,kBAAkB,GAAG5X,UAAU,aAAVA,UAAU,cAAVA,UAAU,GAAI+E,MAAI,CAAC8S,qBAAqB,EAAE;QAErE,MAAM;UAAE/X,IAAI;UAAE3D;QAAK,CAAE,SAAS4I,MAAI,CAACgM,QAAQ,CAAC9B,IAAI,CAACjD,MAAM,CAAC;UACtDrP,KAAK;UACL+N,QAAQ;UACRoN,OAAO,EAAE;YACPhY,IAAI,EAAE6X,QAAQ;YAAE;YAChBI,eAAe,EAAEH;;SAEpB,CAAC;QAEF,IAAIzb,KAAK,EAAE;UACTb,OAAO,CAACa,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAAC;UAC1C,MAAMA,KAAK;QACb;QAEA;QACA,IAAI2D,IAAI,CAAC9D,IAAI,EAAE;UACb;UACA+I,MAAI,CAACiT,aAAa,CAAClY,IAAI,CAAC9D,IAAI,CAACU,EAAE,EAAE;YAC/BC,KAAK;YACL,GAAGgb,QAAQ;YACXjS,WAAW,EAAE;YACb;YACA;WACoD,CAAC,CACtDwG,KAAK,CAAE/P,KAAK,IAAI;YACfb,OAAO,CAACa,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;UAClD,CAAC,CAAC;QACJ;QAEA,OAAO2D,IAAI;MACb,CAAC,CAAC,OAAO3D,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,gBAAgB,EAAEA,KAAK,CAAC;QACtC,MAAMA,KAAK;MACb;IAAC;EACH;EAEA;;;;EAIcoI,cAAcA,CAAA;IAAA,IAAAY,MAAA;IAAA,OAAA9J,+IAAA;MAC1B,IAAI;QACFC,OAAO,CAACC,GAAG,CAAC,qDAAqD,CAAC;QAElE;QACA,IAAI,OAAO4T,SAAS,KAAK,WAAW,IAAI,OAAO,IAAIA,SAAS,EAAE;UAAA,IAAA8I,eAAA;UAC5D;UACA,MAAMC,SAAS,SAAS/I,SAAS,CAACC,KAAK,CAACC,KAAK,EAAE;UAE/C;UACA,MAAM8I,SAAS,IAAAF,eAAA,GAAGC,SAAS,CAACE,IAAI,cAAAH,eAAA,uBAAdA,eAAA,CAAgBI,MAAM,CAAC/I,IAAI,IAC3CA,IAAI,CAACC,IAAI,KACPD,IAAI,CAACC,IAAI,CAACnO,QAAQ,CAAC,YAAY,CAAC,IAChCkO,IAAI,CAACC,IAAI,CAACnO,QAAQ,CAAC,UAAU,CAAC,IAC9BkO,IAAI,CAACC,IAAI,CAACnO,QAAQ,CAAC,KAAK,CAAC,CAC1B,CACF;UAED,IAAI+W,SAAS,IAAIA,SAAS,CAACG,MAAM,GAAG,CAAC,EAAE;YACrChd,OAAO,CAACC,GAAG,CAAC,gDAAgD,EAAE4c,SAAS,CAACjY,GAAG,CAACqY,CAAC,IAAIA,CAAC,CAAChJ,IAAI,CAAC,CAAC;YAEzF;YACA,MAAM,IAAI3E,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,GAAG,CAAC,CAAC;YAEtD;YACA,IAAI;cACF,MAAMvH,MAAI,CAAC4L,QAAQ,CAAC9B,IAAI,CAAC9C,OAAO,CAAC;gBAAEqM,KAAK,EAAE;cAAO,CAAE,CAAC;cACpDld,OAAO,CAACC,GAAG,CAAC,8DAA8D,CAAC;YAC7E,CAAC,CAAC,OAAOkd,YAAY,EAAE;cACrBnd,OAAO,CAACC,GAAG,CAAC,+CAA+C,EAAEkd,YAAY,CAAC;YAC5E;YAEA;YACA,MAAM,IAAI7N,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAE,GAAG,CAAC,CAAC;UACxD,CAAC,MAAM;YACLpR,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;UACxD;QACF,CAAC,MAAM;UACLD,OAAO,CAACC,GAAG,CAAC,yDAAyD,CAAC;QACxE;MACF,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,+CAA+C,EAAEA,KAAK,CAAC;QACrE;MACF;IAAC;EACH;EAEMsO,MAAMA,CAAC9N,KAAa,EAAE+N,QAAgB;IAAA,IAAA3C,MAAA;IAAA,OAAA1M,+IAAA;MAC1C,IAAI,CAAC0M,MAAI,CAACgJ,QAAQ,EAAE;QAClB,MAAM,IAAIrI,KAAK,CAAC,iCAAiC,CAAC;MACpD;MAEApN,OAAO,CAACC,GAAG,CAAC,wCAAwC,CAAC;MACrDD,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEwG,kEAAW,CAACgP,QAAQ,CAAC5P,GAAG,CAAC;MAC1E7F,OAAO,CAACC,GAAG,CAAC,oDAAoD,EAAEwG,kEAAW,CAACgP,QAAQ,CAACzK,GAAG,CAACL,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,KAAK,CAAC;MAEpH;MACA,MAAMyS,UAAU,GAAG,CAAC;MACpB,IAAIC,SAAc;MAElB,KAAK,IAAIC,OAAO,GAAG,CAAC,EAAEA,OAAO,IAAIF,UAAU,EAAEE,OAAO,EAAE,EAAE;QACtD,IAAI;UACFtd,OAAO,CAACC,GAAG,CAAC,uCAAuCqd,OAAO,IAAIF,UAAU,EAAE,CAAC;UAE3E,IAAIE,OAAO,GAAG,CAAC,EAAE;YACf;YACA,MAAM7Q,MAAI,CAACxD,cAAc,EAAE;YAC3B;YACA,MAAMsU,KAAK,GAAG/S,IAAI,CAACgT,GAAG,CAAC,IAAI,GAAGhT,IAAI,CAACiT,GAAG,CAAC,CAAC,EAAEH,OAAO,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;YAC/Dtd,OAAO,CAACC,GAAG,CAAC,8BAA8Bsd,KAAK,oBAAoB,CAAC;YACpE,MAAM,IAAIjO,OAAO,CAAC8B,OAAO,IAAItI,UAAU,CAACsI,OAAO,EAAEmM,KAAK,CAAC,CAAC;UAC1D;UAEAvd,OAAO,CAACC,GAAG,CAAC,iEAAiE,CAAC;UAE9E;UACA,MAAM;YAAEuE,IAAI;YAAE3D;UAAK,CAAE,SAAS4L,MAAI,CAACgJ,QAAQ,CAAC9B,IAAI,CAAC+J,kBAAkB,CAAC;YAClErc,KAAK;YACL+N;WACD,CAAC;UAEFpP,OAAO,CAACC,GAAG,CAAC,8CAA8C,CAAC;UAC3DD,OAAO,CAACC,GAAG,CAAC,2BAA2B,EAAEuE,IAAI,CAAC;UAC9CxE,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAEY,KAAK,CAAC;UAEhD,IAAIA,KAAK,EAAE;YACTb,OAAO,CAACa,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;YACxD,MAAMA,KAAK;UACb;UAEAb,OAAO,CAACC,GAAG,CAAC,uCAAuC,EAAEuE,IAAI,CAAC;UAC1D,OAAOA,IAAI;QAEb,CAAC,CAAC,OAAOmZ,YAAY,EAAE;UACrB3d,OAAO,CAACC,GAAG,CAAC,+BAA+Bqd,OAAO,UAAU,EAAEK,YAAY,CAAC;UAC3EN,SAAS,GAAGM,YAAY;UAExB;UACA,MAAMC,WAAW,GAAGD,YAAY,YAAYvQ,KAAK,KAC9CuQ,YAAY,CAAC5M,OAAO,CAACjL,QAAQ,CAAC,kCAAkC,CAAC,IACjE6X,YAAY,CAAC5M,OAAO,CAACjL,QAAQ,CAAC,MAAM,CAAC,CAAC;UAEzC,IAAI8X,WAAW,IAAIN,OAAO,GAAGF,UAAU,EAAE;YACvCpd,OAAO,CAACC,GAAG,CAAC,6CAA6Cqd,OAAO,iBAAiB,CAAC;YAClF,SAAS,CAAC;UACZ;UAEA;UACA,IAAI,CAACM,WAAW,IAAIN,OAAO,KAAKF,UAAU,EAAE;YAC1C;YACA,IAAIQ,WAAW,EAAE;cACf5d,OAAO,CAACC,GAAG,CAAC,0FAA0F,CAAC;cACvG,IAAI;gBACF,MAAM;kBAAEuE,IAAI,EAAEqZ,WAAW;kBAAEhd,KAAK,EAAEid;gBAAY,CAAE,SAASrR,MAAI,CAACgJ,QAAQ,CACnEjH,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,OAAO,EAAErN,KAAK,CAAC,CAClBsN,MAAM,EAAE;gBAEX,IAAIkP,WAAW,IAAI,CAACC,YAAY,EAAE;kBAChC9d,OAAO,CAACC,GAAG,CAAC,iDAAiD,EAAE4d,WAAW,CAAC;kBAC3E,OAAO;oBACLnd,IAAI,EAAE;sBACJU,EAAE,EAAEyc,WAAW,CAACzc,EAAE;sBAClBC,KAAK,EAAEwc,WAAW,CAACxc,KAAK;sBACxByN,aAAa,EAAE;wBACbvN,QAAQ,EAAEsc,WAAW,CAACtc,QAAQ;wBAC9BE,UAAU,EAAEoc,WAAW,CAACpc,UAAU;wBAClCE,SAAS,EAAEkc,WAAW,CAAClc,SAAS;wBAChCL,IAAI,EAAEuc,WAAW,CAACvc;;qBAErB;oBACDd,OAAO,EAAE;sBAAEqP,YAAY,EAAE;oBAAgB;mBAC1C;gBACH;cACF,CAAC,CAAC,OAAO2B,WAAW,EAAE;gBACpBxR,OAAO,CAACC,GAAG,CAAC,0DAA0D,EAAEuR,WAAW,CAAC;cACtF;YACF;YAEA;YACA,MAAMmM,YAAY;UACpB;QACF;MACF;MAEA;MACA3d,OAAO,CAACa,KAAK,CAAC,gDAAgD,CAAC;MAC/D,MAAMwc,SAAS;IAAC;EAClB;EAEMxM,OAAOA,CAAA;IAAA,IAAAxC,MAAA;IAAA,OAAAtO,+IAAA;MACX,IAAI;QACF;QACAsO,MAAI,CAAC6M,YAAY,CAACtZ,IAAI,CAAC,IAAI,CAAC;QAC5ByM,MAAI,CAAC8M,eAAe,CAACvZ,IAAI,CAAC,IAAI,CAAC;QAC/ByM,MAAI,CAAC+M,eAAe,CAACxZ,IAAI,CAAC,IAAI,CAAC;QAE/B;QACA,IAAIyM,MAAI,CAACoH,QAAQ,EAAE;UACjB,MAAM;YAAE5U;UAAK,CAAE,SAASwN,MAAI,CAACoH,QAAQ,CAAC9B,IAAI,CAAC9C,OAAO,EAAE;UACpD,IAAIhQ,KAAK,EAAE;YACTb,OAAO,CAACa,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;YAC3C,MAAMA,KAAK;UACb;QACF;MACF,CAAC,CAAC,OAAOA,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,iBAAiB,EAAEA,KAAK,CAAC;QACvC;MACF;MAEA;MACAwN,MAAI,CAAC6M,YAAY,CAACtZ,IAAI,CAAC,IAAI,CAAC;MAC5ByM,MAAI,CAAC8M,eAAe,CAACvZ,IAAI,CAAC,IAAI,CAAC;MAC/ByM,MAAI,CAAC+M,eAAe,CAACxZ,IAAI,CAAC,IAAI,CAAC;IAAC;EAClC;EAEA;EACM8a,aAAaA,CAACxS,MAAc,EAAE2T,WAA8D;IAAA,IAAA5O,MAAA;IAAA,OAAAlP,+IAAA;MAChG,IAAI;QACF,MAAM;UAAEyE,IAAI;UAAE3D;QAAK,CAAE,SAASoO,MAAI,CAACwG,QAAQ,CACxCjH,IAAI,CAAC,UAAU,CAAC,CAChBuP,MAAM,CAAC,CAAC;UACP3c,EAAE,EAAE8I,MAAM;UACV,GAAG2T,WAAW;UACdG,UAAU,EAAE,IAAIjU,IAAI,EAAE,CAAC+H,WAAW,EAAE;UACpCD,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;SACnC,CAAC,CAAC,CACFrD,MAAM,EAAE,CACRE,MAAM,EAAE;QAEX,IAAI9N,KAAK,EAAE;UACTb,OAAO,CAACa,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;UAC/C,MAAMA,KAAK;QACb;QAEA,OAAO2D,IAAI;MACb,CAAC,CAAC,OAAO3D,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;QAChD,MAAMA,KAAK;MACb;IAAC;EACH;EAEMod,aAAaA,CAAC/T,MAAc,EAAEgU,OAAyB;IAAA,IAAAhN,MAAA;IAAA,OAAAnR,+IAAA;MAC3D,MAAM;QAAEyE,IAAI;QAAE3D;MAAK,CAAE,SAASqQ,MAAI,CAACuE,QAAQ,CACxCjH,IAAI,CAAC,UAAU,CAAC,CAChBoD,MAAM,CAAC;QACN,GAAGsM,OAAO;QACVrM,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;OACnC,CAAC,CACDpD,EAAE,CAAC,IAAI,EAAExE,MAAM,CAAC,CAChBuE,MAAM,EAAE,CACRE,MAAM,EAAE;MAEX,IAAI9N,KAAK,EAAE,MAAMA,KAAK;MACtB,OAAO2D,IAAI;IAAC;EACd;EAEA;EACMqE,sBAAsBA,CAACqB,MAAc;IAAA,IAAAuH,MAAA;IAAA,OAAA1R,+IAAA;MACzC,IAAI;QACF,MAAM;UAAEyE,IAAI;UAAE3D;QAAK,CAAE,SAAS4Q,MAAI,CAACgE,QAAQ,CACxCjH,IAAI,CAAC,UAAU,CAAC,CAChBoD,MAAM,CAAC;UACNxH,WAAW,EAAE,KAAK;UAClByH,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;SACnC,CAAC,CACDpD,EAAE,CAAC,IAAI,EAAExE,MAAM,CAAC,CAChBuE,MAAM,EAAE,CACRE,MAAM,EAAE;QAEX,IAAI9N,KAAK,EAAE;UACTb,OAAO,CAACa,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;UAC3D,MAAMA,KAAK;QACb;QAEA;QACA,IAAI4Q,MAAI,CAAC2J,eAAe,CAAC3N,KAAK,EAAE;UAC9BgE,MAAI,CAAC2J,eAAe,CAACxZ,IAAI,CAAC;YACxB,GAAG6P,MAAI,CAAC2J,eAAe,CAAC3N,KAAK;YAC7BrD,WAAW,EAAE;WACd,CAAC;QACJ;QAEApK,OAAO,CAACC,GAAG,CAAC,4CAA4C,EAAEiK,MAAM,CAAC;QACjE,OAAO1F,IAAI;MACb,CAAC,CAAC,OAAO3D,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;QAC5D,MAAMA,KAAK;MACb;IAAC;EACH;EAEA;EACM6Q,yBAAyBA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAA5R,+IAAA;MAC7B,MAAMY,WAAW,GAAGgR,MAAI,CAAChR,WAAW;MACpC,IAAIA,WAAW,aAAXA,WAAW,eAAXA,WAAW,CAAES,EAAE,EAAE;QACnB,MAAMuQ,MAAI,CAACoK,eAAe,CAACpb,WAAW,CAACS,EAAE,CAAC;QAC1CpB,OAAO,CAACC,GAAG,CAAC,oDAAoD,CAAC;MACnE;IAAC;EACH;EAEA;EACMke,WAAWA,CAACC,SAAwF;IAAA,IAAA1K,OAAA;IAAA,OAAA3T,+IAAA;MACxG,MAAM;QAAEyE,IAAI;QAAE3D;MAAK,CAAE,SAAS6S,OAAI,CAAC+B,QAAQ,CACxCjH,IAAI,CAAC,QAAQ,CAAC,CACduP,MAAM,CAAC,CAAC;QACP,GAAGK,SAAS;QACZC,eAAe,EAAE,CAAC;QAAE;QACpBL,UAAU,EAAE,IAAIjU,IAAI,EAAE,CAAC+H,WAAW,EAAE;QACpCD,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;OACnC,CAAC,CAAC,CACFrD,MAAM,EAAE,CACRE,MAAM,EAAE;MAEX,IAAI9N,KAAK,EAAE,MAAMA,KAAK;MACtB,OAAO2D,IAAI;IAAC;EACd;EAEM8Z,SAASA,CAACC,SAAiB,EAAErU,MAAc;IAAA,IAAAiK,OAAA;IAAA,OAAApU,+IAAA;MAC/C;MACA,MAAM;QAAEyE,IAAI,EAAEga,KAAK;QAAE3d,KAAK,EAAE4d;MAAU,CAAE,SAAStK,OAAI,CAACsB,QAAQ,CAC3DjH,IAAI,CAAC,QAAQ,CAAC,CACdC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,MAAM,EAAE6P,SAAS,CAAC,CACrB5P,MAAM,EAAE;MAEX,IAAI8P,UAAU,EAAE,MAAMA,UAAU;MAEhC;MACA,MAAM;QAAEja,IAAI,EAAEka;MAAc,CAAE,SAASvK,OAAI,CAACsB,QAAQ,CACjDjH,IAAI,CAAC,eAAe,CAAC,CACrBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,UAAU,EAAE8P,KAAK,CAACpd,EAAE,CAAC,CACxBsN,EAAE,CAAC,SAAS,EAAExE,MAAM,CAAC,CACrByE,MAAM,EAAE;MAEX,IAAI+P,cAAc,EAAE;QAClB,MAAM,IAAItR,KAAK,CAAC,wCAAwC,CAAC;MAC3D;MAEA;MACA,MAAM;QAAE5I,IAAI;QAAE3D;MAAK,CAAE,SAASsT,OAAI,CAACsB,QAAQ,CACxCjH,IAAI,CAAC,eAAe,CAAC,CACrBuP,MAAM,CAAC,CAAC;QACPY,QAAQ,EAAEH,KAAK,CAACpd,EAAE;QAClBwd,OAAO,EAAE1U,MAAM;QACf2U,SAAS,EAAE,IAAI9U,IAAI,EAAE,CAAC+H,WAAW,EAAE;QACnCgN,YAAY,EAAE;OACf,CAAC,CAAC,CACFrQ,MAAM,EAAE,CACRE,MAAM,EAAE;MAEX,IAAI9N,KAAK,EAAE,MAAMA,KAAK;MAEtB;MACA,MAAMsT,OAAI,CAACsB,QAAQ,CAChBjH,IAAI,CAAC,QAAQ,CAAC,CACdoD,MAAM,CAAC;QACNyM,eAAe,EAAEG,KAAK,CAACH,eAAe,GAAG,CAAC;QAC1CxM,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;OACnC,CAAC,CACDpD,EAAE,CAAC,IAAI,EAAE8P,KAAK,CAACpd,EAAE,CAAC;MAErB,OAAOoD,IAAI;IAAC;EACd;EAEA;EACMua,gBAAgBA,CAACC,cAAsF;IAAA,IAAAzK,OAAA;IAAA,OAAAxU,+IAAA;MAC3G,MAAM;QAAEyE,IAAI;QAAE3D;MAAK,CAAE,SAAS0T,OAAI,CAACkB,QAAQ,CACxCjH,IAAI,CAAC,aAAa,CAAC,CACnBuP,MAAM,CAAC,CAAC;QACP,GAAGiB,cAAc;QACjBhB,UAAU,EAAE,IAAIjU,IAAI,EAAE,CAAC+H,WAAW,EAAE;QACpCD,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;OACnC,CAAC,CAAC,CACFrD,MAAM,EAAE,CACRE,MAAM,EAAE;MAEX,IAAI9N,KAAK,EAAE,MAAMA,KAAK;MACtB,OAAO2D,IAAI;IAAC;EACd;EAEMya,gBAAgBA,CAACC,YAAoB,EAAEhB,OAA4B;IAAA,IAAA9I,OAAA;IAAA,OAAArV,+IAAA;MACvE,MAAM;QAAEyE,IAAI;QAAE3D;MAAK,CAAE,SAASuU,OAAI,CAACK,QAAQ,CACxCjH,IAAI,CAAC,aAAa,CAAC,CACnBoD,MAAM,CAAC;QACN,GAAGsM,OAAO;QACVrM,UAAU,EAAE,IAAI9H,IAAI,EAAE,CAAC+H,WAAW;OACnC,CAAC,CACDpD,EAAE,CAAC,IAAI,EAAEwQ,YAAY,CAAC,CACtBzQ,MAAM,EAAE,CACRE,MAAM,EAAE;MAEX,IAAI9N,KAAK,EAAE,MAAMA,KAAK;MACtB,OAAO2D,IAAI;IAAC;EACd;EAEA;EACM2a,UAAUA,CAACC,QAAiB;IAAA,IAAAjJ,OAAA;IAAA,OAAApW,+IAAA;MAChC,IAAIgU,KAAK,GAAGoC,OAAI,CAACV,QAAQ,CACtBjH,IAAI,CAAC,SAAS,CAAC,CACfC,MAAM,CAAC,GAAG,CAAC,CACX4Q,KAAK,CAAC,cAAc,EAAE;QAAEC,SAAS,EAAE;MAAI,CAAE,CAAC;MAE7C,IAAIF,QAAQ,EAAE;QACZrL,KAAK,GAAGA,KAAK,CAACrF,EAAE,CAAC,UAAU,EAAE0Q,QAAQ,CAAC;MACxC;MAEA,MAAM;QAAE5a,IAAI;QAAE3D;MAAK,CAAE,SAASkT,KAAK;MACnC,IAAIlT,KAAK,EAAE,MAAMA,KAAK;MACtB,OAAO2D,IAAI;IAAC;EACd;EAEA;EACM+a,qBAAqBA,CAAA;IAAA,IAAAC,OAAA;IAAA,OAAAzf,+IAAA;MACzB,MAAM;QAAEyE,IAAI;QAAE3D;MAAK,CAAE,SAAS2e,OAAI,CAAC/J,QAAQ,CACxCjH,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,IAAI,CAAC,CACZC,EAAE,CAAC,MAAM,EAAE,aAAa,CAAC,CACzB+Q,KAAK,CAAC,CAAC,CAAC;MAEX,IAAI5e,KAAK,EAAE,MAAMA,KAAK;MACtB,OAAO2D,IAAI,CAACwY,MAAM,GAAG,CAAC;IAAC;EACzB;EAEA;EACA0C,uBAAuBA,CAACC,OAAe,EAAEC,QAAgC;IACvE,OAAO,IAAI,CAACnK,QAAQ,CACjBoK,OAAO,CAAC,SAASF,OAAO,EAAE,CAAC,CAC3BG,EAAE,CAAC,kBAAkB,EACpB;MAAE/U,KAAK,EAAE,GAAG;MAAEgV,MAAM,EAAE,QAAQ;MAAEC,KAAK,EAAE,eAAe;MAAEjD,MAAM,EAAE,eAAe4C,OAAO;IAAE,CAAE,EAC1FC,QAAQ,CACT,CACAjW,SAAS,EAAE;EAChB;EAEAsW,uBAAuBA,CAACL,QAAgC;IACtD,OAAO,IAAI,CAACnK,QAAQ,CACjBoK,OAAO,CAAC,SAAS,CAAC,CAClBC,EAAE,CAAC,kBAAkB,EACpB;MAAE/U,KAAK,EAAE,GAAG;MAAEgV,MAAM,EAAE,QAAQ;MAAEC,KAAK,EAAE;IAAS,CAAE,EAClDJ,QAAQ,CACT,CACAjW,SAAS,EAAE;EAChB;EAEA;;;EAGQ4S,qBAAqBA,CAAA;IAC3B;IACA,IAAI,OAAO/T,MAAM,KAAK,WAAW,IAAIA,MAAM,CAACiM,QAAQ,EAAE;MACpD,OAAO,GAAGjM,MAAM,CAACiM,QAAQ,CAACyL,MAAM,uBAAuB;IACzD;IAEA;IACA,OAAO,yCAAyC;EAClD;EAEA;;;;EAIMpI,qBAAqBA,CAACjS,GAAW;IAAA,IAAAsa,OAAA;IAAA,OAAApgB,+IAAA;MACrC,IAAI;QACFC,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAE4F,GAAG,CAAC;QAElD;QACA,MAAMua,MAAM,GAAG,IAAI5L,GAAG,CAAC3O,GAAG,CAAC;QAC3B,MAAM8O,UAAU,GAAG,IAAIC,eAAe,CAACwL,MAAM,CAACvL,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC,CAAC;QAC5D,MAAMC,WAAW,GAAGJ,UAAU,CAACzH,GAAG,CAAC,cAAc,CAAC;QAClD,MAAM8H,YAAY,GAAGL,UAAU,CAACzH,GAAG,CAAC,eAAe,CAAC;QACpD,MAAMmT,IAAI,GAAG1L,UAAU,CAACzH,GAAG,CAAC,MAAM,CAAC;QAEnC,IAAI,CAAC6H,WAAW,IAAI,CAACC,YAAY,EAAE;UACjChV,OAAO,CAACa,KAAK,CAAC,+BAA+B,CAAC;UAC9C,OAAO,KAAK;QACd;QAEA;QACA,MAAM;UAAE2D,IAAI;UAAE3D;QAAK,CAAE,SAASsf,OAAI,CAAC1K,QAAQ,CAAC9B,IAAI,CAACsB,UAAU,CAAC;UAC1DpF,YAAY,EAAEkF,WAAW;UACzBG,aAAa,EAAEF;SAChB,CAAC;QAEF,IAAInU,KAAK,EAAE;UACTb,OAAO,CAACa,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;UAC/D,OAAO,KAAK;QACd;QAEAb,OAAO,CAACC,GAAG,CAAC,2CAA2C,CAAC;QACxD,OAAO,IAAI;MAEb,CAAC,CAAC,OAAOY,KAAK,EAAE;QACdb,OAAO,CAACa,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;QAC3D,OAAO,KAAK;MACd;IAAC;EACH;EAEA;;;EAGAR,kBAAkBA,CAAA;IAChB,IAAI,OAAOmI,MAAM,KAAK,WAAW,EAAE,OAAO,KAAK;IAE/C,MAAMqM,IAAI,GAAGrM,MAAM,CAACiM,QAAQ,CAACI,IAAI;IACjC,OAAOA,IAAI,CAAC/O,QAAQ,CAAC,cAAc,CAAC,IAAI+O,IAAI,CAAC/O,QAAQ,CAAC,eAAe,CAAC;EACxE;EAEA;;;EAGMvF,iBAAiBA,CAAA;IAAA,IAAA+f,OAAA;IAAA,OAAAvgB,+IAAA;MACrB,IAAI,CAACugB,OAAI,CAACjgB,kBAAkB,EAAE,EAAE;QAC9B,OAAO,KAAK;MACd;MAEA,MAAMwF,GAAG,GAAG2C,MAAM,CAACiM,QAAQ,CAACC,IAAI;MAChC,aAAa4L,OAAI,CAACxI,qBAAqB,CAACjS,GAAG,CAAC;IAAC;EAC/C;;mBA3pBW7D,eAAe;;mCAAfA,gBAAe,EAAAH,sDAAA,CAAAE,sGAAA;AAAA;;SAAfC,gBAAe;EAAAuD,OAAA,EAAfvD,gBAAe,CAAAwD,IAAA;EAAAC,UAAA,EAFd;AAAM,G;;;;;;;;;;;;;;;ACvEpB,MAAM8a,YAAY,GAAG,OAAOC,SAAS,KAAK,WAAW,GAAG,CAACA,SAAS,GAAG,KAAK;AAE1E;AACA,MAAMC,gBAAgB,GAAG;EACvBC,UAAU,EAAE,IAAI;EAChBjL,QAAQ,EAAE;IACR5P,GAAG,EAAE,0CAA0C;IAC/CmF,GAAG,EAAE;GACN;EACD3D,MAAM,EAAE,yBAAyB;EACjCsZ,aAAa,EAAE;CAChB;AAED;AACA,MAAMC,iBAAiB,GAAG;EACxBF,UAAU,EAAE,KAAK;EACjBjL,QAAQ,EAAE;IACR5P,GAAG,EAAE,0CAA0C;IAC/CmF,GAAG,EAAE;GACN;EACD3D,MAAM,EAAE,uBAAuB;EAC/BsZ,aAAa,EAAE;CAChB;AAEM,MAAMla,WAAW,GAAG8Z,YAAY,GAAGE,gBAAgB,GAAGG,iBAAiB,C;;;;;;;;;;;;;;;;;AC1B/B;AACkB;AACd;AACN;AACY;AAEzD,IAAIna,kEAAW,CAACia,UAAU,EAAE;EAC1BG,6DAAc,EAAE;AAClB;AAEAC,+EAAoB,CAACzhB,4DAAY,EAAEqE,sDAAS,CAAC,CAACkN,KAAK,CAAEuE,GAAG,IACtDnV,OAAO,CAACa,KAAK,CAACsU,GAAG,CAAC,CACnB,C;;;;;;;;;;ACZD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA,0C","sources":["./src/app/app.component.ts","./src/app/app.config.ts","./src/app/app.routes.ts","./src/app/core/guards/auth.guard.ts","./src/app/core/interceptors/error.interceptor.ts","./src/app/core/services/auth.service.ts","./src/app/core/services/cross-platform-storage.service.ts","./src/app/core/services/deep-link.service.ts","./src/app/debug-auth.page.ts","./src/app/services/supabase.service.ts","./src/environments/environment.ts","./src/main.ts","./node_modules/@stencil/core/internal/client/ lazy ^\\.\\/.*\\.entry\\.js.*$ include: \\.entry\\.js$ exclude: \\.system\\.entry\\.js$ strict namespace object"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { RouterOutlet, Router } from '@angular/router';\r\nimport { SupabaseService } from './services/supabase.service';\r\nimport { AuthService } from './core/services/auth.service';\r\nimport { DeepLinkService } from './core/services/deep-link.service';\r\nimport { Capacitor } from '@capacitor/core';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  standalone: true,\r\n  imports: [RouterOutlet],\r\n  template: '<router-outlet></router-outlet>',\r\n})\r\nexport class AppComponent implements OnInit {\r\n  private isNative = Capacitor.isNativePlatform();\r\n\r\n  constructor(\r\n    private supabaseService: SupabaseService,\r\n    private authService: AuthService,\r\n    private deepLinkService: DeepLinkService,\r\n    private router: Router\r\n  ) {}\r\n\r\n  async ngOnInit() {\r\n    console.log(' App initializing...');\r\n    \r\n    // Initialize deep link service (this will set up listeners for native platforms)\r\n    // The DeepLinkService constructor already handles initialization\r\n    \r\n    // Handle session restoration\r\n    await this.initializeSession();\r\n    \r\n    console.log(' App initialization complete');\r\n  }\r\n\r\n  /**\r\n   * Initialize session on app startup\r\n   */\r\n  private async initializeSession(): Promise<void> {\r\n    try {\r\n      console.log(' Initializing session...');\r\n      \r\n      // For web platform, check if there are auth tokens in the URL\r\n      if (!this.isNative) {\r\n        const hasTokensInUrl = this.supabaseService.hasAuthTokensInUrl();\r\n        if (hasTokensInUrl) {\r\n          console.log(' Found auth tokens in URL, processing...');\r\n          const success = await this.supabaseService.setSessionFromUrl();\r\n          if (success) {\r\n            console.log(' Session restored from URL tokens');\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Check if we have an existing session\r\n      const session = this.supabaseService.currentSession;\r\n      const user = this.supabaseService.currentUser;\r\n      \r\n      if (session && user) {\r\n        console.log(' Existing session found, user is authenticated');\r\n        // Handle session restoration in AuthService\r\n        await this.authService.handleSessionRestoration();\r\n      } else {\r\n        console.log(' No existing session found');\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error(' Error initializing session:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sync AuthService with SupabaseService state\r\n   */\r\n  private async syncAuthService(): Promise<void> {\r\n    try {\r\n      const user = this.supabaseService.currentUser;\r\n      const profile = this.supabaseService.currentProfile;\r\n      \r\n      if (user && profile) {\r\n        // Convert Supabase profile to AuthResponse format for AuthService\r\n        const authResponse = {\r\n          token: 'supabase-session-token',\r\n          user: {\r\n            id: profile.id,\r\n            email: profile.email,\r\n            role: profile.role,\r\n            username: profile.username,\r\n            firstName: profile.first_name,\r\n            lastName: profile.last_name,\r\n          }\r\n        };\r\n        \r\n        // Update AuthService state\r\n        this.authService['currentUserSubject'].next(authResponse);\r\n        \r\n        console.log(' AuthService synced with Supabase session');\r\n      }\r\n    } catch (error) {\r\n      console.error(' Error syncing AuthService:', error);\r\n    }\r\n  }\r\n}\r\n","import { ApplicationConfig } from '@angular/core';\nimport { provideRouter } from '@angular/router';\nimport { provideHttpClient } from '@angular/common/http';\nimport { provideIonicAngular } from '@ionic/angular/standalone';\nimport { routes } from './app.routes';\nimport { AuthService } from './core/services/auth.service';\nimport { ErrorInterceptor } from './core/interceptors/error.interceptor';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { CrossPlatformStorageService } from './core/services/cross-platform-storage.service';\nimport { DeepLinkService } from './core/services/deep-link.service';\n\nexport const appConfig: ApplicationConfig = {\n  providers: [\n    provideRouter(routes),\n    provideHttpClient(),\n    provideIonicAngular(),\n    AuthService,\n    CrossPlatformStorageService,\n    DeepLinkService,\n    { provide: HTTP_INTERCEPTORS, useClass: ErrorInterceptor, multi: true },\n  ],\n};\n","import { Routes } from '@angular/router';\nimport { AuthGuard, NoAuthGuard } from './core/guards/auth.guard';\nimport { DebugAuthPage } from './debug-auth.page';\n\nexport const routes: Routes = [\n  {\n    path: 'debug-auth',\n    component: DebugAuthPage,\n  },\n  {\n    path: 'welcome',\n    canActivate: [NoAuthGuard],\n    loadChildren: () =>\n      import('./platforms/welcome/welcome.routes').then((m) => m.routes),\n  },\n  {\n    path: 'auth',\n    canActivate: [NoAuthGuard],\n    loadChildren: () =>\n      import('./platforms/auth/auth.routes').then((m) => m.routes),\n  },\n  {\n    path: 'player',\n    canActivate: [AuthGuard],\n    data: { expectedRole: 'player' },\n    loadChildren: () =>\n      import('./platforms/player/player.routes').then((m) => m.routes),\n  },\n  {\n    path: 'group-admin',\n    canActivate: [AuthGuard],\n    data: { expectedRole: 'group-admin' },\n    loadChildren: () =>\n      import('./platforms/group-admin/group-admin.routes').then(\n        (m) => m.routes\n      ),\n  },\n  // Super-admin routes - split into public and protected\n  {\n    path: 'super-admin',\n    loadChildren: () =>\n      import('./platforms/super-admin/super-admin.routes').then(\n        (m) => m.routes\n      ),\n  },\n  {\n    path: '',\n    redirectTo: 'welcome',\n    pathMatch: 'full',\n  },\n  // Fallback route for any unmatched paths\n  { \n    path: '**', \n    redirectTo: 'auth/login' \n  }\n];\n","import { Injectable } from '@angular/core';\nimport { Router, ActivatedRouteSnapshot } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { map, take } from 'rxjs/operators';\nimport { User } from '../interfaces/user.interface';\nimport { AuthService } from '../services/auth.service';\n\n@Injectable({ providedIn: 'root' })\nexport class AuthGuard {\n  constructor(\n    private router: Router,\n    private authService: AuthService\n  ) {}\n\n  private getLoginRoute(expectedRole?: string): string {\n    switch (expectedRole) {\n      case 'super-admin':\n        return '/super-admin/login';\n      default:\n        return '/auth/login';\n    }\n  }\n\n  canActivate(route: ActivatedRouteSnapshot): boolean | Promise<boolean> | Observable<boolean> {\n    return this.authService.currentUser.pipe(\n      take(1),\n      map(authResponse => {\n        try {\n          // Get expected role from route data\n          const expectedRole = route.data?.['expectedRole'];\n          \n          // Check if user is authenticated using the reactive state\n          if (!authResponse || !authResponse.user) {\n            const loginRoute = this.getLoginRoute(expectedRole);\n            this.router.navigate([loginRoute]);\n            return false;\n          }\n          \n          // Get user role from the auth response\n          const userRole = authResponse.user.role;\n          \n          // If no expected role is specified, just check if user is authenticated\n          if (!expectedRole) {\n            return true;\n          }\n\n          // Check if user role matches expected role\n          if (userRole === expectedRole) {\n            return true;\n          }\n\n          // Role mismatch - redirect to appropriate login\n          const loginRoute = this.getLoginRoute(expectedRole);\n          this.router.navigate([loginRoute]);\n          return false;\n        } catch (error) {\n          // Error parsing user data - redirect to default login\n          const loginRoute = this.getLoginRoute(route.data?.['expectedRole']);\n          console.error('AuthGuard: Error getting user data, redirecting to login:', error);\n          this.router.navigate([loginRoute]);\n          return false;\n        }\n      })\n    );\n  }\n}\n\n@Injectable({ providedIn: 'root' })\nexport class NoAuthGuard {\n  constructor(\n    private router: Router,\n    private authService: AuthService\n  ) {}\n\n  canActivate(route: ActivatedRouteSnapshot): boolean | Promise<boolean> | Observable<boolean> {\n    return this.authService.currentUser.pipe(\n      take(1),\n      map(authResponse => {\n        try {\n          // Special case: Allow access to reset-password page even for authenticated users\n          if (route.routeConfig?.path === 'reset-password') {\n            return true;\n          }\n          \n          // Also check the full URL path for reset-password\n          const currentUrl = this.router.url;\n          if (currentUrl.includes('reset-password')) {\n            return true;\n          }\n          \n          if (!authResponse || !authResponse.user) {\n            return true; // No authenticated user, allow access to public routes\n          }\n\n          // User is authenticated, redirect to their appropriate route\n          const userRole = authResponse.user.role;\n          \n          // For Supabase users, we'll use the first-time route logic from AuthService\n          // Check if this is a first login by looking at the user data\n          const isFirstLogin = this.authService.isFirstTimeUser();\n          \n          if (isFirstLogin) {\n            // First time user - redirect to first-time routes\n            switch (userRole) {\n              case 'super-admin':\n                this.router.navigate(['/super-admin/dashboard']);\n                break;\n              case 'group-admin':\n                this.router.navigate(['/group-admin/groups']);\n                break;\n              case 'player':\n                this.router.navigate(['/player/join-group']);\n                break;\n              default:\n                this.router.navigate(['/welcome']);\n            }\n          } else {\n            // Returning user - redirect to dashboard\n            switch (userRole) {\n              case 'super-admin':\n                this.router.navigate(['/super-admin/dashboard']);\n                break;\n              case 'group-admin':\n                this.router.navigate(['/group-admin/dashboard']);\n                break;\n              case 'player':\n                this.router.navigate(['/player/dashboard']);\n                break;\n              default:\n                this.router.navigate(['/welcome']);\n            }\n          }\n          \n          return false;\n        } catch (error) {\n          console.error('NoAuthGuard: Error getting user data:', error);\n          return true; // Allow access to public routes if there's an error\n        }\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpInterceptor,\r\n  HttpRequest,\r\n  HttpHandler,\r\n  HttpEvent,\r\n  HttpErrorResponse,\r\n} from '@angular/common/http';\r\nimport { Router } from '@angular/router';\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\n@Injectable()\r\nexport class ErrorInterceptor implements HttpInterceptor {\r\n  constructor(private router: Router) {}\r\n\r\n  intercept(\r\n    request: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    return next.handle(request).pipe(\r\n      catchError((error: HttpErrorResponse) => {\r\n        if (error.status === 0) {\r\n          // Backend is unreachable\r\n          console.error('Backend service is unavailable');\r\n        }\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { BehaviorSubject, Observable, throwError, timer } from 'rxjs';\nimport { map, catchError, tap, take } from 'rxjs/operators';\nimport { environment } from '../../../environments/environment';\nimport {\n  encryptSensitiveData,\n  hashSecurityAnswer,\n} from '../utils/encryption.utils';\nimport { User } from '../interfaces/user.interface';\nimport { SupabaseService } from '../../services/supabase.service';\n\nexport type UserRole = 'super-admin' | 'group-admin' | 'player';\n\n// Storage Keys - Centralized for easy management\nconst STORAGE_KEYS = {\n  CURRENT_USER: 'sotd_current_user',\n  LAST_ACTIVITY: 'sotd_lastActivity',\n  SESSION_ID: 'sotd_session_id',\n  USE_SUPABASE: 'useSupabase', // Toggle between mock and Supabase\n} as const;\n\n// Session management constants\nconst SESSION_STORAGE_KEY = 'sotd_session_sync';\nconst SESSION_CHECK_INTERVAL = 5000; // Check every 5 seconds for cross-tab sync (less aggressive)\n\nexport interface SignupData {\n  username?: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  password: string;\n  role: UserRole;\n}\n\nexport interface AuthResponse {\n  token: string;\n  user: {\n    id: string;\n    email: string;\n    role: UserRole;\n    username: string;\n    firstName: string;\n    lastName: string;\n  };\n}\n\ninterface LoginData {\n  email: string;\n  password: string;\n  securityQuestion: string;\n  securityAnswer: string;\n}\n\nconst SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes\nconst MAX_LOGIN_ATTEMPTS = 3;\nconst LOCKOUT_DURATION = 15 * 60 * 1000; // 15 minutes\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class AuthService {\n  private currentUserSubject: BehaviorSubject<AuthResponse | null>;\n  public currentUser: Observable<AuthResponse | null>;\n  private apiUrl = environment.apiUrl;\n  private sessionTimer: any;\n  private crossTabTimer: any;\n  private currentSessionId: string = '';\n  private loginAttempts = new Map<\n    string,\n    { count: number; lockoutUntil?: number }\n  >();\n  private useSupabase = true; // Default to Supabase\n  private sessionRestorationInProgress = false;\n  private isInitialized = false;\n  private isHandlingCrossTabEvent = false; // Prevent infinite loops\n  private loginInProgress = false; // Track active login process\n  private lastBroadcastTime = 0; // Throttle broadcasts\n  private readonly BROADCAST_THROTTLE_MS = 1000; // Minimum 1 second between broadcasts\n\n  constructor(\n    private http: HttpClient,\n    private supabaseService: SupabaseService\n  ) {\n    // Generate unique session ID for this tab\n    this.currentSessionId = this.generateSessionId();\n\n    this.currentUserSubject = new BehaviorSubject<AuthResponse | null>(null);\n    this.currentUser = this.currentUserSubject.asObservable();\n\n    // Initialize auth system\n    this.initializeAuth();\n  }\n\n  // Cleanup resources\n  ngOnDestroy(): void {\n    if (this.sessionTimer) {\n      clearInterval(this.sessionTimer);\n    }\n    if (this.crossTabTimer) {\n      clearInterval(this.crossTabTimer);\n    }\n    window.removeEventListener('storage', this.handleStorageChange.bind(this));\n  }\n\n  // Quick debug method to force complete first login for current user (callable from console)\n  async debugForceCompleteFirstLogin(): Promise<void> {\n    console.log(' Debug: Force completing first login for current user...');\n    try {\n      await this.markFirstLoginComplete();\n      console.log(' Debug: First login completion attempted');\n\n      // Wait and check again\n      setTimeout(() => {\n        const isFirstTime = this.isFirstTimeUser();\n        console.log(' Debug: After forced completion, isFirstTimeUser:', isFirstTime);\n      }, 2000);\n    } catch (error) {\n      console.error(' Debug: Error forcing first login completion:', error);\n    }\n  }\n\n  // Debug method to manually clear auth locks\n  async debugClearAuthLocks(): Promise<void> {\n    console.log(' Debug: Manually clearing auth locks...');\n    try {\n      // Access the private method through the supabase service\n      await (this.supabaseService as any).clearAuthLocks();\n      console.log(' Debug: Auth locks clearing attempted');\n    } catch (error) {\n      console.error(' Debug: Error clearing auth locks:', error);\n    }\n  }\n\n  private async initializeAuth() {\n    if (this.isInitialized) return;\n\n    console.log(' AuthService: Initializing auth system...');\n\n    try {\n      // Check if we should use Supabase (default to true)\n      this.useSupabase = localStorage.getItem(STORAGE_KEYS.USE_SUPABASE) !== 'false';\n      if (this.useSupabase) {\n        localStorage.setItem(STORAGE_KEYS.USE_SUPABASE, 'true');\n      }\n\n      // Store session ID for cross-tab communication\n      localStorage.setItem(STORAGE_KEYS.SESSION_ID, this.currentSessionId);\n\n      if (this.useSupabase) {\n        await this.initializeSupabaseAuth();\n      } else {\n        this.initializeSessionTimer();\n      }\n\n      // Initialize cross-tab session synchronization\n      this.initializeCrossTabSync();\n\n      // Check for existing session\n      await this.restoreSession();\n\n      this.isInitialized = true;\n      console.log(' AuthService: Auth system initialized');\n\n    } catch (error) {\n      console.error(' AuthService: Failed to initialize auth system:', error);\n      this.isInitialized = true; // Still mark as initialized to prevent retry loops\n    }\n  }\n\n  private async initializeSupabaseAuth() {\n    // Subscribe to Supabase auth state changes\n    this.supabaseService.user$.subscribe(user => {\n      this.handleSupabaseAuthStateChange(user);\n    });\n  }\n\n  private async handleSupabaseAuthStateChange(user: any) {\n    if (user) {\n      this.sessionRestorationInProgress = true;\n\n      try {\n        // Get profile data\n        this.supabaseService.profile$.pipe(take(1)).subscribe(profile => {\n          if (profile) {\n            const authResponse: AuthResponse = {\n              token: `supabase-session-${Date.now()}`,\n              user: {\n                id: profile.id,\n                email: profile.email,\n                role: profile.role,\n                username: profile.username,\n                firstName: profile.first_name,\n                lastName: profile.last_name,\n              }\n            };\n\n            this.setAuthenticatedUser(authResponse);\n            console.log(' AuthService: User session restored', {\n              userId: user.id,\n              role: profile.role,\n              firstLogin: profile.first_login\n            });\n          }\n          this.sessionRestorationInProgress = false;\n        });\n      } catch (error) {\n        console.error(' AuthService: Error handling auth state change:', error);\n        this.sessionRestorationInProgress = false;\n      }\n    } else {\n      // User logged out - clear session silently if not in an active login/restore process\n      if (!this.sessionRestorationInProgress && !this.loginInProgress) {\n        this.clearAuthenticatedUserInternal();\n        console.log(' AuthService: User session cleared');\n      }\n    }\n  }\n\n  // Enable Supabase authentication\n  enableSupabaseAuth(): void {\n    this.useSupabase = true;\n    localStorage.setItem(STORAGE_KEYS.USE_SUPABASE, 'true');\n  }\n\n  // Disable Supabase authentication (for development)\n  disableSupabaseAuth(): void {\n    this.useSupabase = false;\n    localStorage.setItem(STORAGE_KEYS.USE_SUPABASE, 'false');\n  }\n\n  // Session ID generation for cross-tab sync\n  private generateSessionId(): string {\n    return `session_${Date.now()}_${Math.random().toString(36).substring(2)}`;\n  }\n\n  // Cross-tab session synchronization\n  private initializeCrossTabSync(): void {\n    // Listen for storage changes from other tabs\n    window.addEventListener('storage', this.handleStorageChange.bind(this));\n\n    // Periodically check for session changes\n    this.crossTabTimer = setInterval(() => {\n      this.checkCrossTabSession();\n    }, SESSION_CHECK_INTERVAL);\n  }\n\n  private handleStorageChange(event: StorageEvent): void {\n    if (event.key === SESSION_STORAGE_KEY && !this.isHandlingCrossTabEvent) {\n      const sessionData = event.newValue;\n      if (sessionData) {\n        try {\n          const { action, sessionId } = JSON.parse(sessionData);\n\n          // Ignore events from this tab\n          if (sessionId === this.currentSessionId) return;\n\n          // Set flag to prevent recursive calls\n          this.isHandlingCrossTabEvent = true;\n\n          switch (action) {\n            case 'login':\n              console.log(' AuthService: Cross-tab login detected');\n              this.restoreSession();\n              break;\n            case 'logout':\n              console.log(' AuthService: Cross-tab logout detected');\n              // Clear local state without broadcasting to prevent loops\n              this.clearAuthenticatedUserInternal();\n              break;\n          }\n        } catch (error) {\n          console.error(' AuthService: Error parsing cross-tab session data:', error);\n        } finally {\n          // Clear flag after a short delay\n          setTimeout(() => {\n            this.isHandlingCrossTabEvent = false;\n          }, 100);\n        }\n      }\n    }\n  }\n\n  private checkCrossTabSession(): void {\n    // Skip if already handling cross-tab events to prevent loops\n    if (this.isHandlingCrossTabEvent || this.loginInProgress) return;\n\n    const currentUser = this.currentUserValue;\n    const storedUser = this.getStoredUser();\n\n    // Check if session state differs between tabs\n    if (!currentUser && storedUser) {\n      console.log(' AuthService: Session found in storage, restoring...');\n      this.sessionRestorationInProgress = true;\n      this.currentUserSubject.next(storedUser);\n      this.sessionRestorationInProgress = false;\n    } else if (currentUser && !storedUser) {\n      console.log(' AuthService: Session cleared in storage, clearing local...');\n      this.currentUserSubject.next(null);\n    }\n    // If both are the same, do nothing (no need to log every time)\n  }\n\n  // Centralized session management\n  private setAuthenticatedUser(authResponse: AuthResponse): void {\n    // Check if this is the same user to prevent duplicate broadcasts\n    const currentUser = this.currentUserValue;\n    const isSameUser = currentUser?.user?.id === authResponse.user.id;\n\n    // Check if user data has actually changed\n    const userDataChanged = !currentUser ||\n      currentUser.user.id !== authResponse.user.id ||\n      currentUser.user.email !== authResponse.user.email ||\n      currentUser.user.role !== authResponse.user.role;\n\n    // Update reactive state\n    this.currentUserSubject.next(authResponse);\n\n    // Store in localStorage\n    localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(authResponse));\n    localStorage.setItem(STORAGE_KEYS.LAST_ACTIVITY, Date.now().toString());\n\n    // Only broadcast if this is a genuinely new/different user login (not session restoration)\n    if (userDataChanged && !this.sessionRestorationInProgress && !this.loginInProgress) {\n      this.broadcastSessionChange('login');\n      console.log(' AuthService: Broadcasting new user login');\n    } else {\n      console.log(' AuthService: Skipping broadcast - user data unchanged or in progress');\n    }\n\n    console.log(' AuthService: User authenticated and session stored');\n  }\n\n  private clearAuthenticatedUser(): void {\n    // Clear reactive state first\n    this.currentUserSubject.next(null);\n\n    // Clear all session storage\n    this.clearUserStorage();\n\n    // Notify other tabs (only if not handling cross-tab event)\n    if (!this.isHandlingCrossTabEvent) {\n      this.broadcastSessionChange('logout');\n    }\n\n    console.log(' AuthService: User session cleared completely');\n  }\n\n  // Internal method that clears user without broadcasting (for cross-tab events)\n  private clearAuthenticatedUserInternal(): void {\n    // Clear reactive state first\n    this.currentUserSubject.next(null);\n\n    // Clear all session storage\n    this.clearUserStorage();\n\n    // Do NOT broadcast to prevent loops\n\n    console.log(' AuthService: User session cleared internally (cross-tab)');\n  }\n\n  private broadcastSessionChange(action: 'login' | 'logout'): void {\n    // Don't broadcast if we're handling a cross-tab event\n    if (this.isHandlingCrossTabEvent) return;\n\n    // Throttle broadcasts to prevent spam\n    const now = Date.now();\n    if (now - this.lastBroadcastTime < this.BROADCAST_THROTTLE_MS) {\n      console.log(` AuthService: Throttling ${action} broadcast (too soon)`);\n      return;\n    }\n    this.lastBroadcastTime = now;\n\n    const sessionData = {\n      action,\n      sessionId: this.currentSessionId,\n      timestamp: Date.now()\n    };\n\n    try {\n      localStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(sessionData));\n      console.log(` AuthService: Broadcasting ${action} to other tabs`);\n\n      // Clean up broadcast data after a short delay\n      setTimeout(() => {\n        try {\n          const currentData = localStorage.getItem(SESSION_STORAGE_KEY);\n          if (currentData === JSON.stringify(sessionData)) {\n            localStorage.removeItem(SESSION_STORAGE_KEY);\n          }\n        } catch (error) {\n          // Ignore cleanup errors\n        }\n      }, 500);\n    } catch (error) {\n      console.error(' AuthService: Error broadcasting session change:', error);\n    }\n  }\n\n  private clearUserStorage(): void {\n    localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);\n    localStorage.removeItem(STORAGE_KEYS.LAST_ACTIVITY);\n    localStorage.removeItem(SESSION_STORAGE_KEY);\n\n    // Clean up any legacy storage keys\n    const legacyKeys = ['user', 'pendingUserData', 'isFirstLogin'];\n    legacyKeys.forEach(key => localStorage.removeItem(key));\n\n    // Clean up any pending signup data\n    const keys = Object.keys(localStorage);\n    keys.forEach(key => {\n      if (key.startsWith('pending') || key.startsWith('sotd_temp_')) {\n        localStorage.removeItem(key);\n      }\n    });\n  }\n\n  private async restoreSession(): Promise<void> {\n    try {\n      const storedUser = this.getStoredUser();\n      if (storedUser && this.isSessionValid()) {\n        this.currentUserSubject.next(storedUser);\n        console.log(' AuthService: Session restored successfully');\n      } else {\n        console.log(' AuthService: No valid session to restore');\n      }\n    } catch (error) {\n      console.error(' AuthService: Error restoring session:', error);\n    }\n  }\n\n  private isSessionValid(): boolean {\n    const lastActivity = localStorage.getItem(STORAGE_KEYS.LAST_ACTIVITY);\n    if (!lastActivity) return false;\n\n    const timeSinceLastActivity = Date.now() - Number(lastActivity);\n    return timeSinceLastActivity <= SESSION_TIMEOUT;\n  }\n\n  private getStoredUser(): AuthResponse | null {\n    const storedUser = localStorage.getItem(STORAGE_KEYS.CURRENT_USER);\n    if (!storedUser) return null;\n\n    try {\n    const user = JSON.parse(storedUser);\n    const lastActivity = localStorage.getItem(STORAGE_KEYS.LAST_ACTIVITY);\n\n    if (lastActivity && Date.now() - Number(lastActivity) > SESSION_TIMEOUT) {\n      this.clearUserStorage();\n      return null;\n    }\n\n      // Ensure the stored user has the correct AuthResponse structure\n      if (user && user.user && user.token) {\n    return user;\n      }\n      \n      // If it's in the old User format, convert it to AuthResponse format\n      if (user && user.role && !user.user) {\n        return {\n          token: 'mock-jwt-token',\n          user: {\n            id: user.id || 'mock-id',\n            email: user.email || 'mock@example.com',\n            role: user.role,\n            username: user.username || 'User',\n            firstName: user.firstName || 'Unknown',\n            lastName: user.lastName || 'User'\n          }\n        };\n      }\n\n      return null;\n    } catch (error) {\n      console.error('Error parsing stored user data:', error);\n      this.clearUserStorage();\n      return null;\n    }\n  }\n\n  private initializeSessionTimer() {\n    if (this.sessionTimer) {\n      clearInterval(this.sessionTimer);\n    }\n\n    this.sessionTimer = setInterval(() => {\n      const lastActivity = localStorage.getItem(STORAGE_KEYS.LAST_ACTIVITY);\n      if (lastActivity && Date.now() - Number(lastActivity) > SESSION_TIMEOUT) {\n        this.logout();\n      }\n    }, 60000); // Check every minute\n  }\n\n  private updateLastActivity() {\n    localStorage.setItem(STORAGE_KEYS.LAST_ACTIVITY, Date.now().toString());\n  }\n\n  private checkLoginAttempts(email: string): boolean {\n    const attempts = this.loginAttempts.get(email);\n\n    if (attempts?.lockoutUntil && Date.now() < attempts.lockoutUntil) {\n      throw new Error(\n        `Account locked. Try again after ${new Date(\n          attempts.lockoutUntil\n        ).toLocaleTimeString()}`\n      );\n    }\n\n    const attemptCount = attempts?.count || 0;\n    if (attemptCount >= MAX_LOGIN_ATTEMPTS) {\n      const lockoutUntil = Date.now() + LOCKOUT_DURATION;\n      this.loginAttempts.set(email, { count: 0, lockoutUntil });\n      throw new Error(\n        `Too many login attempts. Account locked until ${new Date(\n          lockoutUntil\n        ).toLocaleTimeString()}`\n      );\n    }\n\n    return true;\n  }\n\n  public get currentUserValue(): AuthResponse | null {\n    return this.currentUserSubject.value;\n  }\n\n  login(loginData: LoginData): Observable<AuthResponse> {\n    if (this.useSupabase) {\n      return this.loginWithSupabase(loginData);\n    } else {\n      return this.loginWithMock(loginData);\n    }\n  }\n\n  private loginWithSupabase(loginData: LoginData): Observable<AuthResponse> {\n    return new Observable(subscriber => {\n      // First, check if user is already authenticated\n      const currentUser = this.currentUserValue;\n      if (currentUser && currentUser.user.email === loginData.email) {\n        console.log(' AuthService: User already authenticated, skipping login');\n        subscriber.next(currentUser);\n        subscriber.complete();\n        return;\n      }\n      \n      // Check if there's an existing Supabase session\n      const supabaseUser = this.supabaseService.currentUser;\n      if (supabaseUser && supabaseUser.email === loginData.email) {\n        console.log(' AuthService: Found existing Supabase session, using it');\n        this.handleExistingSupabaseSession(supabaseUser, subscriber);\n        return;\n      }\n      \n      // If session restoration is in progress, wait for it\n      if (this.sessionRestorationInProgress) {\n        console.log(' AuthService: Session restoration in progress, waiting...');\n        const checkInterval = setInterval(() => {\n          if (!this.sessionRestorationInProgress) {\n            clearInterval(checkInterval);\n            const restoredUser = this.currentUserValue;\n            if (restoredUser && restoredUser.user.email === loginData.email) {\n              console.log(' AuthService: Session restoration completed, using restored user');\n              subscriber.next(restoredUser);\n              subscriber.complete();\n              return;\n            }\n          }\n        }, 100);\n        \n        // Fallback timeout for session restoration\n        setTimeout(() => {\n          clearInterval(checkInterval);\n          if (this.sessionRestorationInProgress) {\n            console.log(' AuthService: Session restoration timeout, proceeding with manual login');\n            this.performSupabaseLogin(loginData, subscriber);\n          }\n        }, 5000);\n        return;\n      }\n      \n      // Proceed with manual login\n      this.performSupabaseLogin(loginData, subscriber);\n    });\n  }\n\n  private async handleExistingSupabaseSession(supabaseUser: any, subscriber: any) {\n    try {\n      console.log(' AuthService: Handling existing Supabase session...');\n      \n      // Get profile data for the existing user\n      const profileResult = await this.supabaseService.client\n        .from('profiles')\n        .select('*')\n        .eq('id', supabaseUser.id)\n        .single();\n\n      if (profileResult.error) {\n        console.log(' Profile not found for existing user, creating fallback profile');\n        const userMetadata = supabaseUser.user_metadata || {};\n        const fallbackResponse: AuthResponse = {\n          token: 'existing-session-token',\n          user: {\n            id: supabaseUser.id,\n            email: supabaseUser.email || 'unknown@example.com',\n            role: userMetadata.role || 'player' as UserRole,\n            username: userMetadata.username || supabaseUser.email?.split('@')[0] || 'user',\n            firstName: userMetadata.first_name || 'User',\n            lastName: userMetadata.last_name || 'User',\n          }\n        };\n        \n        localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(fallbackResponse));\n        this.currentUserSubject.next(fallbackResponse);\n        subscriber.next(fallbackResponse);\n        subscriber.complete();\n        return;\n      }\n\n      const profile = profileResult.data;\n      const authResponse: AuthResponse = {\n        token: 'existing-session-token',\n        user: {\n          id: profile.id,\n          email: profile.email,\n          role: profile.role,\n          username: profile.username,\n          firstName: profile.first_name,\n          lastName: profile.last_name,\n        }\n      };\n      \n      this.setAuthenticatedUser(authResponse);\n      subscriber.next(authResponse);\n      subscriber.complete();\n    } catch (error) {\n      console.error(' Error handling existing Supabase session:', error);\n      subscriber.error(error);\n    }\n  }\n\n  private async performSupabaseLogin(loginData: LoginData, subscriber: any) {\n    try {\n      console.log(' AuthService: Starting Supabase login...');\n      this.loginInProgress = true;\n\n      // Clear any existing session state silently (without cross-tab broadcast)\n      this.clearAuthenticatedUserInternal();\n\n      console.log(' AuthService: Calling supabaseService.signIn...');\n      \n      // Add timeout wrapper to prevent hanging on NavigatorLockAcquireTimeoutError\n      const signInPromise = this.supabaseService.signIn(loginData.email, loginData.password);\n      const timeoutPromise = new Promise((_, reject) => {\n        setTimeout(() => reject(new Error('SignIn timeout')), 45000); // 45 second timeout to account for lock clearing\n      });\n      \n      let result;\n      try {\n        result = await Promise.race([signInPromise, timeoutPromise]) as any;\n        console.log(' AuthService: Supabase signIn completed:', result);\n        console.log(' AuthService: About to fetch profile for user:', result.user?.id);\n      } catch (signInError) {\n        console.error(' AuthService: SignIn failed or timed out:', signInError);\n        this.loginInProgress = false;\n        // Don't create fallback response - let the error propagate\n        subscriber.error(signInError);\n        return;\n      }\n        \n        // Create AuthResponse directly from Supabase result\n        if (result.user && result.session) {\n          // Fetch profile data directly from Supabase\n          try {\n            console.log(' AuthService: Fetching profile from database...');\n            const profileResult = await this.supabaseService.client\n              .from('profiles')\n              .select('*')\n              .eq('id', result.user.id)\n              .single();\n            console.log(' AuthService: Profile fetch result:', profileResult);\n\n            if (profileResult.error) {\n              console.log(' Profile not found for new user, creating fallback profile');\n              // For new users without profiles, create a fallback response\n              // Try to get username from user metadata first, then fallback to email prefix\n              const userMetadata = (result.user as any).user_metadata || {};\n              const username = userMetadata.username || (result.user.email ? result.user.email.split('@')[0] : 'user');\n              const firstName = userMetadata.first_name || 'User';\n              const lastName = userMetadata.last_name || 'User';\n              const role = userMetadata.role || 'player';\n              \n              const fallbackResponse: AuthResponse = {\n                token: result.session.access_token,\n                user: {\n                  id: result.user.id,\n                  email: result.user.email || 'unknown@example.com',\n                  role: role as UserRole,\n                  username: username,\n                  firstName: firstName,\n                  lastName: lastName,\n                }\n              };\n              \n              // Store in localStorage for consistency\n              localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(fallbackResponse));\n              \n              // Update reactive state\n              this.currentUserSubject.next(fallbackResponse);\n              \n              subscriber.next(fallbackResponse);\n              subscriber.complete();\n              return;\n            }\n\n            const profile = profileResult.data;\n            if (profile) {\n              const authResponse: AuthResponse = {\n                token: result.session.access_token,\n                user: {\n                  id: profile.id,\n                  email: profile.email,\n                  role: profile.role,\n                  username: profile.username,\n                  firstName: profile.first_name,\n                  lastName: profile.last_name,\n                }\n              };\n              \n              // Store authenticated user with cross-tab sync\n              this.setAuthenticatedUser(authResponse);\n\n              this.loginInProgress = false;\n              subscriber.next(authResponse);\n              subscriber.complete();\n            } else {\n              console.log(' No profile data found, creating fallback profile');\n              // Fallback for users with no profile data\n              // Try to get username from user metadata first, then fallback to email prefix\n              const userMetadata = (result.user as any).user_metadata || {};\n              const username = userMetadata.username || (result.user.email ? result.user.email.split('@')[0] : 'user');\n              const firstName = userMetadata.first_name || 'User';\n              const lastName = userMetadata.last_name || 'User';\n              const role = userMetadata.role || 'player';\n              \n              const fallbackResponse: AuthResponse = {\n                token: result.session.access_token,\n                user: {\n                  id: result.user.id,\n                  email: result.user.email || 'unknown@example.com',\n                  role: role as UserRole,\n                  username: username,\n                  firstName: firstName,\n                  lastName: lastName,\n                }\n              };\n              \n              localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(fallbackResponse));\n              this.currentUserSubject.next(fallbackResponse);\n\n              this.loginInProgress = false;\n              subscriber.next(fallbackResponse);\n              subscriber.complete();\n            }\n          } catch (error) {\n            console.error(' Error fetching profile:', error);\n            console.log(' AuthService: Creating fallback profile due to fetch error');\n            // Create fallback profile when profile fetch fails\n            const userMetadata = (result.user as any).user_metadata || {};\n            const username = userMetadata.username || (result.user.email ? result.user.email.split('@')[0] : 'user');\n            const firstName = userMetadata.first_name || 'User';\n            const lastName = userMetadata.last_name || 'User';\n            const role = userMetadata.role || 'player';\n            \n            const fallbackResponse: AuthResponse = {\n              token: result.session.access_token,\n              user: {\n                id: result.user.id,\n                email: result.user.email || 'unknown@example.com',\n                role: role as UserRole,\n                username: username,\n                firstName: firstName,\n                lastName: lastName,\n              }\n            };\n            \n            localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(fallbackResponse));\n            this.currentUserSubject.next(fallbackResponse);\n\n            this.loginInProgress = false;\n            subscriber.next(fallbackResponse);\n            subscriber.complete();\n          }\n        } else {\n          console.error(' Invalid Supabase login result');\n          this.loginInProgress = false;\n          subscriber.error(new Error('Invalid login result'));\n        }\n    } catch (error) {\n      console.error(' Supabase login failed:', error);\n      this.loginInProgress = false;\n      subscriber.error(error);\n    }\n  }\n\n  private loginWithMock(loginData: LoginData): Observable<AuthResponse> {\n    // For mock purposes, try to determine user data from stored signup data or use defaults\n    let userRole: UserRole = 'player';\n    let username = 'User';\n    let firstName = 'John';\n    let lastName = 'Doe';\n    \n    // Check if we have stored user information from signup\n    const storedRole = localStorage.getItem(`pendingRole_${loginData.email}`);\n    const storedUsername = localStorage.getItem(`pendingUsername_${loginData.email}`);\n    const storedFirstName = localStorage.getItem(`pendingFirstName_${loginData.email}`);\n    const storedLastName = localStorage.getItem(`pendingLastName_${loginData.email}`);\n    \n    if (storedRole && ['player', 'group-admin', 'super-admin'].includes(storedRole)) {\n      userRole = storedRole as UserRole;\n    }\n    if (storedUsername) {\n      username = storedUsername;\n    }\n    if (storedFirstName) {\n      firstName = storedFirstName;\n    }\n    if (storedLastName) {\n      lastName = storedLastName;\n    }\n\n    // Mock response for frontend development\n    const mockResponse: AuthResponse = {\n      token: 'mock-jwt-token',\n      user: {\n        id: `user_${loginData.email.replace(/[^a-zA-Z0-9]/g, '_')}`,\n        email: loginData.email,\n        username: username,\n        firstName: firstName,\n        lastName: lastName,\n        role: userRole,\n      },\n    };\n\n    // Return mock response\n    return new Observable((subscriber) => {\n      setTimeout(() => {\n        // Store in legacy format for compatibility\n        localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(mockResponse));\n        localStorage.setItem(STORAGE_KEYS.LAST_ACTIVITY, Date.now().toString());\n        \n        // Store in new format for AuthGuard\n        const hasCompletedFirstLogin = localStorage.getItem(`firstLoginComplete_${mockResponse.user.email}`) === 'true';\n        const isFirstLogin = !hasCompletedFirstLogin;\n        \n        // User object for mock login tracking\n        const userForMock: User = {\n          id: mockResponse.user.id,\n          role: mockResponse.user.role,\n          firstLogin: isFirstLogin,\n          username: username,\n          firstName: mockResponse.user.firstName,\n          lastName: mockResponse.user.lastName,\n          email: mockResponse.user.email\n        };\n\n        console.log(' AuthService: Mock user created:', userForMock);\n        // User is automatically stored via setAuthenticatedUser in Supabase flow\n        console.log(' AuthService: User registration completed');\n        \n        // Clean up the temporary signup storage after successful login\n        localStorage.removeItem(`pendingRole_${loginData.email}`);\n        localStorage.removeItem(`pendingUsername_${loginData.email}`);\n        localStorage.removeItem(`pendingFirstName_${loginData.email}`);\n        localStorage.removeItem(`pendingLastName_${loginData.email}`);\n        \n        this.currentUserSubject.next(mockResponse);\n        subscriber.next(mockResponse);\n        subscriber.complete();\n      }, 500); // Simulate network delay\n    });\n  }\n\n  signup(userData: SignupData): Observable<AuthResponse> {\n    if (this.useSupabase) {\n      return this.signupWithSupabase(userData);\n    } else {\n      return this.signupWithMock(userData);\n    }\n  }\n\n  private signupWithSupabase(userData: SignupData): Observable<AuthResponse> {\n    return new Observable(subscriber => {\n      this.supabaseService.signUp(userData.email, userData.password, {\n        role: userData.role,\n        username: userData.username || '',\n        first_name: userData.firstName,\n        last_name: userData.lastName,\n      })\n      .then(result => {\n        // Create mock AuthResponse for consistency\n        const authResponse: AuthResponse = {\n          token: 'supabase-signup-token',\n          user: {\n            id: result.user?.id || 'temp-id',\n            email: userData.email,\n            role: userData.role,\n            username: userData.username || '',\n            firstName: userData.firstName,\n            lastName: userData.lastName,\n          }\n        };\n        \n        subscriber.next(authResponse);\n        subscriber.complete();\n      })\n      .catch(error => {\n        console.error('Supabase signup failed:', error);\n        subscriber.error(error);\n      });\n    });\n  }\n\n  private signupWithMock(userData: SignupData): Observable<AuthResponse> {\n    // Store the role and username temporarily for login (mock behavior)\n    localStorage.setItem(`pendingRole_${userData.email}`, userData.role);\n    localStorage.setItem(`pendingUsername_${userData.email}`, userData.username || '');\n    localStorage.setItem(`pendingFirstName_${userData.email}`, userData.firstName);\n    localStorage.setItem(`pendingLastName_${userData.email}`, userData.lastName);\n    \n    // Mock response for frontend development\n    const mockResponse: AuthResponse = {\n      token: 'mock-jwt-token',\n      user: {\n        id: `user_${userData.email.replace(/[^a-zA-Z0-9]/g, '_')}`,\n        email: userData.email,\n        role: userData.role,\n        username: userData.username || '',\n        firstName: userData.firstName,\n        lastName: userData.lastName,\n      },\n    };\n\n    // Return mock response - just return success without storing\n    return new Observable((subscriber) => {\n      setTimeout(() => {\n        subscriber.next(mockResponse);\n        subscriber.complete();\n      }, 500); // Simulate network delay\n    });\n  }\n\n  logout(): void {\n    console.log(' AuthService: Starting logout process...');\n\n    // Clear session timer first\n    if (this.sessionTimer) {\n      clearInterval(this.sessionTimer);\n      this.sessionTimer = null;\n    }\n\n    if (this.useSupabase) {\n      // Clear local state immediately using the new method\n      this.clearAuthenticatedUser();\n\n      // Perform Supabase signOut with better error handling\n      this.supabaseService.signOut()\n        .then(() => {\n          console.log(' AuthService: Supabase logout completed successfully');\n        })\n        .catch(error => {\n          console.warn(' AuthService: Supabase logout warning (local cleanup already done):', error.message);\n          // Local cleanup already done, so this is acceptable\n        });\n    } else {\n      this.clearAuthenticatedUser();\n    }\n\n    console.log(' AuthService: Logout process completed');\n  }\n\n  // Clear session and force fresh login\n  clearSession(): void {\n    console.log(' AuthService: Clearing session...');\n    this.clearAuthenticatedUser();\n    console.log(' AuthService: Session cleared');\n  }\n\n  // Silent logout without cross-tab broadcasting (for internal use)\n  logoutSilent(): void {\n    console.log(' AuthService: Performing silent logout...');\n\n    this.currentUserSubject.next(null);\n    this.clearUserStorage();\n\n    if (this.useSupabase) {\n      this.supabaseService.signOut().catch(error => {\n        console.error(' AuthService: Silent Supabase logout failed:', error);\n      });\n    }\n\n    console.log(' AuthService: Silent logout completed');\n  }\n\n\n  // Method to mark first login as complete (called from first-time pages)\n  async markFirstLoginComplete(): Promise<void> {\n    console.log(' AuthService: Marking first login as complete...');\n\n    if (this.useSupabase) {\n      const currentUser = this.currentUserValue;\n      const supabaseUser = this.supabaseService.currentUser;\n\n      if (!currentUser?.user?.id || !supabaseUser?.id) {\n        console.error(' AuthService: No authenticated user found');\n        console.log('CurrentUser:', currentUser);\n        console.log('SupabaseUser:', supabaseUser);\n        throw new Error('No authenticated user found');\n      }\n\n      try {\n        console.log(' AuthService: Attempting to update first_login for user ID:', currentUser.user.id);\n        console.log(' AuthService: Supabase user ID:', supabaseUser.id);\n\n        // Try the Supabase service method first\n        await this.supabaseService.markFirstLoginComplete(currentUser.user.id);\n        console.log(' AuthService: Supabase service update completed');\n\n        // Wait a moment for the profile observable to update\n        await new Promise(resolve => setTimeout(resolve, 500));\n\n        // Force reload the profile from database\n        await this.forceReloadProfile();\n\n        // Verify the update worked\n        setTimeout(async () => {\n          await this.forceReloadProfile(); // Reload again\n          const profile = this.supabaseService.currentProfile;\n          const isStillFirstTime = this.isFirstTimeUser();\n\n          console.log(' AuthService: After marking complete verification:');\n          console.log('  - isFirstTimeUser:', isStillFirstTime);\n          console.log('  - Profile first_login:', profile?.first_login);\n          console.log('  - Profile email:', profile?.email);\n\n          if (isStillFirstTime) {\n            console.warn(' AuthService: First login status still shows as true - trying direct update');\n            await this.directUpdateFirstLoginStatus(currentUser.user.id);\n          }\n        }, 2000);\n\n      } catch (error) {\n        console.error(' AuthService: Failed to mark first login complete:', error);\n        console.log(' AuthService: Trying direct update method...');\n\n        // Fallback: Try direct update (only if client is available)\n        try {\n          if (this.supabaseService.client) {\n            await this.directUpdateFirstLoginStatus(currentUser.user.id);\n          } else {\n            console.log(' AuthService: No Supabase client available, skipping direct update');\n          }\n        } catch (directError) {\n          console.error(' AuthService: Direct update also failed:', directError);\n          // Don't re-throw in test environment without client\n          if (this.supabaseService.client) {\n            throw error;\n          }\n        }\n      }\n    } else {\n      localStorage.setItem('isFirstLogin', 'false');\n      console.log(' AuthService: First login marked complete in local storage');\n    }\n  }\n\n  // Force reload profile from Supabase\n  private async forceReloadProfile(): Promise<void> {\n    const user = this.supabaseService.currentUser;\n    if (user?.id && this.supabaseService.client) {\n      try {\n        const { data: profile, error } = await this.supabaseService.client\n          .from('profiles')\n          .select('*')\n          .eq('id', user.id)\n          .single();\n\n        if (!error && profile) {\n          console.log(' AuthService: Profile reloaded from database:', profile);\n          console.log(' AuthService: Updated first_login status:', profile.first_login);\n\n          // Force the SupabaseService to refresh its profile observable\n          await this.supabaseService.refreshCurrentUserProfile();\n        }\n      } catch (error) {\n        console.error(' AuthService: Error reloading profile:', error);\n      }\n    }\n  }\n\n  // Direct update method as fallback\n  private async directUpdateFirstLoginStatus(userId: string): Promise<void> {\n    if (!this.supabaseService.client) {\n      console.log(' AuthService: No Supabase client available for direct update');\n      return;\n    }\n\n    try {\n      console.log(' AuthService: Direct database update for user:', userId);\n\n      const { data, error } = await this.supabaseService.client\n        .from('profiles')\n        .update({\n          first_login: false,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', userId)\n        .select()\n        .single();\n\n      if (error) {\n        console.error(' AuthService: Direct update error:', error);\n        throw error;\n      }\n\n      console.log(' AuthService: Direct update successful:', data);\n\n      // Profile will be updated automatically by Supabase's realtime subscriptions\n      console.log(' AuthService: Profile update triggered, data:', data);\n\n      await this.forceReloadProfile(); // Double-check\n\n    } catch (error) {\n      console.error(' AuthService: Direct update failed:', error);\n      throw error;\n    }\n  }\n\n  isAuthenticated(): boolean {\n    return !!this.currentUserValue?.token;\n  }\n\n  isSuperAdmin(): boolean {\n    return this.currentUserValue?.user.role === 'super-admin';\n  }\n\n  getToken(): string | null {\n    return this.currentUserValue?.token || null;\n  }\n\n  // Updated to use new storage format\n  isFirstTimeUser(): boolean {\n    console.log(' AuthService: Checking if user is first time...');\n    console.log(' AuthService: useSupabase:', this.useSupabase);\n\n    if (this.useSupabase) {\n      // For Supabase, check the current profile first\n      const profile = this.supabaseService.currentProfile;\n      console.log(' AuthService: Current profile:', profile);\n\n      // If profile is loaded, use its first_login value\n      if (profile) {\n        console.log(' AuthService: Profile loaded - first_login status:', profile.first_login, 'for user:', profile.email);\n        const isFirstTime = profile.first_login === true;\n        console.log(' AuthService: Returning isFirstTime:', isFirstTime);\n        return isFirstTime;\n      }\n\n      // If profile is not loaded yet, try to get from user metadata as fallback\n      const user = this.supabaseService.currentUser;\n      console.log(' AuthService: Current user:', user);\n      if (user?.user_metadata) {\n        console.log(' AuthService: Profile not loaded, checking user metadata:', user.user_metadata);\n        // If first_login is explicitly false, return false; otherwise default to true for safety\n        const isFirstTime = user.user_metadata['first_login'] !== false;\n        console.log(' AuthService: From user metadata, isFirstTime:', isFirstTime);\n        return isFirstTime;\n      }\n\n      // If neither profile nor user metadata is available, default to true (first time)\n      console.log(' AuthService: No profile or user metadata available, defaulting to first time user');\n      return true;\n    } else {\n      // For mock users, check stored firstLogin flag (default to true for new users)\n      const isFirstLogin = localStorage.getItem('isFirstLogin');\n      console.log(' AuthService: Mock mode - isFirstLogin localStorage:', isFirstLogin);\n      const result = isFirstLogin === null || isFirstLogin === 'true';\n      console.log(' AuthService: Mock mode result:', result);\n      return result;\n    }\n  }\n\n  // Updated to use new storage format\n  markUserAsReturning(): void {\n    const user = this.currentUserValue?.user;\n    if (user) {\n      // For mock users, the firstLogin state is now stored in localStorage\n      console.log(' AuthService: Setting first login complete for mock user');\n    }\n  }\n\n  getUserRole(): UserRole | null {\n    const user = this.currentUserValue?.user;\n    return user?.role || this.currentUserValue?.user.role || null;\n  }\n\n  getDefaultDashboardRoute(): string {\n    const role = this.getUserRole();\n    switch (role) {\n      case 'super-admin':\n        return '/super-admin/dashboard';\n      case 'group-admin':\n        return '/group-admin/dashboard';\n      case 'player':\n        return '/player/dashboard';\n      default:\n        return '/welcome';\n    }\n  }\n\n  // New method to get first-time routes\n  getFirstTimeRoute(): string {\n    const role = this.getUserRole();\n    switch (role) {\n      case 'group-admin':\n        return '/group-admin/groups';\n      case 'player':\n        return '/player/join-group';\n      case 'super-admin':\n        return '/super-admin/dashboard'; // Super admin always goes to dashboard\n      default:\n        return '/welcome';\n    }\n  }\n\n  // Get user display name for greetings\n  getUserDisplayName(): string {\n    const user = this.currentUserValue?.user;\n    // Use username for greetings (always available since it's required)\n    return user?.username || 'User';\n  }\n\n  // Get time-based greeting\n  getTimeBasedGreeting(): string {\n    const hour = new Date().getHours();\n    if (hour < 12) return 'Good morning';\n    if (hour < 17) return 'Good afternoon';\n    return 'Good evening';\n  }\n\n  // Get personalized greeting message using username\n  getPersonalizedGreeting(): string {\n    const username = this.getUserDisplayName();\n    const timeGreeting = this.getTimeBasedGreeting();\n    return `${timeGreeting}, ${username}!`;\n  }\n\n  // Public method to get current user data\n  getCurrentUser(): User | null {\n    const currentUser = this.currentUserValue?.user;\n    if (!currentUser) return null;\n\n    // Convert AuthResponse.user to User interface\n    return {\n      id: currentUser.id,\n      email: currentUser.email,\n      role: currentUser.role,\n      username: currentUser.username,\n      firstName: currentUser.firstName,\n      lastName: currentUser.lastName,\n      firstLogin: this.isFirstTimeUser()\n    };\n  }\n\n  /**\n   * Complete user data cleanup - ensures proper user switching\n   */\n  public clearAllUserData(): void {\n    // Get all localStorage keys\n    const allKeys = Object.keys(localStorage);\n    \n    // Remove all user-related keys\n    allKeys.forEach(key => {\n      if (key.startsWith('user') || \n          key.startsWith('pending') || \n          key.startsWith('firstLogin') || \n          key.includes('admin') ||\n          key === 'lastActivity' ||\n          key === 'isFirstLogin' ||\n          key === 'pendingUserData' ||\n          key.startsWith('sb-') ||  // Supabase keys\n          key.includes('supabase')) {\n        localStorage.removeItem(key);\n      }\n    });\n    \n    // Clear session storage as well\n    sessionStorage.clear();\n    \n    // Clear the current user subject\n    this.currentUserSubject.next(null);\n  }\n\n  /**\n   * Emergency auth reset - resolves Supabase lock conflicts\n   */\n  public emergencyAuthReset(): void {\n    // Clear all storage\n    localStorage.clear();\n    sessionStorage.clear();\n    \n    // Reset current user\n    this.currentUserSubject.next(null);\n    \n    // Clear session timer\n    if (this.sessionTimer) {\n      clearInterval(this.sessionTimer);\n      this.sessionTimer = null;\n    }\n  }\n\n  /**\n   * Clear Supabase auth locks and state\n   */\n  public async clearAuthLocks(): Promise<void> {\n    console.log(' AuthService: Clearing Supabase locks...');\n    \n    // Clear local state first\n    this.currentUserSubject.next(null);\n    localStorage.clear();\n    sessionStorage.clear();\n    \n    // Try to clear Supabase locks more aggressively\n    try {\n      // Clear any existing Supabase session\n      await this.supabaseService.client.auth.signOut();\n    } catch (e) {\n      // Ignore errors\n    }\n    \n    // Try to clear the lock manually\n    try {\n      if ('locks' in navigator) {\n        await (navigator as any).locks.query().then((locks: any[]) => {\n          locks.forEach(lock => {\n            if (lock.name.includes('sb-') || lock.name.includes('supabase')) {\n              console.log(' AuthService: Found Supabase lock, attempting to release...');\n            }\n          });\n        });\n      }\n    } catch (e) {\n      // Ignore errors\n    }\n    \n    // Wait a bit for locks to clear\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    console.log(' AuthService: Supabase locks cleared');\n  }\n\n  /**\n   * Emergency reset to resolve NavigatorLockAcquireTimeoutError\n   */\n  public async emergencyReset(): Promise<void> {\n    console.log(' AuthService: Performing emergency reset...');\n    \n    try {\n      // Clear all storage\n      localStorage.clear();\n      sessionStorage.clear();\n      \n      // Clear current user state\n      this.currentUserSubject.next(null);\n      \n      // Clear session timer\n      if (this.sessionTimer) {\n        clearInterval(this.sessionTimer);\n        this.sessionTimer = null;\n      }\n      \n      // Force enable Supabase\n      this.useSupabase = true;\n      localStorage.setItem(STORAGE_KEYS.USE_SUPABASE, 'true');\n      \n      // Wait for locks to clear\n      await new Promise(resolve => setTimeout(resolve, 2000));\n      \n      console.log(' AuthService: Emergency reset complete');\n    } catch (error) {\n      console.error(' AuthService: Emergency reset failed:', error);\n    }\n  }\n\n  /**\n   * Reset password using Supabase\n   */\n  resetPassword(email: string): Promise<{ error: any }> {\n    return this.supabaseService.client.auth.resetPasswordForEmail(email, {\n      redirectTo: 'http://localhost:8100/auth/reset-password'\n    });\n  }\n\n    /**\n   * Set Supabase session from URL fragment tokens\n   */\n  async setSessionFromFragment(): Promise<boolean> {\n    try {\n      // Parse the URL fragment to extract tokens\n      const url = new URL(window.location.href);\n      const hashParams = new URLSearchParams(url.hash.slice(1));\n      const accessToken = hashParams.get('access_token');\n      const refreshToken = hashParams.get('refresh_token');\n      \n      if (!accessToken || !refreshToken) {\n        console.error('Missing tokens in URL fragment');\n        return false;\n      }\n      \n      // Set the Supabase session with the tokens from URL fragment\n      const { error } = await this.supabaseService.client.auth.setSession({\n        access_token: accessToken,\n        refresh_token: refreshToken\n      });\n      \n      if (error) {\n        console.error('Failed to set Supabase session:', error);\n        return false;\n      }\n      \n      return true;\n      \n    } catch (err) {\n      console.error('Error setting Supabase session:', err);\n      return false;\n    }\n  }\n\n  /**\n   * Handle automatic navigation after session restoration\n   * This method should be called when the app starts and finds an existing session\n   */\n  async handleSessionRestoration(): Promise<void> {\n    if (!this.useSupabase) {\n      return;\n    }\n\n    try {\n      const user = this.supabaseService.currentUser;\n      const profile = this.supabaseService.currentProfile;\n      \n      if (user && profile) {\n        console.log(' AuthService: Handling session restoration navigation', {\n          userId: user.id,\n          role: profile.role,\n          firstLogin: profile.first_login\n        });\n        \n        // The navigation will be handled by the guards and routing system\n        // We just need to ensure the AuthService state is properly set\n        const authResponse: AuthResponse = {\n          token: 'supabase-session-token',\n          user: {\n            id: profile.id,\n            email: profile.email,\n            role: profile.role,\n            username: profile.username,\n            firstName: profile.first_name,\n            lastName: profile.last_name,\n          }\n        };\n        \n        this.setAuthenticatedUser(authResponse);\n        console.log(' AuthService: Session restoration complete');\n      }\n    } catch (error) {\n      console.error(' AuthService: Error during session restoration:', error);\n    }\n  }\n\n  /**\n   * Update password using Supabase reset token\n   */\n  async updatePasswordWithTokens(newPassword: string): Promise<boolean> {\n    try {\n      // Try multiple sources for the access token\n      let accessToken = '';\n      \n      // First, try to get from URL fragment\n      const url = new URL(window.location.href);\n      const hashParams = new URLSearchParams(url.hash.slice(1));\n      accessToken = hashParams.get('access_token') || '';\n      \n      // If not found in URL, try to get from localStorage (component might have stored it)\n      if (!accessToken) {\n        accessToken = localStorage.getItem('current_reset_token') || '';\n      }\n      \n      // If still not found, try to get from session storage\n      if (!accessToken) {\n        accessToken = sessionStorage.getItem('current_reset_token') || '';\n      }\n      \n      if (!accessToken) {\n        console.error('No access token found in URL fragment, localStorage, or sessionStorage');\n        return false;\n      }\n\n      // Use direct API call to update password\n      const response = await fetch(`${environment.supabase.url}/auth/v1/user`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${accessToken}`,\n          'apikey': environment.supabase.key\n        },\n        body: JSON.stringify({\n          password: newPassword\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        console.error('Password update failed:', {\n          status: response.status,\n          statusText: response.statusText,\n          error: errorData\n        });\n        return false;\n      }\n\n      return true;\n\n    } catch (err) {\n      console.error('Exception during password reset:', err);\n      \n      // Handle NavigatorLockAcquireTimeoutError gracefully - it's usually not fatal\n      if (err instanceof Error && err.message.includes('NavigatorLockAcquireTimeoutError')) {\n        // Continue with the flow as this error doesn't necessarily mean the operation failed\n        return true;\n      }\n      \n      return false;\n    }\n  }\n\n  // Debug method to manually fix a user's first_login status\n  async debugFixUserFirstLoginStatus(email: string, shouldBeFirstTime: boolean = false): Promise<boolean> {\n    if (!this.useSupabase) {\n      console.log(' AuthService: Debug method only works with Supabase');\n      return false;\n    }\n\n    try {\n      console.log(` AuthService: Setting first_login=${shouldBeFirstTime} for user: ${email}`);\n\n      const { error } = await this.supabaseService.client\n        .from('profiles')\n        .update({\n          first_login: shouldBeFirstTime,\n          updated_at: new Date().toISOString()\n        })\n        .eq('email', email);\n\n      if (error) {\n        console.error(` AuthService: Error updating user ${email}:`, error);\n        return false;\n      }\n\n      console.log(` AuthService: Successfully updated user ${email} first_login status`);\n\n      // If this is the current user, force a profile refresh\n      const currentUser = this.currentUserValue;\n      if (currentUser?.user.email === email) {\n        console.log(' AuthService: Refreshing current user profile...');\n        // The Supabase service should automatically update the profile via its subscription\n        setTimeout(() => {\n          const updatedStatus = this.isFirstTimeUser();\n          console.log(' AuthService: Current user updated first_login status:', updatedStatus);\n        }, 1000);\n      }\n\n      return true;\n    } catch (error) {\n      console.error(` AuthService: Error in debugFixUserFirstLoginStatus:`, error);\n      return false;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Preferences } from '@capacitor/preferences';\nimport { Capacitor } from '@capacitor/core';\n\n/**\n * Cross-platform storage service that uses:\n * - Capacitor Preferences for native platforms (iOS/Android)\n * - localStorage for web platform\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class CrossPlatformStorageService {\n  private isNative = Capacitor.isNativePlatform();\n\n  /**\n   * Set a value in storage\n   */\n  async set(key: string, value: any): Promise<void> {\n    const stringValue = JSON.stringify(value);\n    \n    if (this.isNative) {\n      await Preferences.set({\n        key,\n        value: stringValue\n      });\n    } else {\n      localStorage.setItem(key, stringValue);\n    }\n  }\n\n  /**\n   * Get a value from storage\n   */\n  async get(key: string): Promise<any> {\n    try {\n      let value: string | null;\n      \n      if (this.isNative) {\n        const result = await Preferences.get({ key });\n        value = result.value;\n      } else {\n        value = localStorage.getItem(key);\n      }\n      \n      return value ? JSON.parse(value) : null;\n    } catch (error) {\n      console.error(`Error getting value for key ${key}:`, error);\n      return null;\n    }\n  }\n\n  /**\n   * Remove a value from storage\n   */\n  async remove(key: string): Promise<void> {\n    if (this.isNative) {\n      await Preferences.remove({ key });\n    } else {\n      localStorage.removeItem(key);\n    }\n  }\n\n  /**\n   * Clear all storage\n   */\n  async clear(): Promise<void> {\n    if (this.isNative) {\n      await Preferences.clear();\n    } else {\n      localStorage.clear();\n    }\n  }\n\n  /**\n   * Get all keys from storage\n   */\n  async keys(): Promise<string[]> {\n    if (this.isNative) {\n      const result = await Preferences.keys();\n      return result.keys;\n    } else {\n      return Object.keys(localStorage);\n    }\n  }\n\n  /**\n   * Check if a key exists in storage\n   */\n  async has(key: string): Promise<boolean> {\n    const value = await this.get(key);\n    return value !== null;\n  }\n\n  /**\n   * Get multiple values at once\n   */\n  async getMultiple(keys: string[]): Promise<{ [key: string]: any }> {\n    const result: { [key: string]: any } = {};\n    \n    for (const key of keys) {\n      result[key] = await this.get(key);\n    }\n    \n    return result;\n  }\n\n  /**\n   * Set multiple values at once\n   */\n  async setMultiple(keyValuePairs: { [key: string]: any }): Promise<void> {\n    const promises = Object.entries(keyValuePairs).map(([key, value]) => \n      this.set(key, value)\n    );\n    \n    await Promise.all(promises);\n  }\n\n  /**\n   * Remove multiple keys at once\n   */\n  async removeMultiple(keys: string[]): Promise<void> {\n    const promises = keys.map(key => this.remove(key));\n    await Promise.all(promises);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { App } from '@capacitor/app';\nimport { Capacitor } from '@capacitor/core';\nimport { SupabaseService } from '../../services/supabase.service';\nimport { Router } from '@angular/router';\n\n/**\n * Service to handle deep links for authentication flows\n * Primarily used for email confirmation on native platforms\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DeepLinkService {\n  private isNative = Capacitor.isNativePlatform();\n\n  constructor(\n    private supabaseService: SupabaseService,\n    private router: Router\n  ) {\n    this.initializeDeepLinkListener();\n  }\n\n  /**\n   * Initialize deep link listener for native platforms\n   */\n  private initializeDeepLinkListener(): void {\n    if (!this.isNative) {\n      console.log(' Web platform detected - deep link listener not needed');\n      return;\n    }\n\n    console.log(' Native platform detected - initializing deep link listener');\n\n    // Listen for app state changes and deep links\n    App.addListener('appStateChange', ({ isActive }) => {\n      console.log(' App state changed. Is active?', isActive);\n    });\n\n    // Listen for deep links when app is already running\n    App.addListener('appUrlOpen', async (event) => {\n      console.log(' Deep link received:', event.url);\n      await this.handleDeepLink(event.url);\n    });\n\n    // Check for initial deep link when app starts\n    this.checkInitialDeepLink();\n  }\n\n  /**\n   * Check for initial deep link when app starts\n   */\n  private async checkInitialDeepLink(): Promise<void> {\n    try {\n      const launchUrl = await App.getLaunchUrl();\n      if (launchUrl && launchUrl.url) {\n        console.log(' Initial deep link detected:', launchUrl.url);\n        await this.handleDeepLink(launchUrl.url);\n      }\n    } catch (error) {\n      // No initial deep link or error getting it\n      console.log(' No initial deep link detected');\n    }\n  }\n\n  /**\n   * Handle incoming deep link\n   */\n  private async handleDeepLink(url: string): Promise<void> {\n    try {\n      console.log(' Processing deep link:', url);\n\n      // Check if this is an auth-related deep link\n      if (this.isAuthDeepLink(url)) {\n        const success = await this.supabaseService.handleDeepLinkSession(url);\n        \n        if (success) {\n          console.log(' Auth deep link processed successfully');\n          // Navigate to appropriate page after successful auth\n          await this.navigateAfterAuth();\n        } else {\n          console.error(' Failed to process auth deep link');\n          // Navigate to error page or login\n          this.router.navigate(['/auth/login'], { \n            queryParams: { error: 'auth_failed' } \n          });\n        }\n      } else {\n        console.log(' Non-auth deep link, handling as regular navigation');\n        // Handle other types of deep links here if needed\n      }\n    } catch (error) {\n      console.error(' Error handling deep link:', error);\n      // Navigate to error page or login\n      this.router.navigate(['/auth/login'], { \n        queryParams: { error: 'deep_link_failed' } \n      });\n    }\n  }\n\n  /**\n   * Check if the deep link is auth-related\n   */\n  private isAuthDeepLink(url: string): boolean {\n    return url.includes('access_token') && url.includes('refresh_token');\n  }\n\n  /**\n   * Navigate to appropriate page after successful authentication\n   */\n  private async navigateAfterAuth(): Promise<void> {\n    try {\n      // Wait a moment for the session to be fully established\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      // Get the current user to determine where to navigate\n      const user = this.supabaseService.currentUser;\n      const profile = this.supabaseService.currentProfile;\n      \n      if (user && profile) {\n        // Navigate based on user role and first login status\n        if (profile.first_login) {\n          // First time user\n          switch (profile.role) {\n            case 'group-admin':\n              this.router.navigate(['/group-admin/groups']);\n              break;\n            case 'player':\n              this.router.navigate(['/player/join-group']);\n              break;\n            case 'super-admin':\n              this.router.navigate(['/super-admin/dashboard']);\n              break;\n            default:\n              this.router.navigate(['/welcome']);\n          }\n        } else {\n          // Returning user - go to dashboard\n          switch (profile.role) {\n            case 'group-admin':\n              this.router.navigate(['/group-admin/dashboard']);\n              break;\n            case 'player':\n              this.router.navigate(['/player/dashboard']);\n              break;\n            case 'super-admin':\n              this.router.navigate(['/super-admin/dashboard']);\n              break;\n            default:\n              this.router.navigate(['/welcome']);\n          }\n        }\n      } else {\n        // Fallback to welcome page\n        this.router.navigate(['/welcome']);\n      }\n    } catch (error) {\n      console.error(' Error navigating after auth:', error);\n      this.router.navigate(['/welcome']);\n    }\n  }\n\n  /**\n   * Manually trigger deep link handling (useful for testing)\n   */\n  async handleUrl(url: string): Promise<void> {\n    await this.handleDeepLink(url);\n  }\n}\n","import { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { \n  IonContent, \n  IonHeader, \n  IonTitle, \n  IonToolbar, \n  IonCard, \n  IonCardContent, \n  IonButton, \n  IonItem, \n  IonLabel, \n  IonInput,\n  IonText,\n  IonList\n} from '@ionic/angular/standalone';\nimport { AuthService } from './core/services/auth.service';\nimport { SupabaseService } from './services/supabase.service';\n\n@Component({\n  selector: 'app-debug-auth',\n  template: `\n    <ion-header>\n      <ion-toolbar>\n        <ion-title>Debug Authentication</ion-title>\n      </ion-toolbar>\n    </ion-header>\n\n    <ion-content class=\"ion-padding\">\n      <ion-card>\n        <ion-card-content>\n          <h2>Authentication Debug Panel</h2>\n          \n          <ion-item>\n            <ion-label>Current Auth Mode:</ion-label>\n            <ion-text color=\"primary\">{{ authMode }}</ion-text>\n          </ion-item>\n\n          <ion-item>\n            <ion-label>Supabase User:</ion-label>\n            <ion-text color=\"primary\">{{ supabaseUser ? supabaseUser.email : 'None' }}</ion-text>\n          </ion-item>\n\n          <ion-item>\n            <ion-label>Supabase Session:</ion-label>\n            <ion-text color=\"primary\">{{ supabaseSession ? 'Active' : 'None' }}</ion-text>\n          </ion-item>\n\n          <ion-item>\n            <ion-label>AuthService User:</ion-label>\n            <ion-text color=\"primary\">{{ authServiceUser ? authServiceUser.user.email : 'None' }}</ion-text>\n          </ion-item>\n\n          <div style=\"margin-top: 20px;\">\n            <ion-button (click)=\"enableSupabase()\" color=\"primary\" fill=\"outline\">\n              Enable Supabase Auth\n            </ion-button>\n            \n            <ion-button (click)=\"clearLocks()\" color=\"warning\" fill=\"outline\">\n              Clear Auth Locks\n            </ion-button>\n            \n            <ion-button (click)=\"emergencyReset()\" color=\"danger\" fill=\"outline\">\n              Emergency Reset\n            </ion-button>\n            \n            <ion-button (click)=\"testLogin()\" color=\"success\" fill=\"outline\">\n              Test Login\n            </ion-button>\n          </div>\n\n          <div style=\"margin-top: 20px;\">\n            <h3>Test Login</h3>\n            <ion-item>\n              <ion-label position=\"stacked\">Email</ion-label>\n              <ion-input [(ngModel)]=\"testEmail\" placeholder=\"vofal40476@knilok.com\"></ion-input>\n            </ion-item>\n            \n            <ion-item>\n              <ion-label position=\"stacked\">Password</ion-label>\n              <ion-input [(ngModel)]=\"testPassword\" type=\"password\" placeholder=\"Your password\"></ion-input>\n            </ion-item>\n          </div>\n\n          <div style=\"margin-top: 20px;\">\n            <ion-text color=\"medium\">\n              <p>Status: {{ status }}</p>\n            </ion-text>\n          </div>\n        </ion-card-content>\n      </ion-card>\n    </ion-content>\n  `,\n  standalone: true,\n  imports: [\n    IonContent,\n    IonHeader,\n    IonTitle,\n    IonToolbar,\n    IonCard,\n    IonCardContent,\n    IonButton,\n    IonItem,\n    IonLabel,\n    IonInput,\n    IonText,\n    IonList,\n    CommonModule,\n    FormsModule\n  ]\n})\nexport class DebugAuthPage {\n  authMode = 'Mock';\n  supabaseUser: any = null;\n  supabaseSession: any = null;\n  authServiceUser: any = null;\n  status = 'Ready';\n  \n  testEmail = 'vofal40476@knilok.com';\n  testPassword = '';\n\n  constructor(\n    private authService: AuthService,\n    private supabaseService: SupabaseService\n  ) {\n    this.updateStatus();\n  }\n\n  updateStatus() {\n    // Check auth mode\n    const useSupabase = localStorage.getItem('useSupabase') === 'true';\n    this.authMode = useSupabase ? 'Supabase' : 'Mock';\n    \n    // Get current users\n    this.supabaseUser = this.supabaseService.currentUser;\n    this.supabaseSession = this.supabaseService.currentSession;\n    this.authServiceUser = this.authService.currentUserValue;\n  }\n\n  async enableSupabase() {\n    this.status = 'Enabling Supabase...';\n    this.authService.enableSupabaseAuth();\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    this.updateStatus();\n    this.status = 'Supabase enabled!';\n  }\n\n  async clearLocks() {\n    this.status = 'Clearing locks...';\n    await this.authService.clearAuthLocks();\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    this.updateStatus();\n    this.status = 'Locks cleared!';\n  }\n\n  async emergencyReset() {\n    this.status = 'Emergency reset...';\n    await this.authService.emergencyReset();\n    await new Promise(resolve => setTimeout(resolve, 3000));\n    this.updateStatus();\n    this.status = 'Emergency reset complete!';\n  }\n\n  async testLogin() {\n    if (!this.testEmail || !this.testPassword) {\n      this.status = 'Please enter email and password';\n      return;\n    }\n\n    this.status = 'Testing login...';\n    \n    try {\n      const result = await this.authService.login({\n        email: this.testEmail,\n        password: this.testPassword,\n        securityQuestion: '',\n        securityAnswer: ''\n      }).toPromise();\n      \n      this.updateStatus();\n      this.status = `Login successful! User: ${result?.user.email}`;\n    } catch (error) {\n      this.status = `Login failed: ${error}`;\n      console.error('Login error:', error);\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { createClient, SupabaseClient, User, Session } from '@supabase/supabase-js';\nimport { environment } from '../../environments/environment';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { UserRole } from '../core/services/auth.service';\nimport { CrossPlatformStorageService } from '../core/services/cross-platform-storage.service';\n\n// Predict 3 Database Types\nexport interface Profile {\n  id: string;\n  email: string;\n  role: UserRole;\n  username: string;\n  first_name: string;\n  last_name: string;\n  avatar_url?: string;\n  created_at: string;\n  updated_at: string;\n  first_login: boolean;\n}\n\nexport interface PredictionGroup {\n  id: string;\n  name: string;\n  code: string;\n  description?: string;\n  admin_id: string;\n  max_members: number;\n  current_members: number;\n  season_id: string;\n  is_active: boolean;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface Match {\n  id: string;\n  home_team: string;\n  away_team: string;\n  home_team_logo?: string;\n  away_team_logo?: string;\n  kickoff_time: string;\n  gameweek: number;\n  season_id: string;\n  status: 'scheduled' | 'live' | 'completed' | 'cancelled';\n  home_score?: number;\n  away_score?: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface Prediction {\n  id: string;\n  user_id: string;\n  match_id: string;\n  group_id: string;\n  home_score: number;\n  away_score: number;\n  points_earned?: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface GroupMember {\n  id: string;\n  group_id: string;\n  user_id: string;\n  joined_at: string;\n  total_points: number;\n  position?: number;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SupabaseService {\n  private supabase!: SupabaseClient;\n  private currentUser$ = new BehaviorSubject<User | null>(null);\n  private currentSession$ = new BehaviorSubject<Session | null>(null);\n  private currentProfile$ = new BehaviorSubject<Profile | null>(null);\n\n  constructor(private storageService: CrossPlatformStorageService) {\n    // Initialize Supabase client with better error handling\n    try {\n      this.supabase = createClient(\n        environment.supabase.url,\n        environment.supabase.key,\n        {\n          auth: {\n            persistSession: true, // Enable session persistence for proper auth state\n            autoRefreshToken: true, // Enable auto refresh for seamless experience\n            detectSessionInUrl: true, // Enable automatic session detection\n            storage: {\n              getItem: async (key: string) => {\n                try {\n                  return await this.storageService.get(key);\n                } catch (error) {\n                  console.warn(` SupabaseService: Error getting item ${key}:`, error);\n                  return null;\n                }\n              },\n              setItem: async (key: string, value: string) => {\n                try {\n                  await this.storageService.set(key, value);\n                } catch (error) {\n                  console.warn(` SupabaseService: Error setting item ${key}:`, error);\n                }\n              },\n              removeItem: async (key: string) => {\n                try {\n                  await this.storageService.remove(key);\n                } catch (error) {\n                  console.warn(` SupabaseService: Error removing item ${key}:`, error);\n                }\n              }\n            }\n          }\n        }\n      );\n\n      // Initialize auth state\n      this.initializeAuth();\n    } catch (error) {\n      console.error(' SupabaseService: Failed to initialize Supabase client:', error);\n    }\n  }\n\n  private async initializeAuth() {\n    if (!this.supabase) {\n      console.error(' SupabaseService: Supabase client not initialized');\n      return;\n    }\n\n    try {\n      // Get initial session\n      const { data: { session } } = await this.supabase.auth.getSession();\n      this.currentSession$.next(session);\n      this.currentUser$.next(session?.user || null);\n\n      // Load profile if user exists\n      if (session?.user) {\n        await this.loadUserProfile(session.user.id);\n      }\n\n      // Listen for auth changes\n      this.supabase.auth.onAuthStateChange(async (event, session) => {\n        this.currentSession$.next(session);\n        this.currentUser$.next(session?.user || null);\n\n        if (session?.user) {\n          await this.loadUserProfile(session.user.id);\n        } else {\n          this.currentProfile$.next(null);\n        }\n      });\n    } catch (error) {\n      console.error(' SupabaseService: Error initializing auth:', error);\n    }\n  }\n\n  private async loadUserProfile(userId: string) {\n    if (!this.supabase) {\n      console.error(' SupabaseService: Supabase client not initialized');\n      return;\n    }\n\n    try {\n      const { data: profile, error } = await this.supabase\n        .from('profiles')\n        .select('*')\n        .eq('id', userId)\n        .single();\n\n      if (error) {\n        console.error('Error loading user profile:', error);\n        return;\n      }\n\n      this.currentProfile$.next(profile);\n    } catch (error) {\n      console.error('Error in loadUserProfile:', error);\n    }\n  }\n\n  // Getters for reactive state\n  get client() {\n    return this.supabase;\n  }\n\n  get user$(): Observable<User | null> {\n    return this.currentUser$.asObservable();\n  }\n\n  get session$(): Observable<Session | null> {\n    return this.currentSession$.asObservable();\n  }\n\n  get profile$(): Observable<Profile | null> {\n    return this.currentProfile$.asObservable();\n  }\n\n  get currentUser(): User | null {\n    return this.currentUser$.value;\n  }\n\n  get currentSession(): Session | null {\n    return this.currentSession$.value;\n  }\n\n  get currentProfile(): Profile | null {\n    return this.currentProfile$.value;\n  }\n\n  // Authentication Methods\n  async signUp(\n    email: string,\n    password: string,\n    metadata: { username: string; first_name: string; last_name: string; role: UserRole },\n    redirectTo?: string // optional; fallback to current origin\n  ) {\n    try {\n      // Determine the appropriate redirect URL based on platform\n      const defaultRedirectUrl = redirectTo ?? this.getDefaultRedirectUrl();\n      \n      const { data, error } = await this.supabase.auth.signUp({\n        email,\n        password,\n        options: {\n          data: metadata, // store profile metadata on the user\n          emailRedirectTo: defaultRedirectUrl,\n        },\n      });\n\n      if (error) {\n        console.error('Auth signup error:', error);\n        throw error;\n      }\n\n      // Create profile after successful signup (non-blocking)\n      if (data.user) {\n        // Don't await - let it run in background\n        this.createProfile(data.user.id, {\n          email,\n          ...metadata,\n          first_login: true,\n          // the following will be set in createProfile() anyway:\n          // created_at / updated_at\n        } as Omit<Profile, 'id' | 'created_at' | 'updated_at'>)\n        .catch((error) => {\n          console.error('Profile creation failed:', error);\n        });\n      }\n\n      return data;\n    } catch (error) {\n      console.error('SignUp failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Clear any existing Navigator LockManager locks for Supabase auth\n   * This helps prevent NavigatorLockAcquireTimeoutError\n   */\n  private async clearAuthLocks(): Promise<void> {\n    try {\n      console.log(' SupabaseService: Clearing existing auth locks...');\n\n      // Check if Navigator LockManager is available\n      if (typeof navigator !== 'undefined' && 'locks' in navigator) {\n        // Get currently held locks\n        const lockState = await navigator.locks.query();\n\n        // Look for Supabase auth-related locks\n        const authLocks = lockState.held?.filter(lock =>\n          lock.name && (\n            lock.name.includes('auth-token') ||\n            lock.name.includes('supabase') ||\n            lock.name.includes('sb-')\n          )\n        );\n\n        if (authLocks && authLocks.length > 0) {\n          console.log(' SupabaseService: Found existing auth locks:', authLocks.map(l => l.name));\n\n          // Wait a bit for any ongoing operations to complete\n          await new Promise(resolve => setTimeout(resolve, 100));\n\n          // Sign out to release any existing locks\n          try {\n            await this.supabase.auth.signOut({ scope: 'local' });\n            console.log(' SupabaseService: Local signOut completed to release locks');\n          } catch (signOutError) {\n            console.log(' SupabaseService: SignOut error (expected):', signOutError);\n          }\n\n          // Wait a bit more for locks to be released\n          await new Promise(resolve => setTimeout(resolve, 200));\n        } else {\n          console.log(' SupabaseService: No auth locks found');\n        }\n      } else {\n        console.log(' SupabaseService: Navigator LockManager not available');\n      }\n    } catch (error) {\n      console.error(' SupabaseService: Error clearing auth locks:', error);\n      // Don't throw - continue with sign in attempt\n    }\n  }\n\n  async signIn(email: string, password: string) {\n    if (!this.supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n\n    console.log(' SupabaseService: Starting signIn...');\n    console.log(' SupabaseService: Supabase URL:', environment.supabase.url);\n    console.log(' SupabaseService: Supabase Key (first 20 chars):', environment.supabase.key.substring(0, 20) + '...');\n\n    // Retry mechanism for NavigatorLockAcquireTimeoutError\n    const maxRetries = 3;\n    let lastError: any;\n\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        console.log(` SupabaseService: Sign-in attempt ${attempt}/${maxRetries}`);\n\n        if (attempt > 1) {\n          // Clear any existing auth locks before retry\n          await this.clearAuthLocks();\n          // Wait between retries with exponential backoff\n          const delay = Math.min(1000 * Math.pow(2, attempt - 2), 5000); // 1s, 2s, 4s max\n          console.log(` SupabaseService: Waiting ${delay}ms before retry...`);\n          await new Promise(resolve => setTimeout(resolve, delay));\n        }\n\n        console.log(' SupabaseService: Calling supabase.auth.signInWithPassword...');\n\n        // Don't clear existing session - let Supabase handle session management\n        const { data, error } = await this.supabase.auth.signInWithPassword({\n          email,\n          password\n        });\n\n        console.log(' SupabaseService: SignIn response received');\n        console.log(' SupabaseService: Data:', data);\n        console.log(' SupabaseService: Error:', error);\n\n        if (error) {\n          console.error(' SupabaseService: SignIn error:', error);\n          throw error;\n        }\n\n        console.log(' SupabaseService: SignIn successful:', data);\n        return data;\n\n      } catch (attemptError) {\n        console.log(` SupabaseService: Attempt ${attempt} failed:`, attemptError);\n        lastError = attemptError;\n\n        // Check if this is a NavigatorLockAcquireTimeoutError\n        const isLockError = attemptError instanceof Error &&\n          (attemptError.message.includes('NavigatorLockAcquireTimeoutError') ||\n           attemptError.message.includes('lock'));\n\n        if (isLockError && attempt < maxRetries) {\n          console.log(` SupabaseService: Lock error on attempt ${attempt}, will retry...`);\n          continue; // Try again\n        }\n\n        // If it's not a lock error, or we've exhausted retries, handle differently\n        if (!isLockError || attempt === maxRetries) {\n          // For lock errors on final attempt, try to get profile data directly\n          if (isLockError) {\n            console.log(' SupabaseService: Final attempt failed with lock error, trying direct profile fetch...');\n            try {\n              const { data: profileData, error: profileError } = await this.supabase\n                .from('profiles')\n                .select('*')\n                .eq('email', email)\n                .single();\n\n              if (profileData && !profileError) {\n                console.log(' SupabaseService: Found profile data directly:', profileData);\n                return {\n                  user: {\n                    id: profileData.id,\n                    email: profileData.email,\n                    user_metadata: {\n                      username: profileData.username,\n                      first_name: profileData.first_name,\n                      last_name: profileData.last_name,\n                      role: profileData.role\n                    }\n                  },\n                  session: { access_token: 'fallback-token' }\n                };\n              }\n            } catch (directError) {\n              console.log(' SupabaseService: Could not get profile data directly:', directError);\n            }\n          }\n\n          // Re-throw the original error for non-lock errors or final attempt\n          throw attemptError;\n        }\n      }\n    }\n\n    // If we get here, all retries failed\n    console.error(' SupabaseService: All sign-in attempts failed');\n    throw lastError;\n  }\n\n  async signOut() {\n    try {\n      // First, clear local state to prevent race conditions\n      this.currentUser$.next(null);\n      this.currentSession$.next(null);\n      this.currentProfile$.next(null);\n      \n      // Then perform Supabase signOut if client is available\n      if (this.supabase) {\n        const { error } = await this.supabase.auth.signOut();\n        if (error) {\n          console.error('Auth signOut error:', error);\n          throw error;\n        }\n      }\n    } catch (error) {\n      console.error('signOut failed:', error);\n      // Continue with local cleanup even if Supabase signOut fails\n    }\n    \n    // Ensure local state is cleared (in case it wasn't cleared above)\n    this.currentUser$.next(null);\n    this.currentSession$.next(null);\n    this.currentProfile$.next(null);\n  }\n\n  // Profile Management\n  async createProfile(userId: string, profileData: Omit<Profile, 'id' | 'created_at' | 'updated_at'>) {\n    try {\n      const { data, error } = await this.supabase\n        .from('profiles')\n        .insert([{\n          id: userId,\n          ...profileData,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        }])\n        .select()\n        .single();\n\n      if (error) {\n        console.error('Profile creation error:', error);\n        throw error;\n      }\n      \n      return data;\n    } catch (error) {\n      console.error('Profile creation failed:', error);\n      throw error;\n    }\n  }\n\n  async updateProfile(userId: string, updates: Partial<Profile>) {\n    const { data, error } = await this.supabase\n      .from('profiles')\n      .update({\n        ...updates,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', userId)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  // Mark first login as complete\n  async markFirstLoginComplete(userId: string) {\n    try {\n      const { data, error } = await this.supabase\n        .from('profiles')\n        .update({\n          first_login: false,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', userId)\n        .select()\n        .single();\n\n      if (error) {\n        console.error('Error marking first login complete:', error);\n        throw error;\n      }\n\n      // Update the current profile in memory\n      if (this.currentProfile$.value) {\n        this.currentProfile$.next({\n          ...this.currentProfile$.value,\n          first_login: false\n        });\n      }\n\n      console.log(' First login marked as complete for user:', userId);\n      return data;\n    } catch (error) {\n      console.error('Failed to mark first login complete:', error);\n      throw error;\n    }\n  }\n\n  // Public method to refresh current user profile\n  async refreshCurrentUserProfile(): Promise<void> {\n    const currentUser = this.currentUser;\n    if (currentUser?.id) {\n      await this.loadUserProfile(currentUser.id);\n      console.log(' SupabaseService: Current user profile refreshed');\n    }\n  }\n\n  // Group Management\n  async createGroup(groupData: Omit<PredictionGroup, 'id' | 'created_at' | 'updated_at' | 'current_members'>) {\n    const { data, error } = await this.supabase\n      .from('groups')\n      .insert([{\n        ...groupData,\n        current_members: 1, // Admin counts as first member\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      }])\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async joinGroup(groupCode: string, userId: string) {\n    // First, find the group by code\n    const { data: group, error: groupError } = await this.supabase\n      .from('groups')\n      .select('*')\n      .eq('code', groupCode)\n      .single();\n\n    if (groupError) throw groupError;\n\n    // Check if user is already a member\n    const { data: existingMember } = await this.supabase\n      .from('group_members')\n      .select('*')\n      .eq('group_id', group.id)\n      .eq('user_id', userId)\n      .single();\n\n    if (existingMember) {\n      throw new Error('User is already a member of this group');\n    }\n\n    // Add user to group\n    const { data, error } = await this.supabase\n      .from('group_members')\n      .insert([{\n        group_id: group.id,\n        user_id: userId,\n        joined_at: new Date().toISOString(),\n        total_points: 0\n      }])\n      .select()\n      .single();\n\n    if (error) throw error;\n\n    // Update group member count\n    await this.supabase\n      .from('groups')\n      .update({\n        current_members: group.current_members + 1,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', group.id);\n\n    return data;\n  }\n\n  // Prediction Management\n  async createPrediction(predictionData: Omit<Prediction, 'id' | 'created_at' | 'updated_at' | 'points_earned'>) {\n    const { data, error } = await this.supabase\n      .from('predictions')\n      .insert([{\n        ...predictionData,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      }])\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async updatePrediction(predictionId: string, updates: Partial<Prediction>) {\n    const { data, error } = await this.supabase\n      .from('predictions')\n      .update({\n        ...updates,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', predictionId)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  // Match Management\n  async getMatches(gameweek?: number) {\n    let query = this.supabase\n      .from('matches')\n      .select('*')\n      .order('kickoff_time', { ascending: true });\n\n    if (gameweek) {\n      query = query.eq('gameweek', gameweek);\n    }\n\n    const { data, error } = await query;\n    if (error) throw error;\n    return data;\n  }\n\n  // Utility Methods\n  async checkSuperAdminExists(): Promise<boolean> {\n    const { data, error } = await this.supabase\n      .from('profiles')\n      .select('id')\n      .eq('role', 'super-admin')\n      .limit(1);\n\n    if (error) throw error;\n    return data.length > 0;\n  }\n\n  // Real-time Subscriptions\n  subscribeToGroupUpdates(groupId: string, callback: (payload: any) => void) {\n    return this.supabase\n      .channel(`group_${groupId}`)\n      .on('postgres_changes', \n        { event: '*', schema: 'public', table: 'group_members', filter: `group_id=eq.${groupId}` },\n        callback\n      )\n      .subscribe();\n  }\n\n  subscribeToMatchUpdates(callback: (payload: any) => void) {\n    return this.supabase\n      .channel('matches')\n      .on('postgres_changes', \n        { event: '*', schema: 'public', table: 'matches' },\n        callback\n      )\n      .subscribe();\n  }\n\n  /**\n   * Get the default redirect URL based on platform\n   */\n  private getDefaultRedirectUrl(): string {\n    // For web, use the current origin\n    if (typeof window !== 'undefined' && window.location) {\n      return `${window.location.origin}/auth/email-confirmed`;\n    }\n    \n    // For native platforms, use a custom scheme\n    return 'io.ionic.starter://auth/email-confirmed';\n  }\n\n  /**\n   * Handle deep link session exchange for email confirmation\n   * This method should be called when the app receives a deep link with auth tokens\n   */\n  async handleDeepLinkSession(url: string): Promise<boolean> {\n    try {\n      console.log(' Handling deep link session:', url);\n      \n      // Parse the URL to extract tokens\n      const urlObj = new URL(url);\n      const hashParams = new URLSearchParams(urlObj.hash.slice(1));\n      const accessToken = hashParams.get('access_token');\n      const refreshToken = hashParams.get('refresh_token');\n      const type = hashParams.get('type');\n      \n      if (!accessToken || !refreshToken) {\n        console.error(' Missing tokens in deep link');\n        return false;\n      }\n      \n      // Set the session using the tokens from the deep link\n      const { data, error } = await this.supabase.auth.setSession({\n        access_token: accessToken,\n        refresh_token: refreshToken\n      });\n      \n      if (error) {\n        console.error(' Failed to set session from deep link:', error);\n        return false;\n      }\n      \n      console.log(' Successfully set session from deep link');\n      return true;\n      \n    } catch (error) {\n      console.error(' Error handling deep link session:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Check if the current URL contains auth tokens (for web platform)\n   */\n  hasAuthTokensInUrl(): boolean {\n    if (typeof window === 'undefined') return false;\n    \n    const hash = window.location.hash;\n    return hash.includes('access_token') && hash.includes('refresh_token');\n  }\n\n  /**\n   * Extract and set session from URL tokens (for web platform)\n   */\n  async setSessionFromUrl(): Promise<boolean> {\n    if (!this.hasAuthTokensInUrl()) {\n      return false;\n    }\n\n    const url = window.location.href;\n    return await this.handleDeepLinkSession(url);\n  }\n\n}","// This will be set to true by Angular's production build\ndeclare const ngDevMode: boolean;\nconst isProduction = typeof ngDevMode !== 'undefined' ? !ngDevMode : false;\n\n// Production configuration\nconst productionConfig = {\n  production: true,\n  supabase: {\n    url: 'https://lmybyfrhzarxmantttki.supabase.co',\n    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxteWJ5ZnJoemFyeG1hbnR0dGtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NDk1MzAsImV4cCI6MjA2NzMyNTUzMH0.SkXjmFSBHQZp8Y74dnnNbwOwotJH3pX1OV6fIN4TFWQ'\n  },\n  apiUrl: 'https://api.example.com',\n  encryptionKey: 'your-encryption-key-here'\n};\n\n// Development configuration\nconst developmentConfig = {\n  production: false,\n  supabase: {\n    url: 'https://lmybyfrhzarxmantttki.supabase.co',\n    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxteWJ5ZnJoemFyeG1hbnR0dGtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NDk1MzAsImV4cCI6MjA2NzMyNTUzMH0.SkXjmFSBHQZp8Y74dnnNbwOwotJH3pX1OV6fIN4TFWQ'\n  },\n  apiUrl: 'http://localhost:3000',\n  encryptionKey: 'dev-encryption-key'\n};\n\nexport const environment = isProduction ? productionConfig : developmentConfig;","import { enableProdMode } from '@angular/core';\r\nimport { bootstrapApplication } from '@angular/platform-browser';\r\nimport { AppComponent } from './app/app.component';\r\nimport { appConfig } from './app/app.config';\r\nimport { environment } from './environments/environment';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nbootstrapApplication(AppComponent, appConfig).catch((err) =>\r\n  console.error(err)\r\n);\r\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 4140;\nmodule.exports = webpackEmptyAsyncContext;"],"names":["RouterOutlet","Capacitor","AppComponent","constructor","supabaseService","authService","deepLinkService","router","isNative","isNativePlatform","ngOnInit","_this","_asyncToGenerator","console","log","initializeSession","_this2","hasTokensInUrl","hasAuthTokensInUrl","success","setSessionFromUrl","session","currentSession","user","currentUser","handleSessionRestoration","error","syncAuthService","_this3","profile","currentProfile","authResponse","token","id","email","role","username","firstName","first_name","lastName","last_name","next","i0","directiveInject","i1","SupabaseService","i2","AuthService","i3","DeepLinkService","i4","Router","selectors","standalone","features","StandaloneFeature","decls","vars","template","AppComponent_Template","rf","ctx","element","encapsulation","provideRouter","provideHttpClient","provideIonicAngular","routes","ErrorInterceptor","HTTP_INTERCEPTORS","CrossPlatformStorageService","appConfig","providers","provide","useClass","multi","AuthGuard","NoAuthGuard","DebugAuthPage","path","component","canActivate","loadChildren","then","m","data","expectedRole","redirectTo","pathMatch","map","take","getLoginRoute","route","pipe","_route$data","loginRoute","navigate","userRole","_route$data2","inject","factory","fac","providedIn","_route$routeConfig","routeConfig","currentUrl","url","includes","isFirstLogin","isFirstTimeUser","throwError","catchError","intercept","request","handle","status","BehaviorSubject","Observable","environment","STORAGE_KEYS","CURRENT_USER","LAST_ACTIVITY","SESSION_ID","USE_SUPABASE","SESSION_STORAGE_KEY","SESSION_CHECK_INTERVAL","SESSION_TIMEOUT","MAX_LOGIN_ATTEMPTS","LOCKOUT_DURATION","http","apiUrl","currentSessionId","loginAttempts","Map","useSupabase","sessionRestorationInProgress","isInitialized","isHandlingCrossTabEvent","loginInProgress","lastBroadcastTime","BROADCAST_THROTTLE_MS","generateSessionId","currentUserSubject","asObservable","initializeAuth","ngOnDestroy","sessionTimer","clearInterval","crossTabTimer","window","removeEventListener","handleStorageChange","bind","debugForceCompleteFirstLogin","markFirstLoginComplete","setTimeout","isFirstTime","debugClearAuthLocks","clearAuthLocks","localStorage","getItem","setItem","initializeSupabaseAuth","initializeSessionTimer","initializeCrossTabSync","restoreSession","_this4","user$","subscribe","handleSupabaseAuthStateChange","_this5","profile$","Date","now","setAuthenticatedUser","userId","firstLogin","first_login","clearAuthenticatedUserInternal","enableSupabaseAuth","disableSupabaseAuth","Math","random","toString","substring","addEventListener","setInterval","checkCrossTabSession","event","key","sessionData","newValue","action","sessionId","JSON","parse","currentUserValue","storedUser","getStoredUser","_currentUser$user","isSameUser","userDataChanged","stringify","broadcastSessionChange","clearAuthenticatedUser","clearUserStorage","timestamp","currentData","removeItem","legacyKeys","forEach","keys","Object","startsWith","_this6","isSessionValid","lastActivity","timeSinceLastActivity","Number","logout","updateLastActivity","checkLoginAttempts","attempts","get","lockoutUntil","Error","toLocaleTimeString","attemptCount","count","set","value","login","loginData","loginWithSupabase","loginWithMock","subscriber","complete","supabaseUser","handleExistingSupabaseSession","checkInterval","restoredUser","performSupabaseLogin","_this7","profileResult","client","from","select","eq","single","_supabaseUser$email","userMetadata","user_metadata","fallbackResponse","split","_this8","signInPromise","signIn","password","timeoutPromise","Promise","_","reject","result","_result$user","race","signInError","access_token","storedRole","storedUsername","storedFirstName","storedLastName","mockResponse","replace","hasCompletedFirstLogin","userForMock","signup","userData","signupWithSupabase","signupWithMock","signUp","_result$user2","catch","signOut","warn","message","clearSession","logoutSilent","_this9","_currentUser$user2","resolve","forceReloadProfile","isStillFirstTime","directUpdateFirstLoginStatus","directError","_this0","refreshCurrentUserProfile","_this1","update","updated_at","toISOString","isAuthenticated","_this$currentUserValu","isSuperAdmin","_this$currentUserValu2","getToken","_this$currentUserValu3","markUserAsReturning","_this$currentUserValu4","getUserRole","_this$currentUserValu5","_this$currentUserValu6","getDefaultDashboardRoute","getFirstTimeRoute","getUserDisplayName","_this$currentUserValu7","getTimeBasedGreeting","hour","getHours","getPersonalizedGreeting","timeGreeting","getCurrentUser","_this$currentUserValu8","clearAllUserData","allKeys","sessionStorage","clear","emergencyAuthReset","_this10","auth","e","navigator","locks","query","lock","name","emergencyReset","_this11","resetPassword","resetPasswordForEmail","setSessionFromFragment","_this12","URL","location","href","hashParams","URLSearchParams","hash","slice","accessToken","refreshToken","setSession","refresh_token","err","_this13","updatePasswordWithTokens","newPassword","response","fetch","supabase","method","headers","body","ok","errorData","json","statusText","debugFixUserFirstLoginStatus","_x","_this14","shouldBeFirstTime","updatedStatus","apply","arguments","HttpClient","Preferences","stringValue","remove","has","getMultiple","setMultiple","keyValuePairs","promises","entries","all","removeMultiple","App","initializeDeepLinkListener","addListener","isActive","_ref","handleDeepLink","checkInitialDeepLink","launchUrl","getLaunchUrl","isAuthDeepLink","handleDeepLinkSession","navigateAfterAuth","queryParams","handleUrl","CommonModule","FormsModule","IonContent","IonHeader","IonTitle","IonToolbar","IonCard","IonCardContent","IonButton","IonItem","IonLabel","IonInput","IonText","authMode","supabaseSession","authServiceUser","testEmail","testPassword","updateStatus","enableSupabase","clearLocks","testLogin","securityQuestion","securityAnswer","toPromise","consts","DebugAuthPage_Template","elementStart","text","elementEnd","listener","DebugAuthPage_Template_ion_button_click_30_listener","DebugAuthPage_Template_ion_button_click_32_listener","DebugAuthPage_Template_ion_button_click_34_listener","DebugAuthPage_Template_ion_button_click_36_listener","twoWayListener","DebugAuthPage_Template_ion_input_ngModelChange_44_listener","$event","twoWayBindingSet","DebugAuthPage_Template_ion_input_ngModelChange_48_listener","advance","textInterpolate","twoWayProperty","textInterpolate1","NgControlStatus","NgModel","createClient","storageService","currentUser$","currentSession$","currentProfile$","persistSession","autoRefreshToken","detectSessionInUrl","storage","_ref2","_x2","_x3","_ref3","_x4","getSession","loadUserProfile","onAuthStateChange","_ref4","_x5","_x6","session$","metadata","defaultRedirectUrl","getDefaultRedirectUrl","options","emailRedirectTo","createProfile","_lockState$held","lockState","authLocks","held","filter","length","l","scope","signOutError","maxRetries","lastError","attempt","delay","min","pow","signInWithPassword","attemptError","isLockError","profileData","profileError","insert","created_at","updateProfile","updates","createGroup","groupData","current_members","joinGroup","groupCode","group","groupError","existingMember","group_id","user_id","joined_at","total_points","createPrediction","predictionData","updatePrediction","predictionId","getMatches","gameweek","order","ascending","checkSuperAdminExists","_this15","limit","subscribeToGroupUpdates","groupId","callback","channel","on","schema","table","subscribeToMatchUpdates","origin","_this16","urlObj","type","_this17","isProduction","ngDevMode","productionConfig","production","encryptionKey","developmentConfig","enableProdMode","bootstrapApplication"],"sourceRoot":"webpack:///","x_google_ignoreList":[12]}